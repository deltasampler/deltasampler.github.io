(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();let r;function Te(e){return r=e.getContext("webgl2")}function We(e,t){const n=r.createShader(e);if(!n)return null;if(r.shaderSource(n,t),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS)){const i=r.getShaderInfoLog(n);return console.error(i),r.deleteShader(n),null}return n}function qe(e){const t=r.createProgram(),n=[];for(const i in e){const s=e[i],c=We(parseInt(i),s);if(!c){for(const l of n)r.deleteShader(l);return null}n.push(c)}for(const i of n)r.attachShader(t,i);r.linkProgram(t);for(const i of n)r.detachShader(t,i),r.deleteShader(i);if(!r.getProgramParameter(t,r.LINK_STATUS)){const i=r.getProgramInfoLog(t);return console.error(i),r.deleteProgram(t),null}return t}function P(e,t){return(e+t)%t}function $(e,t,n){return t*n+e}const Be=Float32Array;function pe(e=1,t=0,n=0,o=0,i=0,s,c=0,l=0,u=0,d=0,p,L=0,G=0,z=0,j=0,te){const g=new Be(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=o,g[4]=i,g[5]=e,g[6]=c,g[7]=l,g[8]=u,g[9]=d,g[10]=e,g[11]=L,g[12]=G,g[13]=z,g[14]=j,g[15]=e,g}function ye(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}function Ze(e,t,n){const o=n[0],i=n[1],s=n[2];e[12]=t[0]*o+t[4]*i+t[8]*s+t[12],e[13]=t[1]*o+t[5]*i+t[9]*s+t[13],e[14]=t[2]*o+t[6]*i+t[10]*s+t[14],e[15]=t[3]*o+t[7]*i+t[11]*s+t[15]}function Je(e,t,n){const o=n[0],i=n[1],s=n[2];e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}const I=Float32Array;function a(e=0,t){const n=new I(2);return n[0]=e,n[1]=t??e,n}function Qe(e,t,n){e[0]=t,e[1]=n}function et(e,t){e[0]=t[0],e[1]=t[1]}function C(e){const t=new I(2);return et(t,e),t}function be(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1]}function tt(e,t){const n=new I(2);return be(n,e,t),n}function we(e,t){be(e,e,t)}function nt(e,t,n){e[0]=t[0]*n[0],e[1]=t[1]*n[1]}function xe(e,t){const n=new I(2);return nt(n,e,t),n}function ot(e,t,n){e[0]=t[0]+n,e[1]=t[1]+n}function ke(e,t){const n=new I(2);return ot(n,e,t),n}function it(e,t,n){e[0]=t[0]*n,e[1]=t[1]*n}function he(e,t){const n=new I(2);return it(n,e,t),n}const ze=Float32Array;function f(e=0,t,n){const o=new ze(3);return o[0]=e,o[1]=t??e,o[2]=n??e,o}function ce(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2]}function Se(e){const t=new ze(3);return ce(t,e),t}function Ee(e){e[0]=0,e[1]=0,e[2]=0}class st{}function ct(){const e=new st;return e.position=a(),e.right=a(1,0),e.up=a(0,1),e.world_up=a(0,1),e.projection=pe(1),e.near=-100,e.far=100,e.view=pe(1),e.scale=50,e.roll=0,e.movement_speed=.1,e.roll_speed=.1,e.zoom_speed=.1,e}function lt(e,t,n){return ye(e.projection),Je(e.projection,e.projection,f(e.scale/t,e.scale/n,1)),e.projection}function rt(e){return ye(e.view),Ze(e.view,e.view,f(-e.position[0],-e.position[1],0)),e.view}const b={keys:{},buttons:{},kb_key_down:function(){},kb_key_up:function(){},m_move:function(){},m_button_down:function(){},m_button_up:function(){},m_wheel_scroll:function(){}};function at(e){b.kb_key_down=e}function ut(){addEventListener("keydown",function(e){b.keys[e.code]=0,b.kb_key_down({code:e.code,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,event:e})}),addEventListener("keyup",function(e){b.keys[e.code]=1,b.kb_key_up({code:e.code,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,event:e})}),addEventListener("mousemove",function(e){b.m_move({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target,event:e})}),addEventListener("mousedown",function(e){b.buttons[e.button]=0,b.m_button_down({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target,event:e})}),addEventListener("mouseup",function(e){b.buttons[e.button]=1,b.m_button_up({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target,event:e})}),addEventListener("wheel",function(e){b.m_wheel_scroll({xd:Math.sign(e.deltaX),yd:Math.sign(e.deltaY),event:e})})}function ne(e){return b.keys[e]===0}const _t=Float32Array;function T(e=0,t,n,o){const i=new _t(4);return i[0]=e,i[1]=t??e,i[2]=n??e,i[3]=o,i}function ge(e){return((e[0]&255)<<24|(e[1]&255)<<16|(e[2]&255)<<8|e[3]&255)>>>0}var A=(e=>(e[e.S8=0]="S8",e[e.U8=1]="U8",e[e.S16=2]="S16",e[e.U16=3]="U16",e[e.S32=4]="S32",e[e.U32=5]="U32",e[e.F32=6]="F32",e))(A||{});const Fe={0:1,1:1,2:2,3:2,4:4,5:4,6:4};function dt(e){switch(e){case 0:return r.BYTE;case 1:return r.UNSIGNED_BYTE;case 2:return r.SHORT;case 3:return r.UNSIGNED_SHORT;case 4:return r.INT;case 5:return r.UNSIGNED_INT;case 6:return r.FLOAT;default:return r.FLOAT}}class ft{}function pt(e,t){const n=new ft;return n.type=e,n.size=t,n}class ht{}function gt(){const e=new ht;return e.attribs=[],e.stride=0,e}function D(e,t,n){const o=pt(t,n);return e.attribs.push(o),e.stride+=Fe[o.type]*o.size,o}function mt(e,t=!1){const n=e.attribs;let o=0;for(let i=0;i<n.length;i+=1){const s=n[i],c=dt(s.type);r.enableVertexAttribArray(i),s.type===6?r.vertexAttribPointer(i,s.size,c,!1,e.stride,o):r.vertexAttribIPointer(i,s.size,c,e.stride,o),t&&r.vertexAttribDivisor(i,1),o+=Fe[s.type]*s.size}}let q,Le,Ne;const k=gt();D(k,A.F32,3);D(k,A.F32,2);D(k,A.F32,1);D(k,A.S32,1);D(k,A.S32,1);D(k,A.F32,1);class vt{}function Me(){const e=new vt;return e.data=new ArrayBuffer(0),e.len=0,e.cap=0,e.instances=[],e.vao=0,e.vbo=0,e}function le(e,t){const n=new ArrayBuffer(t*k.stride),o=[];for(let i=0;i<t;i+=1)o.push(new DataView(n,i*k.stride,k.stride));e.data=n,e.len=t,e.cap=t,e.instances=o}function yt(e,t,n,o,i,s,c,l,u){const d=e.instances[t];d.setFloat32(0,n[0],!0),d.setFloat32(4,n[1],!0),d.setFloat32(8,s,!0),d.setFloat32(12,o[0],!0),d.setFloat32(16,o[1],!0),d.setFloat32(20,i,!0),d.setInt32(24,ge(c),!0),d.setInt32(28,ge(l),!0),d.setFloat32(32,u,!0)}function bt(){q=qe({[r.VERTEX_SHADER]:`#version 300 es
            layout(location = 0) in vec3 i_position;
            layout(location = 1) in vec2 i_size;
            layout(location = 2) in float i_rotation;
            layout(location = 3) in int i_inner_color;
            layout(location = 4) in int i_outer_color;
            layout(location = 5) in float i_outline;
            out vec2 v_size;
            flat out int v_inner_color;
            flat out int v_outer_color;
            flat out float v_outline;
            out vec2 v_tex_coord;
            uniform mat4 u_projection;
            uniform mat4 u_view;

            const vec2 positions[4] = vec2[](
                vec2(-0.5, -0.5),
                vec2(0.5, -0.5),
                vec2(-0.5, 0.5),
                vec2(0.5, 0.5)
            );

            const vec2 tex_coords[4] = vec2[](
                vec2(0.0, 0.0),
                vec2(1.0, 0.0),
                vec2(0.0, 1.0),
                vec2(1.0, 1.0)
            );

            vec2 rotate(vec2 p, float r) {
                float c = cos(r), s = sin(r);

                return vec2(
                    p.x * c - p.y * s,
                    p.x * s + p.y * c
                );
            }

            void main() {
                vec2 position = rotate(positions[gl_VertexID] * i_size, i_rotation) + i_position.xy;

                gl_Position = u_projection * u_view * vec4(position, i_position.z, 1.0);
                v_size = i_size;
                v_inner_color = i_inner_color;
                v_outer_color = i_outer_color;
                v_outline = i_outline;
                v_tex_coord = tex_coords[gl_VertexID];
            }
        `,[r.FRAGMENT_SHADER]:`#version 300 es
            precision highp float;
            out vec4 o_frag_color;
            in vec2 v_size;
            in vec2 v_tex_coord;
            flat in int v_inner_color;
            flat in int v_outer_color;
            flat in float v_outline;
            in vec3 v_params;

            vec4 unpack256(int packed) {
                return vec4(
                    (packed >> 24) & 0xFF,
                    (packed >> 16) & 0xFF,
                    (packed >> 8) & 0xFF,
                    packed & 0xFF
                ) / 255.0;
            }

            float uv_border_width(vec2 uv, vec2 size) {
                float left = smoothstep(0.0, size.x, uv.x);
                float right = smoothstep(0.0, size.x, 1.0 - uv.x);
                float bottom = smoothstep(0.0, size.y, 1.0 - uv.y);
                float top = smoothstep(0.0, size.y, uv.y);

                return min(min(left, right), min(top, bottom));
            }

            void main() {
                vec2 uv = v_tex_coord;
                vec4 inner_color = unpack256(v_inner_color);
                vec4 outer_color = unpack256(v_outer_color);
                float mask = v_outline == 0.0 ? 1.0 : uv_border_width(uv, v_outline / v_size);
                vec4 color = mix(vec4(outer_color.xyz, 1.0), inner_color, mask);

                o_frag_color = color;
            }
        `}),Le=r.getUniformLocation(q,"u_projection"),Ne=r.getUniformLocation(q,"u_view")}function re(e){e.vao=r.createVertexArray(),r.bindVertexArray(e.vao),e.vbo=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,e.vbo),r.bufferData(r.ARRAY_BUFFER,e.data,r.STATIC_DRAW),mt(k,!0)}function wt(e,t){r.useProgram(q),r.uniformMatrix4fv(Le,!1,t.projection),r.uniformMatrix4fv(Ne,!1,t.view),r.bindVertexArray(e.vao),r.bindBuffer(r.ARRAY_BUFFER,e.vbo),r.bufferSubData(r.ARRAY_BUFFER,0,e.data),r.drawArraysInstanced(r.TRIANGLE_STRIP,0,4,e.len)}class xt{}function h(e,t,n){const o=new xt;return o.size=C(e),o.cells=[...t],o.color=Se(n),o}function N(e){switch(e){case 0:return h(a(4,1),[1,1,1,1],f(0,255,255));case 1:return h(a(2,3),[0,1,0,1,1,1],f(0,0,255));case 2:return h(a(2,3),[1,0,1,0,1,1],f(255,165,0));case 3:return h(a(2,2),[1,1,1,1],f(255,255,0));case 4:return h(a(3,2),[0,1,1,1,1,0],f(0,255,0));case 5:return h(a(3,2),[1,1,1,0,1,0],f(128,0,128));case 6:return h(a(3,2),[1,1,0,0,1,1],f(255,0,0))}}function Pe(){return[N(0),N(1),N(2),N(3),N(4),N(5),N(6)]}var B=(e=>(e[e.EMPTY=0]="EMPTY",e[e.MOVING=1]="MOVING",e[e.LOCKED=2]="LOCKED",e))(B||{});class kt{}function zt(e,t,n){const o=new kt;return o.state=e,o.position=C(t),o.color=Se(n),o}class St{}function Et(e,t,n){const o=new St;return o.polyomino=e,o.position=C(t),o.rotation=n,o}class Ft{}function Lt(e,t){const n=new Ft;return n.grid_size=C(e),n.cell_size=C(t),n.cells=[],n.len=e[0]*e[1],n.polyominos=Pe(),n.poly_index=0,n.piece=Et(n.polyominos[0],a(),0),n.stored=null,n.has_swapped=!1,n.lock_delay=n.lock_timer=2,n.score=0,n.is_paused=!1,Re(n),n}function Re(e){e.len=e.grid_size[0]*e.grid_size[1];const n=ke(e.cell_size,.05),o=xe(e.grid_size,n),i=he(o,.5),s=he(n,.5);e.cells.length=0;for(let c=0;c<e.len;c+=1){const l=c%e.grid_size[0],u=-Math.floor(c/e.grid_size[0]),d=a(l*n[0]-i[0]+s[0],u*n[1]+i[1]-s[1]);e.cells.push(zt(0,d,f()))}}function Y(e,t,n){const o=e.piece,i=o.polyomino,s=tt(o.position,t),c=(o.rotation+n)%4;for(let l=0;l<i.size[0];l+=1)for(let u=0;u<i.size[1];u+=1){let d=0,p=0;switch(c%4){case 0:d=l,p=u;break;case 1:d=i.size[1]-1-u,p=l;break;case 2:d=i.size[0]-1-l,p=i.size[1]-1-u;break;case 3:d=u,p=i.size[0]-1-l;break}const L=u*i.size[0]+l;if(!i.cells[L])continue;const z=d+s[0],j=p+s[1];if(z<0||z>=e.grid_size[0]||j<0||j>=e.grid_size[1])return!1;const te=$(z,j,e.grid_size[0]);if(te>=e.len||e.cells[te].state===2)return!1}return!0}function E(e,t){const n=e.piece,o=n.polyomino,i=n.position,s=n.rotation;for(let c=0;c<o.size[0];c+=1)for(let l=0;l<o.size[1];l+=1){let u=0,d=0;switch(s%4){case 0:u=c,d=l;break;case 1:u=o.size[1]-1-l,d=c;break;case 2:u=o.size[0]-1-c,d=o.size[1]-1-l;break;case 3:u=l,d=o.size[0]-1-c;break}const p=l*o.size[0]+c;if(!o.cells[p])continue;const G=$(P(u+i[0],e.grid_size[0]),P(d+i[1],e.grid_size[1]),e.grid_size[0]),z=e.cells[G];z.state=t,t===0?Ee(z.color):ce(z.color,o.color)}}function Z(e,t){const n=e.piece;if(n.polyomino=t,Qe(e.piece.position,Math.floor(e.grid_size[0]/2-t.size[0]/2),0),!Y(e,a(),0)){e.is_paused=!0;return}E(e,1)}function X(e,t){if(!Y(e,t,0))return;const n=e.piece;E(e,0),we(n.position,t),E(e,1)}const oe=[a(0,0),a(-1,0),a(1,0),a(0,-1),a(0,1),a(-1,-1),a(-1,1),a(1,-1),a(1,1),a(0,-2),a(0,-3)];function ie(e,t){let n=-1;for(let s=0;s<oe.length;s+=1){const c=oe[s];if(Y(e,c,t)){n=s;break}}if(n<0)return;const o=e.piece,i=oe[n];E(e,0),we(o.position,i),o.rotation=P(o.rotation+t,4),E(e,1)}function Nt(e){const t=e.grid_size[0],n=e.grid_size[1];for(let o=0;o<n;o+=1){let i=!0;for(let s=0;s<t;s+=1){const c=$(s,o,t);if(e.cells[c].state===0){i=!1;break}}if(i){for(let s=o;s>0;s-=1)for(let c=0;c<t;c+=1){const l=$(c,s,t),u=$(c,s-1,t),d=e.cells[l],p=e.cells[u];d.state=p.state,ce(d.color,p.color)}e.score+=e.grid_size[0]}}}function ae(e){for(const t of e.cells)t.state=0,Ee(t.color);e.poly_index=P(e.poly_index+1,e.polyominos.length),Z(e,e.polyominos[e.poly_index]),e.is_paused=!1,e.score=0}function Ae(e){for(;Y(e,a(0,1),0);)X(e,a(0,1));E(e,2),Nt(e),e.poly_index=P(e.poly_index+1,e.polyominos.length),Z(e,e.polyominos[e.poly_index]),e.has_swapped=!1,e.lock_timer=e.lock_delay}function Mt(e){if(!e.stored)e.stored=e.piece.polyomino,e.poly_index=P(e.poly_index+1,e.polyominos.length),E(e,0),Z(e,e.polyominos[e.poly_index]),e.has_swapped=!0;else if(!e.has_swapped){const t=e.stored;e.stored=e.piece.polyomino,e.poly_index=P(e.poly_index+1,e.polyominos.length),E(e,0),e.piece.polyomino=t,Z(e,t),e.has_swapped=!0}}function ue(e,t,n){return Math.min(Math.max(e,t),n)}var M=(e=>(e[e.PX=0]="PX",e[e.PCT=1]="PCT",e[e.FR=2]="FR",e))(M||{});const Pt={0:"px",1:"%",2:"fr"};class Rt{}function O(e,t){const n=new Rt;return n.x=e,n.u=t,n}function At(e){return`${e.x}${Pt[e.u]}`}class Ot{get(){return this.type===0?this.object[this.key]:this.call_get()}set(t){this.type===0?this.object[this.key]=t:this.call_set(t)}}function _e(e,t){const n=new Ot;return n.type=0,n.object=e,n.key=t,n}function F(e,t){if(!e)return null;const n=document.createElement("span");return n.className="gui_label",n.innerHTML=e,t.append(n),n}function U(){const e=document.createElement("div");return e.className="gui_container",e}function Q(e,t,n,o,i){const s=document.createElement("input");return s.className="gui_input",s.type=e,s.step=n.toString(),s.min=o.toString(),s.max=i.toString(),s.value=t.toString(),s}class m{constructor(){this.children=[]}container(){return this.ref_el}render(){}mount(){}static mount(){}update(){}}class Oe extends m{grid_str(t){let n="";for(let o=0;o<t.length;o+=1){const i=t[o];n+=At(i),o<t.length-1&&(n+=" ")}return n}layout_str(){let t="";const n=this.grid_x.length,o=this.grid_y.length,i=n*o;for(let s=0;s<i;s+=n){let c="";for(let l=s;l<s+n;l+=1){const u=this.layout[l];c+=`w${u}`,l<s+n-1&&(c+=" ")}t+=`"${c}"
`}return t}render(){const t=document.createElement("div");this.window_parent?t.className="gui_window":t.className="gui_window_root",this.window_children.length?(t.style.display="grid",t.style.gridTemplateColumns=this.grid_str(this.grid_x),t.style.gridTemplateRows=this.grid_str(this.grid_y),t.style.gridTemplateAreas=this.layout_str()):t.style.gridArea=`w${this.id}`,this.ref_el=t}}class He extends m{container(){return this.container_el}render(){const t=document.createElement("div");t.className="gui_collapsing_header"+(this.is_collapsed?" gui_is_collapsed":"");const n=document.createElement("div");n.className="gui_title",n.innerHTML=this.title,t.append(n),n.onclick=(function(){this.is_collapsed?(this.is_collapsed=!1,t.classList.remove("gui_is_collapsed")):(this.is_collapsed=!0,t.classList.add("gui_is_collapsed"))}).bind(this);const o=U();t.append(o),this.ref_el=t,this.container_el=o}}class Ke extends m{render(){const t=document.createElement("div");t.className="gui_text",t.innerHTML=this.value,this.ref_el=t}}class Ht extends m{render(){const t=document.createElement("div");t.className="gui_bool";const n=document.createElement("div");n.className="gui_checkbox_group_option"+(this.value.get()?" gui_selected":""),n.innerHTML=this.label,t.append(n),n.onclick=(function(){this.value.get()?(this.value.set(!1),n.classList.remove("gui_selected")):(this.value.set(!0),n.classList.add("gui_selected")),this.onchange(this.value.get())}).bind(this),this.ref_el=t,this.input_el=n}update(){this.value.get()?this.input_el.classList.add("gui_selected"):this.input_el.classList.remove("gui_selected")}}class Kt extends m{render(){const t=document.createElement("div");t.className="gui_input_number",F(this.label,t);const n=Q("number",this.value.get(),this.step,this.min,this.max);t.append(n),n.onchange=(function(){const o=ue(parseFloat(n.value),this.min,this.max);this.value.set(o),n.value=o.toString(),this.onchange(o)}).bind(this),this.ref_el=t,this.input_el=n}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString())}}class Ie extends m{render(){const t=document.createElement("div");t.className="gui_slider_number",F(this.label,t);const n=U();n.className="gui_input_range_container",t.append(n);const o=Q("range",this.value.get(),this.step,this.min,this.max);o.className="gui_input_range",n.dataset.content=o.value,n.append(o),o.onchange=(function(){const i=ue(parseFloat(o.value),this.min,this.max);this.value.set(i),n.dataset.content=o.value,this.onchange(i)}).bind(this),o.onmousemove=function(){n.dataset.content=o.value},this.ref_el=t,this.container_el=n,this.input_el=o}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString(),this.container_el.dataset.content=this.input_el.value)}}class It extends m{render(){const t=document.createElement("div");t.className="gui_input_vec",t.style.setProperty("--size",this.size.toString()),F(this.label,t);const n=U();t.append(n);const o=[];for(let i=0;i<this.value.length;i+=1){const s=Q("number",this.value[i],this.step,this.min,this.max);n.append(s),s.onchange=(function(){const c=ue(parseFloat(s.value),this.min,this.max);this.value[i]=c,s.value=c.toString(),this.onchange(this.value)}).bind(this),o.push(s)}this.ref_el=t,this.input_els=o}update(){for(let t=0;t<this.value.length;t+=1){const n=this.input_els[t];document.activeElement!=n&&(n.value=this.value[t].toString())}}}class Dt extends m{to_hex(t,n,o){const i=this.mode===0?255:1,s=Math.round(t*i).toString(16).padStart(2,"0"),c=Math.round(n*i).toString(16).padStart(2,"0"),l=Math.round(o*i).toString(16).padStart(2,"0");return`#${s}${c}${l}`}from_hex(t){const n=t.replace(/^#/,""),o=this.mode===0?255:1,i=parseInt(n.substring(0,2),16)/o,s=parseInt(n.substring(2,4),16)/o,c=parseInt(n.substring(4,6),16)/o;return[i,s,c]}render(){const t=document.createElement("div");t.className="gui_color_edit"+(this.value.length===4?" gui_rgba":""),F(this.label,t);const n=U();t.append(n);const o=document.createElement("input");if(o.className="gui_input_color",o.type="color",o.value=this.to_hex(this.value[0],this.value[1],this.value[2]),n.append(o),o.onchange=(function(){const i=this.from_hex(o.value);this.value[0]=i[0],this.value[1]=i[1],this.value[2]=i[2],this.onchange(this.value)}).bind(this),this.value.length==4){const i=document.createElement("div");i.className="gui_input_range_container",n.append(i);const s=Q("range",this.value[3],.01,0,1);s.className="gui_input_range",i.dataset.content=s.value,i.append(s),s.onchange=(function(){this.value[3]=parseFloat(s.value)*(this.mode===1?255:1),i.dataset.content=s.value,this.onchange(this.value)}).bind(this),s.onmousemove=function(){i.dataset.content=s.value},this.range_el=s,this.range_container_el=i}this.ref_el=t,this.input_el=o}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.to_hex(this.value[0],this.value[1],this.value[2])),this.range_container_el&&this.range_el&&document.activeElement!=this.range_el&&(this.range_el.value=this.value[3].toString(),this.range_container_el.dataset.content=this.range_el.value)}}class Ut extends m{render(){const t=document.createElement("div");t.className="gui_input_text",F(this.label,t);const n=document.createElement("input");n.className="gui_input",n.type="text",n.value=this.value.get().toString(),t.append(n),n.onchange=(function(){this.value.set(n.value),this.onchange(n.value)}).bind(this),this.ref_el=t,this.input_el=n}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString())}}class jt extends m{render(){const t=document.createElement("div");t.className="gui_radio_group",F(this.label,t);const n=U();t.append(n);const o=[],i=this.value.get();for(let s=0;s<this.keys.length;s+=1){const c=this.keys[s],l=this.values[s],u=document.createElement("div");u.className="gui_radio_group_option"+(l===i?" gui_selected":""),u.innerHTML=c,n.append(u),u.onclick=(function(){this.value.set(l);for(const d of this.option_els)d.classList.remove("gui_selected");u.classList.add("gui_selected"),this.onchange(l)}).bind(this),o.push(u)}this.ref_el=t,this.option_els=o}update(){const t=this.value.get();for(let n=0;n<this.option_els.length;n+=1){const o=this.option_els[n];this.values[n]===t?o.classList.add("gui_selected"):o.classList.remove("gui_selected")}}}class Xt extends m{render(){const t=document.createElement("div");t.className="gui_checkbox_group",F(this.label,t);const n=U();t.append(n);const o=[],i=this.value.get();for(let s=0;s<this.keys.length;s+=1){const c=this.keys[s],l=this.values[s],u=document.createElement("div");u.className="gui_checkbox_group_option"+(i.indexOf(l)>-1?" gui_selected":""),u.innerHTML=c,n.append(u),u.onclick=(function(){u.classList.contains("gui_selected")?(i.splice(i.indexOf(l),1),u.classList.remove("gui_selected")):(i.push(l),u.classList.add("gui_selected")),this.onchange(this.value.get())}).bind(this),o.push(u)}this.ref_el=t,this.option_els=o}update(){const t=this.value.get();for(let n=0;n<this.option_els.length;n+=1){const o=this.option_els[n];t.indexOf(this.values[n])>-1?o.classList.add("gui_selected"):o.classList.remove("gui_selected")}}}class De extends m{render(){const t=document.createElement("div");t.className="gui_select",F(this.label,t);const n=document.createElement("div");n.className="gui_select",t.append(n),n.onclick=function(l){l.stopPropagation()};const o=document.createElement("div");o.className="gui_select_button",o.innerHTML="Select",n.append(o),o.onclick=function(){o.classList.contains("gui_open")?o.classList.remove("gui_open"):o.classList.add("gui_open")};const i=document.createElement("div");i.className="gui_select_container",n.append(i);const s=[],c=this.value.get();for(let l=0;l<this.keys.length;l+=1){const u=this.keys[l];this.values[l]===c&&(o.innerHTML=u);const p=document.createElement("div");p.className="gui_select_option",p.innerHTML=u,p.dataset.value=l.toString(),i.append(p),p.onclick=(function(){const L=this.values[parseInt(p.dataset.value||"")];this.value.set(L),o.innerHTML=u,o.classList.remove("gui_open"),this.onchange(L)}).bind(this),s.push(p)}this.ref_el=t,this.button_el=o,this.option_els=s}static mount(){const t=document.body.querySelector(".gui_window_root");t&&t.addEventListener("click",function(){const n=document.body.querySelector(".gui_select_button.gui_open");n&&n.classList.remove("gui_open")})}update(){const t=this.value.get();for(let n=0;n<this.option_els.length;n+=1)if(this.values[n]===t){this.button_el.innerHTML=this.keys[n];return}}}class Ue extends m{render(){const t=document.createElement("div");t.className="gui_button";const n=document.createElement("button");n.innerHTML=this.label,n.onclick=this.onclick,t.append(n),this.ref_el=t}}class je extends m{render(){const t=document.createElement("div");t.className="gui_canvas";const n=this.canvas_el??document.createElement("canvas");t.append(n),this.auto_resize&&window.addEventListener("resize",function(){var o,i;n.width=((o=n.parentElement)==null?void 0:o.clientWidth)||0,n.height=((i=n.parentElement)==null?void 0:i.clientHeight)||0}),this.ref_el=t,this.canvas_el=n}mount(){var t,n;this.auto_resize&&(this.canvas_el.width=((t=this.canvas_el.parentElement)==null?void 0:t.clientWidth)||0,this.canvas_el.height=((n=this.canvas_el.parentElement)==null?void 0:n.clientHeight)||0)}}const $t=[Oe,He,Ke,Ht,Kt,Ie,It,Dt,Ut,jt,Xt,De,Ue,je];let me=0;function de(e,t=""){const n=new Oe;return n.id=me,n.title=t,n.grid_x=[],n.grid_y=[],n.layout=[],n.window_parent=e,n.window_children=[],n.parent=e,e&&(e.children.push(n),e.window_children.push(n)),me+=1,n}function Ct(e,t,n){e.grid_x=t,e.grid_y=n}function Yt(e,t){const n=[];for(const o of t)n.push(o.id);e.layout=n}function Xe(e,t,n=!1){const o=new He;return o.title=t,o.is_collapsed=n,o.parent=e,e&&e.children.push(o),o}function Vt(e,t){const n=new Ke;return n.value=t,n.parent=e,e&&e.children.push(n),n}function $e(e,t,n,o,i,s,c=()=>{}){const l=new Ie;return l.label=t,l.value=n,l.step=o,l.min=i,l.max=s,l.onchange=c,l.parent=e,e&&e.children.push(l),l}function Gt(e,t,n,o,i,s=()=>{}){const c=new De;return c.label=t,c.value=n,c.keys=o,c.values=i,c.onchange=s,c.parent=e,e&&e.children.push(c),c}function Tt(e,t,n){const o=new Ue;return o.label=t,o.onclick=n,o.parent=e,e&&e.children.push(o),o}function Wt(e,t=!0){const n=new je;return n.auto_resize=t,n.parent=e,e&&e.children.push(n),n}function fe(e,t){e.render(),t.append(e.ref_el),e.mount();for(const n of e.children)fe(n,e.container())}function qt(e){var o;if(!((o=e.parent)==null?void 0:o.ref_el))return;const n=e.ref_el;e.render(),n.replaceWith(e.ref_el),e.mount();for(const i of e.children)fe(i,e.container())}function Bt(e,t,n=!0){if(fe(e,t),!!n)for(const o of $t)o.mount()}function y(e){switch(e){case 0:return h(a(3,3),[0,1,1,1,1,0,0,1,0],f(255,105,180));case 1:return h(a(1,5),[1,1,1,1,1],f(0,255,255));case 2:return h(a(2,4),[1,0,1,0,1,0,1,1],f(255,140,0));case 3:return h(a(2,4),[0,1,0,1,1,1,1,0],f(0,128,128));case 4:return h(a(2,3),[1,1,1,1,1,0],f(255,0,255));case 5:return h(a(3,3),[1,1,1,0,1,0,0,1,0],f(128,0,128));case 6:return h(a(3,2),[1,0,1,1,1,1],f(0,128,255));case 7:return h(a(3,3),[1,0,0,1,0,0,1,1,1],f(0,255,0));case 8:return h(a(3,3),[1,0,0,1,1,0,0,1,1],f(255,255,0));case 9:return h(a(3,3),[0,1,0,1,1,1,0,1,0],f(128,128,128));case 10:return h(a(2,4),[0,1,1,1,0,1,0,1],f(255,0,0));case 11:return h(a(3,3),[1,1,0,0,1,0,0,1,1],f(0,0,255))}}function Zt(){return[y(0),y(1),y(2),y(3),y(4),y(5),y(6),y(7),y(8),y(9),y(10),y(11)]}const V=de(null);Ct(V,[O(300,M.PX),O(1,M.FR),O(300,M.PX)],[O(1,M.FR),O(1,M.FR),O(1,M.FR)]);const H=de(V),x=de(V);Yt(V,[H,x,x,H,x,x,H,x,x]);const Jt=Wt(x);Bt(V,document.body);const v=document.createElement("div");v.style.position="absolute";v.style.left="0";v.style.top="0";v.style.width="100%";v.style.height="100%";v.style.fontSize="32px";v.style.color="#ffffff";v.style.padding="16px";v.style.textAlign="center";v.style.fontFamily="monospace";x.ref_el.append(v);x.ref_el.style.position="relative";x.ref_el.style.overflow="hidden";const R=Jt.canvas_el,w=Te(R);ut();const S={width:10,height:20,pack:0},Ce=[Pe(),Zt()],_=Lt(a(S.width,S.height),a(1));_.polyominos=Ce[S.pack];ae(_);const J=ct();function Ye(){const e=xe(_.grid_size,ke(_.cell_size,.05)),t=Math.max(e[0],e[1]),n=Math.min(R.width,R.height);J.scale=n*2/t}Ye();const K=Me();le(K,_.len);bt();re(K);function Qt(){_.grid_size[0]=S.width,_.grid_size[1]=S.height,Re(_),le(K,_.len),re(K),Ye(),_.polyominos=Ce[S.pack],ae(_)}const Ve=Me();le(Ve,5);re(Ve);at(function(e){e.code==="KeyR"&&ae(_),!_.is_paused&&(e.code==="KeyC"&&Mt(_),e.code==="KeyZ"&&ie(_,-1),e.code==="ArrowUp"&&ie(_,1),e.code==="KeyX"&&ie(_,2),e.code==="Space"&&Ae(_))});let ve=performance.now(),se=0,W=0;const en=.1,tn=.1;function nn(){const e=performance.now(),t=(e-ve)/1e3;ve=e,lt(J,R.width,R.height),rt(J),_.is_paused||(se+=t,W+=t,se>=en&&(ne("ArrowLeft")?X(_,a(-1,0)):ne("ArrowRight")?X(_,a(1,0)):ne("ArrowDown")&&X(_,a(0,1)),se=0),W>=tn&&(X(_,a(0,1)),Y(_,a(0,1),0)||(_.lock_timer-=W,_.lock_timer<=0&&Ae(_)),W=0))}w.enable(w.BLEND);w.blendFunc(w.SRC_ALPHA,w.ONE_MINUS_SRC_ALPHA);w.enable(w.CULL_FACE);function on(){w.viewport(0,0,R.width,R.height),w.clearColor(0,0,0,1),w.clear(w.COLOR_BUFFER_BIT|w.DEPTH_BUFFER_BIT);for(let e=0;e<_.len;e+=1){const t=_.cells[e];yt(K,e,t.position,_.cell_size,0,0,t.state===B.EMPTY?T(10,10,10,255):T(t.color[0],t.color[1],t.color[2],255),t.state===B.EMPTY?T(50,50,50,255):T(t.color[0]/2,t.color[1]/2,t.color[2]/2,255),t.state===B.EMPTY?.1:.2)}wt(K,J),_.is_paused?v.innerHTML=`Score: ${_.score}<br>Game Over<br>Press R to Restart`:v.innerHTML=`Score: ${_.score}`}function Ge(){nn(),on(),requestAnimationFrame(Ge)}Ge();const sn=Xe(H,"Controls");Vt(sn,`
    Arrow Down - Move Down<br>
    Arrow Right - Move Right<br>
    Z - Rotate Left<br>
    Arrow Up - Rotate Right<br>
    X - Rotate 180<br>
    C - Store Piece / Place Stored Piece<br>
    Space - Place Piece<br>
    R - Reset
`);const ee=Xe(H,"General");$e(ee,"Width",_e(S,"width"),1,1,100);$e(ee,"Width",_e(S,"height"),1,1,100);Gt(ee,"Pack",_e(S,"pack"),["Tetromino","Pentomino"],[0,1]);Tt(ee,"Reload",function(){Qt()});qt(H);
