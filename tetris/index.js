(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();let l;function Le(e){return l=e.getContext("webgl2")}function ze(e,t){const n=l.createShader(e);if(!n)return null;if(l.shaderSource(n,t),l.compileShader(n),!l.getShaderParameter(n,l.COMPILE_STATUS)){const i=l.getShaderInfoLog(n);return console.error(i),l.deleteShader(n),null}return n}function Ne(e){const t=l.createProgram(),n=[];for(const i in e){const s=e[i],c=ze(parseInt(i),s);if(!c){for(const r of n)l.deleteShader(r);return null}n.push(c)}for(const i of n)l.attachShader(t,i);l.linkProgram(t);for(const i of n)l.detachShader(t,i),l.deleteShader(i);if(!l.getProgramParameter(t,l.LINK_STATUS)){const i=l.getProgramInfoLog(t);return console.error(i),l.deleteProgram(t),null}return t}function z(e,t){return(e+t)%t}function H(e,t,n){return t*n+e}const Me=Float32Array;function ce(e=1,t=0,n=0,o=0,i=0,s,c=0,r=0,a=0,_=0,d,b=0,C=0,w=0,K=0,T){const p=new Me(16);return p[0]=e,p[1]=t,p[2]=n,p[3]=o,p[4]=i,p[5]=e,p[6]=c,p[7]=r,p[8]=a,p[9]=_,p[10]=e,p[11]=b,p[12]=C,p[13]=w,p[14]=K,p[15]=e,p}function _e(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}function Ae(e,t,n){const o=n[0],i=n[1],s=n[2];e[12]=t[0]*o+t[4]*i+t[8]*s+t[12],e[13]=t[1]*o+t[5]*i+t[9]*s+t[13],e[14]=t[2]*o+t[6]*i+t[10]*s+t[14],e[15]=t[3]*o+t[7]*i+t[11]*s+t[15]}function Pe(e,t,n){const o=n[0],i=n[1],s=n[2];e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}const P=Float32Array;function u(e=0,t){const n=new P(2);return n[0]=e,n[1]=t??e,n}function Re(e,t,n){e[0]=t,e[1]=n}function Oe(e,t){e[0]=t[0],e[1]=t[1]}function D(e){const t=new P(2);return Oe(t,e),t}function de(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1]}function Ke(e,t){const n=new P(2);return de(n,e,t),n}function fe(e,t){de(e,e,t)}function He(e,t,n){e[0]=t[0]*n[0],e[1]=t[1]*n[1]}function pe(e,t){const n=new P(2);return He(n,e,t),n}function Ie(e,t,n){e[0]=t[0]+n,e[1]=t[1]+n}function Ue(e,t){const n=new P(2);return Ie(n,e,t),n}function De(e,t,n){e[0]=t[0]*n,e[1]=t[1]*n}function le(e,t){const n=new P(2);return De(n,e,t),n}const he=Float32Array;function v(e=0,t,n){const o=new he(3);return o[0]=e,o[1]=t??e,o[2]=n??e,o}function te(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2]}function ge(e){const t=new he(3);return te(t,e),t}function me(e){e[0]=0,e[1]=0,e[2]=0}class je{}function Xe(){const e=new je;return e.position=u(),e.right=u(1,0),e.up=u(0,1),e.world_up=u(0,1),e.projection=ce(1),e.near=-100,e.far=100,e.view=ce(1),e.scale=50,e.roll=0,e.movement_speed=.1,e.roll_speed=.1,e.zoom_speed=.1,e}function Ce(e,t,n){return _e(e.projection),Pe(e.projection,e.projection,v(e.scale/t,e.scale/n,1)),e.projection}function $e(e){return _e(e.view),Ae(e.view,e.view,v(-e.position[0],-e.position[1],0)),e.view}const m={keys:{},buttons:{},kb_key_down:function(){},kb_key_up:function(){},m_move:function(){},m_button_down:function(){},m_button_up:function(){},m_wheel_scroll:function(){}};function Ye(e){m.kb_key_down=e}function Ve(){addEventListener("keydown",function(e){m.keys[e.code]=0,m.kb_key_down({code:e.code,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,event:e})}),addEventListener("keyup",function(e){m.keys[e.code]=1,m.kb_key_up({code:e.code,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,event:e})}),addEventListener("mousemove",function(e){m.m_move({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target,event:e})}),addEventListener("mousedown",function(e){m.buttons[e.button]=0,m.m_button_down({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target,event:e})}),addEventListener("mouseup",function(e){m.buttons[e.button]=1,m.m_button_up({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target,event:e})}),addEventListener("wheel",function(e){m.m_wheel_scroll({xd:Math.sign(e.deltaX),yd:Math.sign(e.deltaY),event:e})})}const Ge=Float32Array;function $(e=0,t,n,o){const i=new Ge(4);return i[0]=e,i[1]=t??e,i[2]=n??e,i[3]=o,i}function re(e){return((e[0]&255)<<24|(e[1]&255)<<16|(e[2]&255)<<8|e[3]&255)>>>0}var M=(e=>(e[e.S8=0]="S8",e[e.U8=1]="U8",e[e.S16=2]="S16",e[e.U16=3]="U16",e[e.S32=4]="S32",e[e.U32=5]="U32",e[e.F32=6]="F32",e))(M||{});const ve={0:1,1:1,2:2,3:2,4:4,5:4,6:4};function qe(e){switch(e){case 0:return l.BYTE;case 1:return l.UNSIGNED_BYTE;case 2:return l.SHORT;case 3:return l.UNSIGNED_SHORT;case 4:return l.INT;case 5:return l.UNSIGNED_INT;case 6:return l.FLOAT;default:return l.FLOAT}}class Be{}function We(e,t){const n=new Be;return n.type=e,n.size=t,n}class Te{}function Ze(){const e=new Te;return e.attribs=[],e.stride=0,e}function R(e,t,n){const o=We(t,n);return e.attribs.push(o),e.stride+=ve[o.type]*o.size,o}function Je(e,t=!1){const n=e.attribs;let o=0;for(let i=0;i<n.length;i+=1){const s=n[i],c=qe(s.type);l.enableVertexAttribArray(i),s.type===6?l.vertexAttribPointer(i,s.size,c,!1,e.stride,o):l.vertexAttribIPointer(i,s.size,c,e.stride,o),t&&l.vertexAttribDivisor(i,1),o+=ve[s.type]*s.size}}let Y,ye,be,Q,ee;const y=Ze();R(y,M.F32,3);R(y,M.F32,2);R(y,M.F32,1);R(y,M.S32,1);R(y,M.S32,1);R(y,M.F32,1);class Qe{}function et(){const e=new Qe;return e.data=new ArrayBuffer(0),e.len=0,e.cap=0,e.instances=[],e}function tt(e,t){const n=new ArrayBuffer(t*y.stride),o=[];for(let i=0;i<t;i+=1)o.push(new DataView(n,i*y.stride,y.stride));e.data=n,e.len=t,e.cap=t,e.instances=o}function nt(e,t,n,o,i,s,c,r,a){const _=e.instances[t];_.setFloat32(0,n[0],!0),_.setFloat32(4,n[1],!0),_.setFloat32(8,s,!0),_.setFloat32(12,o[0],!0),_.setFloat32(16,o[1],!0),_.setFloat32(20,i,!0),_.setInt32(24,re(c),!0),_.setInt32(28,re(r),!0),_.setFloat32(32,a,!0)}function ot(){Y=Ne({[l.VERTEX_SHADER]:`#version 300 es
            layout(location = 0) in vec3 i_position;
            layout(location = 1) in vec2 i_size;
            layout(location = 2) in float i_rotation;
            layout(location = 3) in int i_inner_color;
            layout(location = 4) in int i_outer_color;
            layout(location = 5) in float i_outline;
            out vec2 v_size;
            flat out int v_inner_color;
            flat out int v_outer_color;
            flat out float v_outline;
            out vec2 v_tex_coord;
            uniform mat4 u_projection;
            uniform mat4 u_view;

            const vec2 positions[4] = vec2[](
                vec2(-0.5, -0.5),
                vec2(0.5, -0.5),
                vec2(-0.5, 0.5),
                vec2(0.5, 0.5)
            );

            const vec2 tex_coords[4] = vec2[](
                vec2(0.0, 0.0),
                vec2(1.0, 0.0),
                vec2(0.0, 1.0),
                vec2(1.0, 1.0)
            );

            vec2 rotate(vec2 p, float r) {
                float c = cos(r), s = sin(r);

                return vec2(
                    p.x * c - p.y * s,
                    p.x * s + p.y * c
                );
            }

            void main() {
                vec2 position = rotate(positions[gl_VertexID] * i_size, i_rotation) + i_position.xy;

                gl_Position = u_projection * u_view * vec4(position, i_position.z, 1.0);
                v_size = i_size;
                v_inner_color = i_inner_color;
                v_outer_color = i_outer_color;
                v_outline = i_outline;
                v_tex_coord = tex_coords[gl_VertexID];
            }
        `,[l.FRAGMENT_SHADER]:`#version 300 es
            precision highp float;
            out vec4 o_frag_color;
            in vec2 v_size;
            in vec2 v_tex_coord;
            flat in int v_inner_color;
            flat in int v_outer_color;
            flat in float v_outline;
            in vec3 v_params;

            vec4 unpack256(int packed) {
                return vec4(
                    (packed >> 24) & 0xFF,
                    (packed >> 16) & 0xFF,
                    (packed >> 8) & 0xFF,
                    packed & 0xFF
                ) / 255.0;
            }

            float uv_border_width(vec2 uv, vec2 size) {
                float left = smoothstep(0.0, size.x, uv.x);
                float right = smoothstep(0.0, size.x, 1.0 - uv.x);
                float bottom = smoothstep(0.0, size.y, 1.0 - uv.y);
                float top = smoothstep(0.0, size.y, uv.y);

                return min(min(left, right), min(top, bottom));
            }

            void main() {
                vec2 uv = v_tex_coord;
                vec4 inner_color = unpack256(v_inner_color);
                vec4 outer_color = unpack256(v_outer_color);
                float mask = v_outline == 0.0 ? 1.0 : uv_border_width(uv, v_outline / v_size);
                vec4 color = mix(vec4(outer_color.xyz, 1.0), inner_color, mask);

                o_frag_color = color;
            }
        `}),ye=l.getUniformLocation(Y,"u_projection"),be=l.getUniformLocation(Y,"u_view")}function it(e){Q=l.createVertexArray(),l.bindVertexArray(Q),ee=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,ee),l.bufferData(l.ARRAY_BUFFER,e.data,l.STATIC_DRAW),Je(y,!0)}function st(e,t){l.useProgram(Y),l.uniformMatrix4fv(ye,!1,t.projection),l.uniformMatrix4fv(be,!1,t.view),l.bindVertexArray(Q),l.bindBuffer(l.ARRAY_BUFFER,ee),l.bufferSubData(l.ARRAY_BUFFER,0,e.data),l.drawArraysInstanced(l.TRIANGLE_STRIP,0,4,e.len)}class ct{}function E(e,t,n){const o=new ct;return o.size=D(e),o.cells=[...t],o.color=ge(n),o}function S(e){switch(e){case 0:return E(u(4,1),[1,1,1,1],v(0,255,255));case 1:return E(u(2,3),[0,1,0,1,1,1],v(0,0,255));case 2:return E(u(2,3),[1,0,1,0,1,1],v(255,165,0));case 3:return E(u(2,2),[1,1,1,1],v(255,255,0));case 4:return E(u(3,2),[0,1,1,1,1,0],v(0,255,0));case 5:return E(u(3,2),[1,1,1,0,1,0],v(128,0,128));case 6:return E(u(3,2),[1,1,0,0,1,1],v(255,0,0))}}function lt(){return[S(0),S(1),S(2),S(3),S(4),S(5),S(6)]}var V=(e=>(e[e.EMPTY=0]="EMPTY",e[e.MOVING=1]="MOVING",e[e.LOCKED=2]="LOCKED",e))(V||{});class rt{}function at(e,t,n){const o=new rt;return o.state=e,o.position=D(t),o.color=ge(n),o}class ut{}function _t(e,t,n){const o=new ut;return o.polyomino=e,o.position=D(t),o.rotation=n,o}class dt{}function ft(e,t){const n=new dt;n.grid_size=D(e),n.cell_size=D(t),n.cells=[],n.len=e[0]*e[1],n.polyominos=lt(),n.poly_index=0,n.piece=_t(n.polyominos[0],u(),0),n.stored=null,n.has_swapped=!1,n.lock_delay=n.lock_timer=1;const i=Ue(t,.05),s=pe(e,i),c=le(s,.5),r=le(i,.5);for(let a=0;a<n.len;a+=1){const _=a%e[0],d=-Math.floor(a/e[0]),b=u(_*i[0]-c[0]+r[0],d*i[1]+c[1]-r[1]);n.cells.push(at(0,b,v()))}return n}function j(e,t,n){const o=e.piece,i=o.polyomino,s=Ke(o.position,t),c=(o.rotation+n)%4;for(let r=0;r<i.size[0];r+=1)for(let a=0;a<i.size[1];a+=1){let _=0,d=0;switch(c%4){case 0:_=r,d=a;break;case 1:_=i.size[1]-1-a,d=r;break;case 2:_=i.size[0]-1-r,d=i.size[1]-1-a;break;case 3:_=a,d=i.size[0]-1-r;break}const b=a*i.size[0]+r;if(!i.cells[b])continue;const w=_+s[0],K=d+s[1];if(w<0||w>=e.grid_size[0]||K<0||K>=e.grid_size[1])return!1;const T=H(w,K,e.grid_size[0]);if(T>=e.len||e.cells[T].state===2)return!1}return!0}function x(e,t){const n=e.piece,o=n.polyomino,i=n.position,s=n.rotation;for(let c=0;c<o.size[0];c+=1)for(let r=0;r<o.size[1];r+=1){let a=0,_=0;switch(s%4){case 0:a=c,_=r;break;case 1:a=o.size[1]-1-r,_=c;break;case 2:a=o.size[0]-1-c,_=o.size[1]-1-r;break;case 3:a=r,_=o.size[0]-1-c;break}const d=r*o.size[0]+c;if(!o.cells[d])continue;const C=H(z(a+i[0],e.grid_size[0]),z(_+i[1],e.grid_size[1]),e.grid_size[0]),w=e.cells[C];w.state=t,t===0?me(w.color):te(w.color,o.color)}}function G(e,t){const n=e.piece;if(n.polyomino=t,Re(e.piece.position,Math.floor(e.grid_size[0]/2-t.size[0]/2),0),!j(e,u(),0)){ne(e);return}x(e,1)}function I(e,t){if(!j(e,t,0))return;const n=e.piece;x(e,0),fe(n.position,t),x(e,1)}const Z=[u(0,0),u(-1,0),u(1,0),u(0,-1),u(0,1),u(-1,-1),u(-1,1),u(1,-1),u(1,1),u(0,-2),u(0,-3)];function J(e,t){let n=-1;for(let s=0;s<Z.length;s+=1){const c=Z[s];if(j(e,c,t)){n=s;break}}if(n<0)return;const o=e.piece,i=Z[n];x(e,0),fe(o.position,i),o.rotation=z(o.rotation+t,4),x(e,1)}function pt(e){const t=e.grid_size[0],n=e.grid_size[1];for(let o=0;o<n;o+=1){let i=!0;for(let s=0;s<t;s+=1){const c=H(s,o,t);if(e.cells[c].state===0){i=!1;break}}if(i)for(let s=o;s>0;s-=1)for(let c=0;c<t;c+=1){const r=H(c,s,t),a=H(c,s-1,t),_=e.cells[r],d=e.cells[a];_.state=d.state,te(_.color,d.color)}}}function ne(e){for(const t of e.cells)t.state=0,me(t.color);e.poly_index=z(e.poly_index+1,e.polyominos.length),G(e,e.polyominos[e.poly_index])}function we(e){for(;j(e,u(0,1),0);)I(e,u(0,1));x(e,2),pt(e),e.poly_index=z(e.poly_index+1,e.polyominos.length),G(e,e.polyominos[e.poly_index]),e.has_swapped=!1,e.lock_timer=e.lock_delay}function ht(e){if(!e.stored)e.stored=e.piece.polyomino,e.poly_index=z(e.poly_index+1,e.polyominos.length),x(e,0),G(e,e.polyominos[e.poly_index]),e.has_swapped=!0;else if(!e.has_swapped){const t=e.stored;e.stored=e.piece.polyomino,e.poly_index=z(e.poly_index+1,e.polyominos.length),x(e,0),e.piece.polyomino=t,G(e,t),e.has_swapped=!0}}function oe(e,t,n){return Math.min(Math.max(e,t),n)}var F=(e=>(e[e.PX=0]="PX",e[e.PCT=1]="PCT",e[e.FR=2]="FR",e))(F||{});const gt={0:"px",1:"%",2:"fr"};class mt{}function A(e,t){const n=new mt;return n.x=e,n.u=t,n}function vt(e){return`${e.x}${gt[e.u]}`}function k(e,t){if(!e)return null;const n=document.createElement("span");return n.className="gui_label",n.innerHTML=e,t.append(n),n}function O(){const e=document.createElement("div");return e.className="gui_container",e}function W(e,t,n,o,i){const s=document.createElement("input");return s.className="gui_input",s.type=e,s.step=n.toString(),s.min=o.toString(),s.max=i.toString(),s.value=t.toString(),s}class h{constructor(){this.children=[]}container(){return this.ref_el}render(){}mount(){}static mount(){}update(){}}class xe extends h{grid_str(t){let n="";for(let o=0;o<t.length;o+=1){const i=t[o];n+=vt(i),o<t.length-1&&(n+=" ")}return n}layout_str(){let t="";const n=this.grid_x.length,o=this.grid_y.length,i=n*o;for(let s=0;s<i;s+=n){let c="";for(let r=s;r<s+n;r+=1){const a=this.layout[r];c+=`w${a}`,r<s+n-1&&(c+=" ")}t+=`"${c}"
`}return t}render(){const t=document.createElement("div");this.window_parent?t.className="gui_window":t.className="gui_window_root",this.window_children.length?(t.style.display="grid",t.style.gridTemplateColumns=this.grid_str(this.grid_x),t.style.gridTemplateRows=this.grid_str(this.grid_y),t.style.gridTemplateAreas=this.layout_str()):t.style.gridArea=`w${this.id}`,this.ref_el=t}}class ke extends h{container(){return this.container_el}render(){const t=document.createElement("div");t.className="gui_collapsing_header"+(this.is_collapsed?" gui_is_collapsed":"");const n=document.createElement("div");n.className="gui_title",n.innerHTML=this.title,t.append(n),n.onclick=(function(){this.is_collapsed?(this.is_collapsed=!1,t.classList.remove("gui_is_collapsed")):(this.is_collapsed=!0,t.classList.add("gui_is_collapsed"))}).bind(this);const o=O();t.append(o),this.ref_el=t,this.container_el=o}}class Ee extends h{render(){const t=document.createElement("div");t.className="gui_text",t.innerHTML=this.value,this.ref_el=t}}class yt extends h{render(){const t=document.createElement("div");t.className="gui_bool";const n=document.createElement("div");n.className="gui_checkbox_group_option"+(this.value.get()?" gui_selected":""),n.innerHTML=this.label,t.append(n),n.onclick=(function(){this.value.get()?(this.value.set(!1),n.classList.remove("gui_selected")):(this.value.set(!0),n.classList.add("gui_selected")),this.onchange(this.value.get())}).bind(this),this.ref_el=t,this.input_el=n}update(){this.value.get()?this.input_el.classList.add("gui_selected"):this.input_el.classList.remove("gui_selected")}}class bt extends h{render(){const t=document.createElement("div");t.className="gui_input_number",k(this.label,t);const n=W("number",this.value.get(),this.step,this.min,this.max);t.append(n),n.onchange=(function(){const o=oe(parseFloat(n.value),this.min,this.max);this.value.set(o),n.value=o.toString(),this.onchange(o)}).bind(this),this.ref_el=t,this.input_el=n}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString())}}class wt extends h{render(){const t=document.createElement("div");t.className="gui_slider_number",k(this.label,t);const n=O();n.className="gui_input_range_container",t.append(n);const o=W("range",this.value.get(),this.step,this.min,this.max);o.className="gui_input_range",n.dataset.content=o.value,n.append(o),o.onchange=(function(){const i=oe(parseFloat(o.value),this.min,this.max);this.value.set(i),n.dataset.content=o.value,this.onchange(i)}).bind(this),o.onmousemove=function(){n.dataset.content=o.value},this.ref_el=t,this.container_el=n,this.input_el=o}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString(),this.container_el.dataset.content=this.input_el.value)}}class xt extends h{render(){const t=document.createElement("div");t.className="gui_input_vec",t.style.setProperty("--size",this.size.toString()),k(this.label,t);const n=O();t.append(n);const o=[];for(let i=0;i<this.value.length;i+=1){const s=W("number",this.value[i],this.step,this.min,this.max);n.append(s),s.onchange=(function(){const c=oe(parseFloat(s.value),this.min,this.max);this.value[i]=c,s.value=c.toString(),this.onchange(this.value)}).bind(this),o.push(s)}this.ref_el=t,this.input_els=o}update(){for(let t=0;t<this.value.length;t+=1){const n=this.input_els[t];document.activeElement!=n&&(n.value=this.value[t].toString())}}}class kt extends h{to_hex(t,n,o){const i=this.mode===0?255:1,s=Math.round(t*i).toString(16).padStart(2,"0"),c=Math.round(n*i).toString(16).padStart(2,"0"),r=Math.round(o*i).toString(16).padStart(2,"0");return`#${s}${c}${r}`}from_hex(t){const n=t.replace(/^#/,""),o=this.mode===0?255:1,i=parseInt(n.substring(0,2),16)/o,s=parseInt(n.substring(2,4),16)/o,c=parseInt(n.substring(4,6),16)/o;return[i,s,c]}render(){const t=document.createElement("div");t.className="gui_color_edit"+(this.value.length===4?" gui_rgba":""),k(this.label,t);const n=O();t.append(n);const o=document.createElement("input");if(o.className="gui_input_color",o.type="color",o.value=this.to_hex(this.value[0],this.value[1],this.value[2]),n.append(o),o.onchange=(function(){const i=this.from_hex(o.value);this.value[0]=i[0],this.value[1]=i[1],this.value[2]=i[2],this.onchange(this.value)}).bind(this),this.value.length==4){const i=document.createElement("div");i.className="gui_input_range_container",n.append(i);const s=W("range",this.value[3],.01,0,1);s.className="gui_input_range",i.dataset.content=s.value,i.append(s),s.onchange=(function(){this.value[3]=parseFloat(s.value)*(this.mode===1?255:1),i.dataset.content=s.value,this.onchange(this.value)}).bind(this),s.onmousemove=function(){i.dataset.content=s.value},this.range_el=s,this.range_container_el=i}this.ref_el=t,this.input_el=o}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.to_hex(this.value[0],this.value[1],this.value[2])),this.range_container_el&&this.range_el&&document.activeElement!=this.range_el&&(this.range_el.value=this.value[3].toString(),this.range_container_el.dataset.content=this.range_el.value)}}class Et extends h{render(){const t=document.createElement("div");t.className="gui_input_text",k(this.label,t);const n=document.createElement("input");n.className="gui_input",n.type="text",n.value=this.value.get().toString(),t.append(n),n.onchange=(function(){this.value.set(n.value),this.onchange(n.value)}).bind(this),this.ref_el=t,this.input_el=n}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString())}}class St extends h{render(){const t=document.createElement("div");t.className="gui_radio_group",k(this.label,t);const n=O();t.append(n);const o=[],i=this.value.get();for(let s=0;s<this.keys.length;s+=1){const c=this.keys[s],r=this.values[s],a=document.createElement("div");a.className="gui_radio_group_option"+(r===i?" gui_selected":""),a.innerHTML=c,n.append(a),a.onclick=(function(){this.value.set(r);for(const _ of this.option_els)_.classList.remove("gui_selected");a.classList.add("gui_selected"),this.onchange(r)}).bind(this),o.push(a)}this.ref_el=t,this.option_els=o}update(){const t=this.value.get();for(let n=0;n<this.option_els.length;n+=1){const o=this.option_els[n];this.values[n]===t?o.classList.add("gui_selected"):o.classList.remove("gui_selected")}}}class Ft extends h{render(){const t=document.createElement("div");t.className="gui_checkbox_group",k(this.label,t);const n=O();t.append(n);const o=[],i=this.value.get();for(let s=0;s<this.keys.length;s+=1){const c=this.keys[s],r=this.values[s],a=document.createElement("div");a.className="gui_checkbox_group_option"+(i.indexOf(r)>-1?" gui_selected":""),a.innerHTML=c,n.append(a),a.onclick=(function(){a.classList.contains("gui_selected")?(i.splice(i.indexOf(r),1),a.classList.remove("gui_selected")):(i.push(r),a.classList.add("gui_selected")),this.onchange(this.value.get())}).bind(this),o.push(a)}this.ref_el=t,this.option_els=o}update(){const t=this.value.get();for(let n=0;n<this.option_els.length;n+=1){const o=this.option_els[n];t.indexOf(this.values[n])>-1?o.classList.add("gui_selected"):o.classList.remove("gui_selected")}}}class Lt extends h{render(){const t=document.createElement("div");t.className="gui_select",k(this.label,t);const n=document.createElement("div");n.className="gui_select",t.append(n),n.onclick=function(r){r.stopPropagation()};const o=document.createElement("div");o.className="gui_select_button",o.innerHTML="Select",n.append(o),o.onclick=function(){o.classList.contains("gui_open")?o.classList.remove("gui_open"):o.classList.add("gui_open")};const i=document.createElement("div");i.className="gui_select_container",n.append(i);const s=[],c=this.value.get();for(let r=0;r<this.keys.length;r+=1){const a=this.keys[r];this.values[r]===c&&(o.innerHTML=a);const d=document.createElement("div");d.className="gui_select_option",d.innerHTML=a,d.dataset.value=r.toString(),i.append(d),d.onclick=(function(){const b=this.values[parseInt(d.dataset.value||"")];this.value.set(b),o.innerHTML=a,o.classList.remove("gui_open"),this.onchange(b)}).bind(this),s.push(d)}this.ref_el=t,this.button_el=o,this.option_els=s}static mount(){const t=document.body.querySelector(".gui_window_root");t&&t.addEventListener("click",function(){const n=document.body.querySelector(".gui_select_button.gui_open");n&&n.classList.remove("gui_open")})}update(){const t=this.value.get();for(let n=0;n<this.option_els.length;n+=1)if(this.values[n]===t){this.button_el.innerHTML=this.keys[n];return}}}class zt extends h{render(){const t=document.createElement("div");t.className="gui_button";const n=document.createElement("button");n.innerHTML=this.label,n.onclick=this.onclick,t.append(n),this.ref_el=t}}class Se extends h{render(){const t=document.createElement("div");t.className="gui_canvas";const n=this.canvas_el??document.createElement("canvas");t.append(n),this.auto_resize&&window.addEventListener("resize",function(){var o,i;n.width=((o=n.parentElement)==null?void 0:o.clientWidth)||0,n.height=((i=n.parentElement)==null?void 0:i.clientHeight)||0}),this.ref_el=t,this.canvas_el=n}mount(){var t,n;this.auto_resize&&(this.canvas_el.width=((t=this.canvas_el.parentElement)==null?void 0:t.clientWidth)||0,this.canvas_el.height=((n=this.canvas_el.parentElement)==null?void 0:n.clientHeight)||0)}}const Nt=[xe,ke,Ee,yt,bt,wt,xt,kt,Et,St,Ft,Lt,zt,Se];let ae=0;function ie(e,t=""){const n=new xe;return n.id=ae,n.title=t,n.grid_x=[],n.grid_y=[],n.layout=[],n.window_parent=e,n.window_children=[],n.parent=e,e&&(e.children.push(n),e.window_children.push(n)),ae+=1,n}function Mt(e,t,n){e.grid_x=t,e.grid_y=n}function At(e,t){const n=[];for(const o of t)n.push(o.id);e.layout=n}function Pt(e,t,n=!1){const o=new ke;return o.title=t,o.is_collapsed=n,o.parent=e,e&&e.children.push(o),o}function Rt(e,t){const n=new Ee;return n.value=t,n.parent=e,e&&e.children.push(n),n}function Ot(e,t=!0){const n=new Se;return n.auto_resize=t,n.parent=e,e&&e.children.push(n),n}function se(e,t){e.render(),t.append(e.ref_el),e.mount();for(const n of e.children)se(n,e.container())}function Kt(e){var o;if(!((o=e.parent)==null?void 0:o.ref_el))return;const n=e.ref_el;e.render(),n.replaceWith(e.ref_el),e.mount();for(const i of e.children)se(i,e.container())}function Ht(e,t,n=!0){if(se(e,t),!!n)for(const o of Nt)o.mount()}const X=ie(null);Mt(X,[A(300,F.PX),A(1,F.FR),A(300,F.PX)],[A(1,F.FR),A(1,F.FR),A(1,F.FR)]);const U=ie(X),L=ie(X);At(X,[U,L,L,U,L,L,U,L,L]);const It=Ot(L);Ht(X,document.body);const N=It.canvas_el,g=Le(N);Ve();const f=ft(u(10,20),u(1));ne(f);const ue=pe(f.grid_size,f.cell_size),Ut=Math.max(ue[0],ue[1]),Dt=Math.min(N.width,N.height),jt=2,q=Xe();q.scale=Dt*2/(Ut+jt);const B=et();tt(B,f.len);ot();it(B);Ye(function(e){e.code==="ArrowLeft"&&I(f,u(-1,0)),e.code==="ArrowRight"&&I(f,u(1,0)),e.code==="ArrowDown"&&I(f,u(0,1)),e.code==="KeyC"&&ht(f),e.code==="KeyZ"&&J(f,-1),e.code==="ArrowUp"&&J(f,1),e.code==="KeyX"&&J(f,2),e.code==="Space"&&we(f),e.code==="KeyR"&&ne(f)});setInterval(()=>{I(f,u(0,1)),j(f,u(0,1),0)||(f.lock_timer-=.1,f.lock_timer<=0&&we(f))},100);function Xt(){Ce(q,N.width,N.height),$e(q)}g.enable(g.BLEND);g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA);g.enable(g.CULL_FACE);function Ct(){g.viewport(0,0,N.width,N.height),g.clearColor(0,0,0,1),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);for(let e=0;e<f.len;e+=1){const t=f.cells[e];nt(B,e,t.position,f.cell_size,0,0,t.state===V.EMPTY?$(10,10,10,255):$(t.color[0],t.color[1],t.color[2],255),t.state===V.EMPTY?$(50,50,50,255):$(t.color[0]/2,t.color[1]/2,t.color[2]/2,255),t.state===V.EMPTY?.1:.2)}st(B,q)}function Fe(){Xt(),Ct(),requestAnimationFrame(Fe)}Fe();const $t=Pt(U,"Controls");Rt($t,`
    Arrow Left - Move Left<br>
    Arrow Right - Move Right<br>
    Z - Rotate Left<br>
    Arrow Up - Rotate Right<br>
    X - Rotate 180<br>
    C - Store Piece / Place Stored Piece<br>
    Space - Place Piece<br>
    R - Reset
`);Kt(U);
