(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();let r;function Be(e){return r=e.getContext("webgl2")}function Te(e,t){const n=r.createShader(e);if(!n)return null;if(r.shaderSource(n,t),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS)){const i=r.getShaderInfoLog(n);return console.error(i),r.deleteShader(n),null}return n}function Ze(e){const t=r.createProgram(),n=[];for(const i in e){const s=e[i],c=Te(parseInt(i),s);if(!c){for(const l of n)r.deleteShader(l);return null}n.push(c)}for(const i of n)r.attachShader(t,i);r.linkProgram(t);for(const i of n)r.detachShader(t,i),r.deleteShader(i);if(!r.getProgramParameter(t,r.LINK_STATUS)){const i=r.getProgramInfoLog(t);return console.error(i),r.deleteProgram(t),null}return t}function A(e,t){return(e+t)%t}function D(e,t,n){return t*n+e}const Je=Float32Array;function ve(e=1,t=0,n=0,o=0,i=0,s,c=0,l=0,_=0,d=0,g,L=0,b=0,k=0,V=0,ie){const h=new Je(16);return h[0]=e,h[1]=t,h[2]=n,h[3]=o,h[4]=i,h[5]=e,h[6]=c,h[7]=l,h[8]=_,h[9]=d,h[10]=e,h[11]=L,h[12]=b,h[13]=k,h[14]=V,h[15]=e,h}function ze(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}function Qe(e,t,n){const o=n[0],i=n[1],s=n[2];e[12]=t[0]*o+t[4]*i+t[8]*s+t[12],e[13]=t[1]*o+t[5]*i+t[9]*s+t[13],e[14]=t[2]*o+t[6]*i+t[10]*s+t[14],e[15]=t[3]*o+t[7]*i+t[11]*s+t[15]}function et(e,t,n){const o=n[0],i=n[1],s=n[2];e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}const C=Float32Array;function a(e=0,t){const n=new C(2);return n[0]=e,n[1]=t??e,n}function tt(e,t,n){e[0]=t,e[1]=n}function nt(e,t){e[0]=t[0],e[1]=t[1]}function q(e){const t=new C(2);return nt(t,e),t}function ke(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1]}function ot(e,t){const n=new C(2);return ke(n,e,t),n}function Se(e,t){ke(e,e,t)}function it(e,t,n){e[0]=t[0]*n[0],e[1]=t[1]*n[1]}function Ee(e,t){const n=new C(2);return it(n,e,t),n}function st(e,t,n){e[0]=t[0]+n,e[1]=t[1]+n}function ct(e,t){const n=new C(2);return st(n,e,t),n}function lt(e,t,n){e[0]=t[0]*n,e[1]=t[1]*n}function Q(e,t){const n=new C(2);return lt(n,e,t),n}const Le=Float32Array;function p(e=0,t,n){const o=new Le(3);return o[0]=e,o[1]=t??e,o[2]=n??e,o}function ue(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2]}function Fe(e){const t=new Le(3);return ue(t,e),t}function Ne(e){e[0]=0,e[1]=0,e[2]=0}class rt{}function at(){const e=new rt;return e.position=a(),e.right=a(1,0),e.up=a(0,1),e.world_up=a(0,1),e.projection=ve(1),e.near=-100,e.far=100,e.view=ve(1),e.scale=50,e.roll=0,e.movement_speed=.1,e.roll_speed=.1,e.zoom_speed=.1,e}function ut(e,t,n){return ze(e.projection),et(e.projection,e.projection,p(e.scale/t,e.scale/n,1)),e.projection}function _t(e){return ze(e.view),Qe(e.view,e.view,p(-e.position[0],-e.position[1],0)),e.view}const x={keys:{},buttons:{},kb_key_down:function(){},kb_key_up:function(){},m_move:function(){},m_button_down:function(){},m_button_up:function(){},m_wheel_scroll:function(){}};function dt(e){x.kb_key_down=e}function pt(){addEventListener("keydown",function(e){x.keys[e.code]=0,x.kb_key_down({code:e.code,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,event:e})}),addEventListener("keyup",function(e){x.keys[e.code]=1,x.kb_key_up({code:e.code,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,event:e})}),addEventListener("mousemove",function(e){x.m_move({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target,event:e})}),addEventListener("mousedown",function(e){x.buttons[e.button]=0,x.m_button_down({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target,event:e})}),addEventListener("mouseup",function(e){x.buttons[e.button]=1,x.m_button_up({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target,event:e})}),addEventListener("wheel",function(e){x.m_wheel_scroll({xd:Math.sign(e.deltaX),yd:Math.sign(e.deltaY),event:e})})}function se(e){return x.keys[e]===0}const ft=Float32Array;function H(e=0,t,n,o){const i=new ft(4);return i[0]=e,i[1]=t??e,i[2]=n??e,i[3]=o,i}function ye(e){return((e[0]&255)<<24|(e[1]&255)<<16|(e[2]&255)<<8|e[3]&255)>>>0}var O=(e=>(e[e.S8=0]="S8",e[e.U8=1]="U8",e[e.S16=2]="S16",e[e.U16=3]="U16",e[e.S32=4]="S32",e[e.U32=5]="U32",e[e.F32=6]="F32",e))(O||{});const Me={0:1,1:1,2:2,3:2,4:4,5:4,6:4};function ht(e){switch(e){case 0:return r.BYTE;case 1:return r.UNSIGNED_BYTE;case 2:return r.SHORT;case 3:return r.UNSIGNED_SHORT;case 4:return r.INT;case 5:return r.UNSIGNED_INT;case 6:return r.FLOAT;default:return r.FLOAT}}class gt{}function mt(e,t){const n=new gt;return n.type=e,n.size=t,n}class vt{}function yt(){const e=new vt;return e.attribs=[],e.stride=0,e}function X(e,t,n){const o=mt(t,n);return e.attribs.push(o),e.stride+=Me[o.type]*o.size,o}function bt(e,t=!1){const n=e.attribs;let o=0;for(let i=0;i<n.length;i+=1){const s=n[i],c=ht(s.type);r.enableVertexAttribArray(i),s.type===6?r.vertexAttribPointer(i,s.size,c,!1,e.stride,o):r.vertexAttribIPointer(i,s.size,c,e.stride,o),t&&r.vertexAttribDivisor(i,1),o+=Me[s.type]*s.size}}let J,Re,Ae;const E=yt();X(E,O.F32,3);X(E,O.F32,2);X(E,O.F32,1);X(E,O.S32,1);X(E,O.S32,1);X(E,O.F32,1);class wt{}function Pe(){const e=new wt;return e.data=new ArrayBuffer(0),e.len=0,e.cap=0,e.instances=[],e.vao=0,e.vbo=0,e}function _e(e,t){const n=new ArrayBuffer(t*E.stride),o=[];for(let i=0;i<t;i+=1)o.push(new DataView(n,i*E.stride,E.stride));e.data=n,e.len=t,e.cap=t,e.instances=o}function ce(e,t,n,o,i,s,c,l,_){const d=e.instances[t];d.setFloat32(0,n[0],!0),d.setFloat32(4,n[1],!0),d.setFloat32(8,s,!0),d.setFloat32(12,o[0],!0),d.setFloat32(16,o[1],!0),d.setFloat32(20,i,!0),d.setInt32(24,ye(c),!0),d.setInt32(28,ye(l),!0),d.setFloat32(32,_,!0)}function xt(){J=Ze({[r.VERTEX_SHADER]:`#version 300 es
            layout(location = 0) in vec3 i_position;
            layout(location = 1) in vec2 i_size;
            layout(location = 2) in float i_rotation;
            layout(location = 3) in int i_inner_color;
            layout(location = 4) in int i_outer_color;
            layout(location = 5) in float i_outline;
            out vec2 v_size;
            flat out int v_inner_color;
            flat out int v_outer_color;
            flat out float v_outline;
            out vec2 v_tex_coord;
            uniform mat4 u_projection;
            uniform mat4 u_view;

            const vec2 positions[4] = vec2[](
                vec2(-0.5, -0.5),
                vec2(0.5, -0.5),
                vec2(-0.5, 0.5),
                vec2(0.5, 0.5)
            );

            const vec2 tex_coords[4] = vec2[](
                vec2(0.0, 0.0),
                vec2(1.0, 0.0),
                vec2(0.0, 1.0),
                vec2(1.0, 1.0)
            );

            vec2 rotate(vec2 p, float r) {
                float c = cos(r), s = sin(r);

                return vec2(
                    p.x * c - p.y * s,
                    p.x * s + p.y * c
                );
            }

            void main() {
                vec2 position = rotate(positions[gl_VertexID] * i_size, i_rotation) + i_position.xy;

                gl_Position = u_projection * u_view * vec4(position, i_position.z, 1.0);
                v_size = i_size;
                v_inner_color = i_inner_color;
                v_outer_color = i_outer_color;
                v_outline = i_outline;
                v_tex_coord = tex_coords[gl_VertexID];
            }
        `,[r.FRAGMENT_SHADER]:`#version 300 es
            precision highp float;
            out vec4 o_frag_color;
            in vec2 v_size;
            in vec2 v_tex_coord;
            flat in int v_inner_color;
            flat in int v_outer_color;
            flat in float v_outline;
            in vec3 v_params;

            vec4 unpack256(int packed) {
                return vec4(
                    (packed >> 24) & 0xFF,
                    (packed >> 16) & 0xFF,
                    (packed >> 8) & 0xFF,
                    packed & 0xFF
                ) / 255.0;
            }

            float uv_border_width(vec2 uv, vec2 size) {
                float left = smoothstep(0.0, size.x, uv.x);
                float right = smoothstep(0.0, size.x, 1.0 - uv.x);
                float bottom = smoothstep(0.0, size.y, 1.0 - uv.y);
                float top = smoothstep(0.0, size.y, uv.y);

                return min(min(left, right), min(top, bottom));
            }

            void main() {
                vec2 uv = v_tex_coord;
                vec4 inner_color = unpack256(v_inner_color);
                vec4 outer_color = unpack256(v_outer_color);
                float mask = v_outline == 0.0 ? 1.0 : uv_border_width(uv, v_outline / v_size);
                vec4 color = mix(vec4(outer_color.xyz, 1.0), inner_color, mask);

                o_frag_color = color;
            }
        `}),Re=r.getUniformLocation(J,"u_projection"),Ae=r.getUniformLocation(J,"u_view")}function de(e){e.vao=r.createVertexArray(),r.bindVertexArray(e.vao),e.vbo=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,e.vbo),r.bufferData(r.ARRAY_BUFFER,e.data,r.STATIC_DRAW),bt(E,!0)}function be(e,t){r.useProgram(J),r.uniformMatrix4fv(Re,!1,t.projection),r.uniformMatrix4fv(Ae,!1,t.view),r.bindVertexArray(e.vao),r.bindBuffer(r.ARRAY_BUFFER,e.vbo),r.bufferSubData(r.ARRAY_BUFFER,0,e.data),r.drawArraysInstanced(r.TRIANGLE_STRIP,0,4,e.len)}class zt{}function f(e,t,n){const o=new zt;return o.size=q(e),o.cells=[...t],o.color=Fe(n),o}function pe(e,t,n,o){const i=A(t,e.size[0]),s=A(n,e.size[1]);switch(o%4){default:case 0:return a(i,s);case 1:return a(e.size[1]-1-s,i);case 2:return a(e.size[0]-1-i,e.size[1]-1-s);case 3:return a(s,e.size[0]-1-i)}}function N(e){switch(e){case 0:return f(a(4,1),[1,1,1,1],p(0,255,255));case 1:return f(a(2,3),[0,1,0,1,1,1],p(0,0,255));case 2:return f(a(2,3),[1,0,1,0,1,1],p(255,165,0));case 3:return f(a(2,2),[1,1,1,1],p(255,255,0));case 4:return f(a(3,2),[0,1,1,1,1,0],p(0,255,0));case 5:return f(a(3,2),[1,1,1,0,1,0],p(128,0,128));case 6:return f(a(3,2),[1,1,0,0,1,1],p(255,0,0))}}function Oe(){return[N(0),N(1),N(2),N(3),N(4),N(5),N(6)]}var Ke=(e=>(e[e.EMPTY=0]="EMPTY",e[e.MOVING=1]="MOVING",e[e.LOCKED=2]="LOCKED",e))(Ke||{});class kt{}function St(e,t,n){const o=new kt;return o.state=e,o.position=q(t),o.color=Fe(n),o}class Et{}function Lt(e,t,n){const o=new Et;return o.polyomino=e,o.position=q(t),o.rotation=n,o}class Ft{}function Nt(e,t){const n=new Ft;return n.grid_size=q(e),n.cell_size=q(t),n.cells=[],n.len=e[0]*e[1],n.polyominos=Oe(),n.poly_index=0,n.piece=Lt(n.polyominos[0],a(),0),n.stored=null,n.has_swapped=!1,n.lock_delay=n.lock_timer=2,n.score=0,n.is_paused=!1,n.padding=.05,He(n),n}function He(e){e.len=e.grid_size[0]*e.grid_size[1],e.padded_cell_size=ct(e.cell_size,e.padding),e.total_size=Ee(e.grid_size,e.padded_cell_size),e.cells.length=0;const t=Q(e.total_size,.5),n=Q(e.padded_cell_size,.5);for(let o=0;o<e.len;o+=1){const i=o%e.grid_size[0],s=-Math.floor(o/e.grid_size[0]),c=a(i*e.padded_cell_size[0]-t[0]+n[0],s*e.padded_cell_size[1]+t[1]-n[1]);e.cells.push(St(0,c,p()))}}function ne(e,t,n){const o=e.piece,i=o.polyomino,s=ot(o.position,t),c=(o.rotation+n)%4;for(let l=0;l<i.size[0];l+=1)for(let _=0;_<i.size[1];_+=1){const d=D(l,_,i.size[0]);if(!i.cells[d])continue;const[g,L]=pe(i,l,_,c),b=s[0]+g,k=s[1]+L;if(b<0||b>=e.grid_size[0]||k>=e.grid_size[1])return!1;const V=D(b,k,e.grid_size[0]),ie=e.cells[V];if(ie&&ie.state===2)return!1}return!0}function ee(e,t){const n=e.piece,o=n.polyomino,i=n.position,s=n.rotation;for(let c=0;c<o.size[0];c+=1)for(let l=0;l<o.size[1];l+=1){const[_,d]=pe(o,c,l,s),g=l*o.size[0]+c;if(!o.cells[g])continue;const b=D(_+i[0],d+i[1],e.grid_size[0]);if(b<0||b>=e.len)continue;const k=e.cells[b];k.state=t,t===0?Ne(k.color):ue(k.color,o.color)}}function te(e,t){const n=e.piece;n.polyomino=t,tt(e.piece.position,Math.floor(e.grid_size[0]/2-t.size[0]/2),-n.polyomino.size[1]-1),ee(e,1)}const le=[a(0,0),a(-1,0),a(1,0),a(0,-1),a(0,1),a(-1,-1),a(-1,1),a(1,-1),a(1,1),a(0,-2),a(0,-3)];function Y(e,t){if(!ne(e,t,0))return;const n=e.piece;Se(n.position,t)}function re(e,t){let n=-1;for(let s=0;s<le.length;s+=1){const c=le[s];if(ne(e,c,t)){n=s;break}}if(n<0)return;const o=e.piece,i=le[n];Se(o.position,i),o.rotation=A(o.rotation+t,4)}function Mt(e){const t=e.grid_size[0],n=e.grid_size[1];for(let o=0;o<n;o+=1){let i=!0;for(let s=0;s<t;s+=1){const c=D(s,o,t);if(e.cells[c].state===0){i=!1;break}}if(i){for(let s=o;s>0;s-=1)for(let c=0;c<t;c+=1){const l=D(c,s,t),_=D(c,s-1,t),d=e.cells[l],g=e.cells[_];d.state=g.state,ue(d.color,g.color)}e.score+=e.grid_size[0]}}}function fe(e){for(const t of e.cells)t.state=0,Ne(t.color);e.poly_index=A(e.poly_index+1,e.polyominos.length),te(e,e.polyominos[e.poly_index]),e.is_paused=!1,e.score=0}function Ie(e){for(;ne(e,a(0,1),0);)Y(e,a(0,1));if(e.piece.position[1]<0){e.is_paused=!0;return}ee(e,2),Mt(e),e.poly_index=A(e.poly_index+1,e.polyominos.length),te(e,e.polyominos[e.poly_index]),e.has_swapped=!1,e.lock_timer=e.lock_delay}function Rt(e){if(!e.stored)e.stored=e.piece.polyomino,e.poly_index=A(e.poly_index+1,e.polyominos.length),ee(e,0),te(e,e.polyominos[e.poly_index]),e.has_swapped=!0;else if(!e.has_swapped){const t=e.stored;e.stored=e.piece.polyomino,e.poly_index=A(e.poly_index+1,e.polyominos.length),ee(e,0),e.piece.polyomino=t,te(e,t),e.has_swapped=!0}}function he(e,t,n){return Math.min(Math.max(e,t),n)}var M=(e=>(e[e.PX=0]="PX",e[e.PCT=1]="PCT",e[e.FR=2]="FR",e))(M||{});const At={0:"px",1:"%",2:"fr"};class Pt{}function I(e,t){const n=new Pt;return n.x=e,n.u=t,n}function Ot(e){return`${e.x}${At[e.u]}`}class Kt{get(){return this.type===0?this.object[this.key]:this.call_get()}set(t){this.type===0?this.object[this.key]=t:this.call_set(t)}}function $(e,t){const n=new Kt;return n.type=0,n.object=e,n.key=t,n}function F(e,t){if(!e)return null;const n=document.createElement("span");return n.className="gui_label",n.innerHTML=e,t.append(n),n}function G(){const e=document.createElement("div");return e.className="gui_container",e}function oe(e,t,n,o,i){const s=document.createElement("input");return s.className="gui_input",s.type=e,s.step=n.toString(),s.min=o.toString(),s.max=i.toString(),s.value=t.toString(),s}class m{constructor(){this.children=[]}container(){return this.ref_el}render(){}mount(){}static mount(){}update(){}}class De extends m{grid_str(t){let n="";for(let o=0;o<t.length;o+=1){const i=t[o];n+=Ot(i),o<t.length-1&&(n+=" ")}return n}layout_str(){let t="";const n=this.grid_x.length,o=this.grid_y.length,i=n*o;for(let s=0;s<i;s+=n){let c="";for(let l=s;l<s+n;l+=1){const _=this.layout[l];c+=`w${_}`,l<s+n-1&&(c+=" ")}t+=`"${c}"
`}return t}render(){const t=document.createElement("div");this.window_parent?t.className="gui_window":t.className="gui_window_root",this.window_children.length?(t.style.display="grid",t.style.gridTemplateColumns=this.grid_str(this.grid_x),t.style.gridTemplateRows=this.grid_str(this.grid_y),t.style.gridTemplateAreas=this.layout_str()):t.style.gridArea=`w${this.id}`,this.ref_el=t}}class Ue extends m{container(){return this.container_el}render(){const t=document.createElement("div");t.className="gui_collapsing_header"+(this.is_collapsed?" gui_is_collapsed":"");const n=document.createElement("div");n.className="gui_title",n.innerHTML=this.title,t.append(n),n.onclick=(function(){this.is_collapsed?(this.is_collapsed=!1,t.classList.remove("gui_is_collapsed")):(this.is_collapsed=!0,t.classList.add("gui_is_collapsed"))}).bind(this);const o=G();t.append(o),this.ref_el=t,this.container_el=o}}class je extends m{render(){const t=document.createElement("div");t.className="gui_text",t.innerHTML=this.value,this.ref_el=t}}class Ht extends m{render(){const t=document.createElement("div");t.className="gui_bool";const n=document.createElement("div");n.className="gui_checkbox_group_option"+(this.value.get()?" gui_selected":""),n.innerHTML=this.label,t.append(n),n.onclick=(function(){this.value.get()?(this.value.set(!1),n.classList.remove("gui_selected")):(this.value.set(!0),n.classList.add("gui_selected")),this.onchange(this.value.get())}).bind(this),this.ref_el=t,this.input_el=n}update(){this.value.get()?this.input_el.classList.add("gui_selected"):this.input_el.classList.remove("gui_selected")}}class It extends m{render(){const t=document.createElement("div");t.className="gui_input_number",F(this.label,t);const n=oe("number",this.value.get(),this.step,this.min,this.max);t.append(n),n.onchange=(function(){const o=he(parseFloat(n.value),this.min,this.max);this.value.set(o),n.value=o.toString(),this.onchange(o)}).bind(this),this.ref_el=t,this.input_el=n}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString())}}class Ce extends m{render(){const t=document.createElement("div");t.className="gui_slider_number",F(this.label,t);const n=G();n.className="gui_input_range_container",t.append(n);const o=oe("range",this.value.get(),this.step,this.min,this.max);o.className="gui_input_range",n.dataset.content=o.value,n.append(o),o.onchange=(function(){const i=he(parseFloat(o.value),this.min,this.max);this.value.set(i),n.dataset.content=o.value,this.onchange(i)}).bind(this),o.onmousemove=function(){n.dataset.content=o.value},this.ref_el=t,this.container_el=n,this.input_el=o}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString(),this.container_el.dataset.content=this.input_el.value)}}class Dt extends m{render(){const t=document.createElement("div");t.className="gui_input_vec",t.style.setProperty("--size",this.size.toString()),F(this.label,t);const n=G();t.append(n);const o=[];for(let i=0;i<this.value.length;i+=1){const s=oe("number",this.value[i],this.step,this.min,this.max);n.append(s),s.onchange=(function(){const c=he(parseFloat(s.value),this.min,this.max);this.value[i]=c,s.value=c.toString(),this.onchange(this.value)}).bind(this),o.push(s)}this.ref_el=t,this.input_els=o}update(){for(let t=0;t<this.value.length;t+=1){const n=this.input_els[t];document.activeElement!=n&&(n.value=this.value[t].toString())}}}class Ut extends m{to_hex(t,n,o){const i=this.mode===0?255:1,s=Math.round(t*i).toString(16).padStart(2,"0"),c=Math.round(n*i).toString(16).padStart(2,"0"),l=Math.round(o*i).toString(16).padStart(2,"0");return`#${s}${c}${l}`}from_hex(t){const n=t.replace(/^#/,""),o=this.mode===0?255:1,i=parseInt(n.substring(0,2),16)/o,s=parseInt(n.substring(2,4),16)/o,c=parseInt(n.substring(4,6),16)/o;return[i,s,c]}render(){const t=document.createElement("div");t.className="gui_color_edit"+(this.value.length===4?" gui_rgba":""),F(this.label,t);const n=G();t.append(n);const o=document.createElement("input");if(o.className="gui_input_color",o.type="color",o.value=this.to_hex(this.value[0],this.value[1],this.value[2]),n.append(o),o.onchange=(function(){const i=this.from_hex(o.value);this.value[0]=i[0],this.value[1]=i[1],this.value[2]=i[2],this.onchange(this.value)}).bind(this),this.value.length==4){const i=document.createElement("div");i.className="gui_input_range_container",n.append(i);const s=oe("range",this.value[3],.01,0,1);s.className="gui_input_range",i.dataset.content=s.value,i.append(s),s.onchange=(function(){this.value[3]=parseFloat(s.value)*(this.mode===1?255:1),i.dataset.content=s.value,this.onchange(this.value)}).bind(this),s.onmousemove=function(){i.dataset.content=s.value},this.range_el=s,this.range_container_el=i}this.ref_el=t,this.input_el=o}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.to_hex(this.value[0],this.value[1],this.value[2])),this.range_container_el&&this.range_el&&document.activeElement!=this.range_el&&(this.range_el.value=this.value[3].toString(),this.range_container_el.dataset.content=this.range_el.value)}}class jt extends m{render(){const t=document.createElement("div");t.className="gui_input_text",F(this.label,t);const n=document.createElement("input");n.className="gui_input",n.type="text",n.value=this.value.get().toString(),t.append(n),n.onchange=(function(){this.value.set(n.value),this.onchange(n.value)}).bind(this),this.ref_el=t,this.input_el=n}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString())}}class Ct extends m{render(){const t=document.createElement("div");t.className="gui_radio_group",F(this.label,t);const n=G();t.append(n);const o=[],i=this.value.get();for(let s=0;s<this.keys.length;s+=1){const c=this.keys[s],l=this.values[s],_=document.createElement("div");_.className="gui_radio_group_option"+(l===i?" gui_selected":""),_.innerHTML=c,n.append(_),_.onclick=(function(){this.value.set(l);for(const d of this.option_els)d.classList.remove("gui_selected");_.classList.add("gui_selected"),this.onchange(l)}).bind(this),o.push(_)}this.ref_el=t,this.option_els=o}update(){const t=this.value.get();for(let n=0;n<this.option_els.length;n+=1){const o=this.option_els[n];this.values[n]===t?o.classList.add("gui_selected"):o.classList.remove("gui_selected")}}}class Xt extends m{render(){const t=document.createElement("div");t.className="gui_checkbox_group",F(this.label,t);const n=G();t.append(n);const o=[],i=this.value.get();for(let s=0;s<this.keys.length;s+=1){const c=this.keys[s],l=this.values[s],_=document.createElement("div");_.className="gui_checkbox_group_option"+(i.indexOf(l)>-1?" gui_selected":""),_.innerHTML=c,n.append(_),_.onclick=(function(){_.classList.contains("gui_selected")?(i.splice(i.indexOf(l),1),_.classList.remove("gui_selected")):(i.push(l),_.classList.add("gui_selected")),this.onchange(this.value.get())}).bind(this),o.push(_)}this.ref_el=t,this.option_els=o}update(){const t=this.value.get();for(let n=0;n<this.option_els.length;n+=1){const o=this.option_els[n];t.indexOf(this.values[n])>-1?o.classList.add("gui_selected"):o.classList.remove("gui_selected")}}}class Xe extends m{render(){const t=document.createElement("div");t.className="gui_select",F(this.label,t);const n=document.createElement("div");n.className="gui_select",t.append(n),n.onclick=function(l){l.stopPropagation()};const o=document.createElement("div");o.className="gui_select_button",o.innerHTML="Select",n.append(o),o.onclick=function(){o.classList.contains("gui_open")?o.classList.remove("gui_open"):o.classList.add("gui_open")};const i=document.createElement("div");i.className="gui_select_container",n.append(i);const s=[],c=this.value.get();for(let l=0;l<this.keys.length;l+=1){const _=this.keys[l];this.values[l]===c&&(o.innerHTML=_);const g=document.createElement("div");g.className="gui_select_option",g.innerHTML=_,g.dataset.value=l.toString(),i.append(g),g.onclick=(function(){const L=this.values[parseInt(g.dataset.value||"")];this.value.set(L),o.innerHTML=_,o.classList.remove("gui_open"),this.onchange(L)}).bind(this),s.push(g)}this.ref_el=t,this.button_el=o,this.option_els=s}static mount(){const t=document.body.querySelector(".gui_window_root");t&&t.addEventListener("click",function(){const n=document.body.querySelector(".gui_select_button.gui_open");n&&n.classList.remove("gui_open")})}update(){const t=this.value.get();for(let n=0;n<this.option_els.length;n+=1)if(this.values[n]===t){this.button_el.innerHTML=this.keys[n];return}}}class $e extends m{render(){const t=document.createElement("div");t.className="gui_button";const n=document.createElement("button");n.innerHTML=this.label,n.onclick=this.onclick,t.append(n),this.ref_el=t}}class Ge extends m{render(){const t=document.createElement("div");t.className="gui_canvas";const n=this.canvas_el??document.createElement("canvas");t.append(n),this.auto_resize&&window.addEventListener("resize",function(){var o,i;n.width=((o=n.parentElement)==null?void 0:o.clientWidth)||0,n.height=((i=n.parentElement)==null?void 0:i.clientHeight)||0}),this.ref_el=t,this.canvas_el=n}mount(){var t,n;this.auto_resize&&(this.canvas_el.width=((t=this.canvas_el.parentElement)==null?void 0:t.clientWidth)||0,this.canvas_el.height=((n=this.canvas_el.parentElement)==null?void 0:n.clientHeight)||0)}}const $t=[De,Ue,je,Ht,It,Ce,Dt,Ut,jt,Ct,Xt,Xe,$e,Ge];let we=0;function ge(e,t=""){const n=new De;return n.id=we,n.title=t,n.grid_x=[],n.grid_y=[],n.layout=[],n.window_parent=e,n.window_children=[],n.parent=e,e&&(e.children.push(n),e.window_children.push(n)),we+=1,n}function Gt(e,t,n){e.grid_x=t,e.grid_y=n}function Vt(e,t){const n=[];for(const o of t)n.push(o.id);e.layout=n}function Ve(e,t,n=!1){const o=new Ue;return o.title=t,o.is_collapsed=n,o.parent=e,e&&e.children.push(o),o}function Yt(e,t){const n=new je;return n.value=t,n.parent=e,e&&e.children.push(n),n}function B(e,t,n,o,i,s,c=()=>{}){const l=new Ce;return l.label=t,l.value=n,l.step=o,l.min=i,l.max=s,l.onchange=c,l.parent=e,e&&e.children.push(l),l}function Wt(e,t,n,o,i,s=()=>{}){const c=new Xe;return c.label=t,c.value=n,c.keys=o,c.values=i,c.onchange=s,c.parent=e,e&&e.children.push(c),c}function qt(e,t,n){const o=new $e;return o.label=t,o.onclick=n,o.parent=e,e&&e.children.push(o),o}function Bt(e,t=!0){const n=new Ge;return n.auto_resize=t,n.parent=e,e&&e.children.push(n),n}function me(e,t){e.render(),t.append(e.ref_el),e.mount();for(const n of e.children)me(n,e.container())}function Tt(e){var o;if(!((o=e.parent)==null?void 0:o.ref_el))return;const n=e.ref_el;e.render(),n.replaceWith(e.ref_el),e.mount();for(const i of e.children)me(i,e.container())}function Zt(e,t,n=!0){if(me(e,t),!!n)for(const o of $t)o.mount()}function w(e){switch(e){case 0:return f(a(3,3),[0,1,1,1,1,0,0,1,0],p(255,105,180));case 1:return f(a(1,5),[1,1,1,1,1],p(0,255,255));case 2:return f(a(2,4),[1,0,1,0,1,0,1,1],p(255,140,0));case 3:return f(a(2,4),[0,1,0,1,1,1,1,0],p(0,128,128));case 4:return f(a(2,3),[1,1,1,1,1,0],p(255,0,255));case 5:return f(a(3,3),[1,1,1,0,1,0,0,1,0],p(128,0,128));case 6:return f(a(3,2),[1,0,1,1,1,1],p(0,128,255));case 7:return f(a(3,3),[1,0,0,1,0,0,1,1,1],p(0,255,0));case 8:return f(a(3,3),[1,0,0,1,1,0,0,1,1],p(255,255,0));case 9:return f(a(3,3),[0,1,0,1,1,1,0,1,0],p(128,128,128));case 10:return f(a(2,4),[0,1,1,1,0,1,0,1],p(255,0,0));case 11:return f(a(3,3),[1,1,0,0,1,0,0,1,1],p(0,0,255))}}function Jt(){return[w(0),w(1),w(2),w(3),w(4),w(5),w(6),w(7),w(8),w(9),w(10),w(11)]}const T=ge(null);Gt(T,[I(300,M.PX),I(1,M.FR),I(300,M.PX)],[I(1,M.FR),I(1,M.FR),I(1,M.FR)]);const U=ge(T),S=ge(T);Vt(T,[U,S,S,U,S,S,U,S,S]);const Qt=Bt(S);Zt(T,document.body);const y=document.createElement("div");y.style.position="absolute";y.style.left="0";y.style.top="0";y.style.width="100%";y.style.height="100%";y.style.fontSize="32px";y.style.color="#ffffff";y.style.padding="16px";y.style.textAlign="left";y.style.fontFamily="monospace";S.ref_el.append(y);S.ref_el.style.position="relative";S.ref_el.style.overflow="hidden";const P=Qt.canvas_el,z=Be(P);pt();const v={width:10,height:20,pack:0,move_interval:.1,gravity_interval:.1},Ye=[Oe(),Jt()],u=Nt(a(v.width,v.height),a(1));u.polyominos=Ye[v.pack];fe(u);const j=at();function We(){const t=Math.max(u.total_size[0],u.total_size[1]+u.padded_cell_size[1]*7),n=Math.min(P.width,P.height);j.position[1]=u.padded_cell_size[1]*5/2,j.scale=n*2/t}We();const R=Pe();_e(R,u.len);xt();de(R);function en(){u.grid_size[0]=v.width,u.grid_size[1]=v.height,He(u),_e(R,u.len),de(R),We(),u.polyominos=Ye[v.pack],fe(u)}const W=Pe();_e(W,5);de(W);dt(function(e){e.code==="KeyR"&&fe(u),!u.is_paused&&(e.code==="KeyC"&&Rt(u),e.code==="KeyZ"&&re(u,-1),e.code==="ArrowUp"&&re(u,1),e.code==="KeyX"&&re(u,2),e.code==="Space"&&Ie(u))});let xe=performance.now(),ae=0,Z=0;function tn(){const e=performance.now(),t=(e-xe)/1e3;xe=e,ut(j,P.width,P.height),_t(j),u.is_paused||(ae+=t,Z+=t,ae>=v.move_interval&&(se("ArrowLeft")?Y(u,a(-1,0)):se("ArrowRight")?Y(u,a(1,0)):se("ArrowDown")&&Y(u,a(0,1)),ae=0),Z>=v.gravity_interval&&(Y(u,a(0,1)),ne(u,a(0,1),0)||(u.lock_timer-=Z,u.lock_timer<=0&&Ie(u)),Z=0))}z.enable(z.BLEND);z.blendFunc(z.SRC_ALPHA,z.ONE_MINUS_SRC_ALPHA);z.enable(z.CULL_FACE);function nn(){z.viewport(0,0,P.width,P.height),z.clearColor(0,0,0,1),z.clear(z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT);const e=u.piece,t=e.polyomino,n=e.position,o=e.rotation;let i=0;for(let s=0;s<t.size[0];s+=1)for(let c=0;c<t.size[1];c+=1){const[l,_]=pe(t,s,c,o),d=c*t.size[0]+s;if(!t.cells[d])continue;const L=Ee(u.grid_size,u.padded_cell_size),b=Q(L,.5),k=Q(u.padded_cell_size,.5),V=a((n[0]+l)*u.padded_cell_size[0]-b[0]+k[0],(-n[1]-_)*u.padded_cell_size[1]+b[1]-k[1]);ce(W,i,V,u.cell_size,0,0,H(t.color[0],t.color[1],t.color[2],255),H(t.color[0]/2,t.color[1]/2,t.color[2]/2,255),.2),i++}W.len=i;for(let s=0;s<u.len;s+=1){const c=u.cells[s];c.state===Ke.LOCKED?ce(R,s,c.position,u.cell_size,0,0,H(c.color[0],c.color[1],c.color[2],255),H(c.color[0]/2,c.color[1]/2,c.color[2]/2,255),.2):ce(R,s,c.position,u.cell_size,0,0,H(10,10,10,255),H(50,50,50,255),.1)}be(R,j),be(W,j),u.is_paused?y.innerHTML=`Score: ${u.score}<br>Game Over<br>Press R to Restart`:y.innerHTML=`Score: ${u.score}`}function qe(){tn(),nn(),requestAnimationFrame(qe)}qe();const on=Ve(U,"Controls");Yt(on,`
    Arrow Down - Move Down<br>
    Arrow Right - Move Right<br>
    Z - Rotate Left<br>
    Arrow Up - Rotate Right<br>
    X - Rotate 180<br>
    C - Store Piece / Place Stored Piece<br>
    Space - Place Piece<br>
    R - Reset
`);const K=Ve(U,"General");B(K,"Width",$(v,"width"),1,1,100);B(K,"Width",$(v,"height"),1,1,100);Wt(K,"Pack",$(v,"pack"),["Tetromino","Pentomino"],[0,1]);B(K,"Move Interval",$(v,"move_interval"),.01,.01,1);B(K,"Gravity Interval",$(v,"gravity_interval"),.01,.01,1);B(K,"Lock Interval",$(u,"lock_delay"),.01,.01,10);qt(K,"Reload",function(){en()});Tt(U);
