var Ze=Object.defineProperty;var Ge=(e,n,t)=>n in e?Ze(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var r=(e,n,t)=>Ge(e,typeof n!="symbol"?n+"":n,t);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();let v;function et(e){return v=e.getContext("webgl2")}function tt(e,n){const t=v.createShader(e);if(!t)return null;if(v.shaderSource(t,n),v.compileShader(t),!v.getShaderParameter(t,v.COMPILE_STATUS)){const o=v.getShaderInfoLog(t);return console.error(o),v.deleteShader(t),null}return t}function nt(e){const n=v.createProgram(),t=[];for(const o in e){const s=e[o],l=tt(parseInt(o),s);if(!l){for(const c of t)v.deleteShader(c);return null}t.push(l)}for(const o of t)v.attachShader(n,o);v.linkProgram(n);for(const o of t)v.detachShader(n,o),v.deleteShader(o);if(!v.getProgramParameter(n,v.LINK_STATUS)){const o=v.getProgramInfoLog(n);return console.error(o),v.deleteProgram(n),null}return n}const S=Float32Array;function fe(e=1,n=0,t=0,i=0,o=0,s,l=0,c=0,a=0,h=0,p,d=0,E=0,L=0,C=0,R){const g=new S(16);return g[0]=e,g[1]=n,g[2]=t,g[3]=i,g[4]=o,g[5]=e,g[6]=l,g[7]=c,g[8]=a,g[9]=h,g[10]=e,g[11]=d,g[12]=E,g[13]=L,g[14]=C,g[15]=e,g}function Le(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ge(e){return e*Math.PI/180}function w(e=0,n){const t=new S(2);return t[0]=e,t[1]=n??e,t}function V(e){const n=new S(2);return n[0]=e[0],n[1]=e[1],n}function q(e,n){return e[0]=n[0],e[1]=n[1],e}function it(e,n,t){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function te(e,n){return it(e,n,new S(2))}function ke(e,n,t,i){return i[0]=e[0]+n[0]*t,i[1]=e[1]+n[1]*t,i}function T(e,n,t){return ke(e,n,t,new S(2))}function Fe(e,n,t){return ke(e,n,t,e)}function ot(e,n){const t=e[0],i=e[1];let o=t*t+i*i;return o>0&&(o=1/Math.sqrt(o)),n[0]=t*o,n[1]=i*o,n}function Ne(e){return ot(e,e)}function st(e,n,t){const i=e[0]-n[0],o=e[1]-n[1];let s=i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=i*s,t[1]=o*s,t}function rt(e,n){return st(e,n,new S(2))}function lt(e,n,t){return t[0]=-(n[1]-e[1]),t[1]=n[0]-e[0],t}function Ae(e,n){return lt(e,n,new S(2))}function ct(e,n,t,i){const o=e[0],s=e[1];return i[0]=o+t*(n[0]-o),i[1]=s+t*(n[1]-s),i}function at(e,n,t){return ct(e,n,t,new S(2))}function ut(e,n,t){const i=n[0],o=n[1],s=n[2];return t[12]=e[0]*i+e[4]*o+e[8]*s+e[12],t[13]=e[1]*i+e[5]*o+e[9]*s+e[13],t[14]=e[2]*i+e[6]*o+e[10]*s+e[14],t[15]=e[3]*i+e[7]*o+e[11]*s+e[15],t}function _t(e,n,t){const i=n[0],o=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Se(e=0,n,t){const i=new S(3);return i[0]=e,i[1]=n??e,i[2]=t??e,i}class ht{constructor(){r(this,"position");r(this,"scale");r(this,"roll");r(this,"right");r(this,"up");r(this,"world_up");r(this,"projection");r(this,"view");r(this,"movement_speed");r(this,"roll_speed")}}function dt(){const e=new ht;return e.position=w(),e.right=w(1,0),e.up=w(0,1),e.world_up=w(0,1),e.projection=fe(1),e.view=fe(1),e.scale=50,e.roll=0,e.movement_speed=.1,e.roll_speed=.1,e}function me(e,n){Fe(e.position,e.right,e.movement_speed*n)}function ve(e,n){Fe(e.position,e.up,e.movement_speed*n)}function pt(e,n,t){return Le(e.projection),_t(e.projection,Se(e.scale/n,e.scale/t,1),e.projection),e.projection}function ft(e){return Le(e.view),ut(e.view,Se(-e.position[0],-e.position[1],0),e.view),e.view}const N={keys:{},buttons:{},kb_key_down:function(){},kb_key_up:function(){},m_move:function(){},m_button_down:function(){},m_button_up:function(){},m_wheel_scroll:function(){}};function gt(){addEventListener("keydown",function(e){N.keys[e.code]=0,N.kb_key_down({code:e.code,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey})}),addEventListener("keyup",function(e){N.keys[e.code]=1,N.kb_key_up({code:e.code,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey})}),addEventListener("mousemove",function(e){N.m_move({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target})}),addEventListener("mousedown",function(e){N.buttons[e.button]=0,N.m_button_down({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target})}),addEventListener("mouseup",function(e){N.buttons[e.button]=1,N.m_button_up({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target})}),addEventListener("wheel",function(e){N.m_wheel_scroll({xd:Math.sign(e.deltaX),yd:Math.sign(e.deltaY)})})}function O(e){return N.keys[e]===0}var I=(e=>(e[e.NONE=0]="NONE",e[e.LINEAR=1]="LINEAR",e[e.QUADRATIC=2]="QUADRATIC",e[e.CUBIC=3]="CUBIC",e[e.EXPONENTIAL=4]="EXPONENTIAL",e[e.LOGARITHMIC=5]="LOGARITHMIC",e))(I||{});class mt{constructor(){r(this,"type");r(this,"dir");r(this,"param")}}function vt(e,n){const t=new mt;return t.type=e,t.param=n,t}function we(){return vt(0,0)}function ye(e,n){return e.type===1?n+e.param:e.type===4?n*e.param:n}class wt{constructor(){r(this,"position");r(this,"angle");r(this,"width");r(this,"length");r(this,"delta_angle");r(this,"changer_width");r(this,"changer_length");r(this,"rules");r(this,"callbacks")}}function yt(e,n,t,i){const o=new wt;return o.position=e,o.angle=n,o.width=t,o.length=i,o.delta_angle=90,o.changer_width=we(),o.changer_length=we(),o.rules={},o.callbacks={},o}class bt{constructor(){r(this,"position");r(this,"angle");r(this,"width");r(this,"length")}}function be(e,n,t,i){const o=new bt;return o.position=V(e),o.angle=n,o.width=t,o.length=i,o}class xt{constructor(){r(this,"value");r(this,"prev");r(this,"next")}}function xe(e){const n=new xt;return n.value=e,n.prev=null,n.next=null,n}function Et(e,n,t){e.rules[n]=t}function ne(e,n,t){e.callbacks[n]=t}function Ie(e,n){const t=xe(n[0]);let i=t;for(let o=1;o<n.length;o+=1){const s=n[o],l=xe(s);l.prev=i,i.next=l,i=l}return[t,i]}function Lt(e,n){let t=n;for(;t;){const i=e.rules[t.value];if(i){const[o,s]=Ie(e,i);t.prev&&(t.prev.next=o),t.next&&(s.next=t.next,t.next.prev=s),o.prev=t.prev,t===n&&(n=o)}t=t.next}}function kt(e,n,t){const[i]=Ie(e,n);for(let h=0;h<t;h+=1)Lt(e,i);const o=[];let s=be(e.position,e.angle,e.width,e.length),l=i,c=V(s.position),a=s.width;for(;l;){const h=l.value;switch(h){case"f":case"F":const p=w(Math.cos(ge(s.angle)),Math.sin(ge(s.angle))),d=T(s.position,p,s.length),E=ye(e.changer_width,s.width),L=ye(e.changer_length,s.length),C=e.callbacks[h];C&&C(V(s.position),s.width,V(d),E),q(c,s.position),a=s.width,q(s.position,d),s.width=E,s.length=L;break;case"-":s.angle+=e.delta_angle;break;case"+":s.angle-=e.delta_angle;break;case"[":o.push(be(s.position,s.angle,s.width,s.length));break;case"]":const R=o.pop();R&&(s=R);break;default:{const g=e.callbacks[h];g&&g(c,a,s.position,s.width)}break}l=l.next}}function m(e=0,n,t,i){const o=new S(4);return o[0]=e,o[1]=n??e,o[2]=t??e,o[3]=i??e,o}function $(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function Y(e){return((e[0]&255)<<24|(e[1]&255)<<16|(e[2]&255)<<8|e[3]&255)>>>0}function ie(e,n,t){return Math.min(Math.max(e,n),t)}var P=(e=>(e[e.PX=0]="PX",e[e.PCT=1]="PCT",e[e.FR=2]="FR",e))(P||{});const Ft={0:"px",1:"%",2:"fr"};class Nt{constructor(){r(this,"x");r(this,"u")}}function X(e,n){const t=new Nt;return t.x=e,t.u=n,t}function At(e){return`${e.x}${Ft[e.u]}`}class St{constructor(){r(this,"type");r(this,"object");r(this,"key");r(this,"call_get");r(this,"call_set")}get(){return this.type===0?this.object[this.key]:this.call_get()}set(n){this.type===0?this.object[this.key]=n:this.call_set(n)}}function b(e,n){const t=new St;return t.type=0,t.object=e,t.key=n,t}function M(e,n){if(!e)return null;const t=document.createElement("span");return t.className="gui_label",t.innerHTML=e,n.append(t),t}function K(){const e=document.createElement("div");return e.className="gui_container",e}function J(e,n,t,i,o){const s=document.createElement("input");return s.className="gui_input",s.type=e,s.step=t.toString(),s.min=i.toString(),s.max=o.toString(),s.value=n.toString(),s}class y{constructor(){r(this,"parent");r(this,"children",[]);r(this,"ref_el")}container(){return this.ref_el}render(){}mount(){}static mount(){}update(){}}class Re extends y{constructor(){super(...arguments);r(this,"id");r(this,"title");r(this,"grid_x");r(this,"grid_y");r(this,"layout");r(this,"window_parent");r(this,"window_children")}grid_str(t){let i="";for(let o=0;o<t.length;o+=1){const s=t[o];i+=At(s),o<t.length-1&&(i+=" ")}return i}layout_str(){let t="";const i=this.grid_x.length,o=this.grid_y.length,s=i*o;for(let l=0;l<s;l+=i){let c="";for(let a=l;a<l+i;a+=1){const h=this.layout[a];c+=`w${h}`,a<l+i-1&&(c+=" ")}t+=`"${c}"
`}return t}render(){const t=document.createElement("div");this.window_parent?t.className="gui_window":t.className="gui_window_root",this.window_children.length?(t.style.display="grid",t.style.gridTemplateColumns=this.grid_str(this.grid_x),t.style.gridTemplateRows=this.grid_str(this.grid_y),t.style.gridTemplateAreas=this.layout_str()):t.style.gridArea=`w${this.id}`,this.ref_el=t}}class oe extends y{constructor(){super(...arguments);r(this,"title");r(this,"is_collapsed");r(this,"container_el")}container(){return this.container_el}render(){const t=document.createElement("div");t.className="gui_collapsing_header"+(this.is_collapsed?" gui_is_collapsed":"");const i=document.createElement("div");i.className="gui_title",i.innerHTML=this.title,t.append(i),i.onclick=(function(){this.is_collapsed?(this.is_collapsed=!1,t.classList.remove("gui_is_collapsed")):(this.is_collapsed=!0,t.classList.add("gui_is_collapsed"))}).bind(this);const o=K();t.append(o),this.ref_el=t,this.container_el=o}}class It extends y{constructor(){super(...arguments);r(this,"condition")}render(){const t=document.createElement("div");t.className="gui_group",this.condition()?t.style.display="block":t.style.display="none",this.ref_el=t}update(){this.condition()?this.ref_el.style.display="block":this.ref_el.style.display="none"}}class Te extends y{constructor(){super(...arguments);r(this,"value")}render(){const t=document.createElement("div");t.className="gui_text",t.innerHTML=this.value,this.ref_el=t}}class Rt extends y{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"onchange");r(this,"input_el")}render(){const t=document.createElement("div");t.className="gui_bool";const i=document.createElement("div");i.className="gui_checkbox_group_option"+(this.value.get()?" gui_selected":""),i.innerHTML=this.label,t.append(i),i.onclick=(function(){this.value.get()?(this.value.set(!1),i.classList.remove("gui_selected")):(this.value.set(!0),i.classList.add("gui_selected")),this.onchange(this.value.get())}).bind(this),this.ref_el=t,this.input_el=i}update(){this.value.get()?this.input_el.classList.add("gui_selected"):this.input_el.classList.remove("gui_selected")}}class Me extends y{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"step");r(this,"min");r(this,"max");r(this,"onchange");r(this,"input_el")}render(){const t=document.createElement("div");t.className="gui_input_number",M(this.label,t);const i=J("number",this.value.get(),this.step,this.min,this.max);t.append(i),i.onchange=(function(){const o=ie(parseFloat(i.value),this.min,this.max);this.value.set(o),i.value=o.toString(),this.onchange(o)}).bind(this),this.ref_el=t,this.input_el=i}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString())}}class Pe extends y{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"step");r(this,"min");r(this,"max");r(this,"container_el");r(this,"onchange");r(this,"input_el")}render(){const t=document.createElement("div");t.className="gui_slider_number",M(this.label,t);const i=K();i.className="gui_input_range_container",t.append(i);const o=J("range",this.value.get(),this.step,this.min,this.max);o.className="gui_input_range",i.dataset.content=o.value,i.append(o),o.onchange=(function(){const s=ie(parseFloat(o.value),this.min,this.max);this.value.set(s),i.dataset.content=o.value,this.onchange(s)}).bind(this),o.onmousemove=function(){i.dataset.content=o.value},this.ref_el=t,this.container_el=i,this.input_el=o}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString(),this.container_el.dataset.content=this.input_el.value)}}class Be extends y{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"step");r(this,"min");r(this,"max");r(this,"size");r(this,"onchange");r(this,"input_els")}render(){const t=document.createElement("div");t.className="gui_input_vec",t.style.setProperty("--size",this.size.toString()),M(this.label,t);const i=K();t.append(i);const o=[];for(let s=0;s<this.value.length;s+=1){const l=J("number",this.value[s],this.step,this.min,this.max);i.append(l),l.onchange=(function(){const c=ie(parseFloat(l.value),this.min,this.max);this.value[s]=c,l.value=c.toString(),this.onchange(this.value)}).bind(this),o.push(l)}this.ref_el=t,this.input_els=o}update(){for(let t=0;t<this.value.length;t+=1){const i=this.input_els[t];document.activeElement!=i&&(i.value=this.value[t].toString())}}}var D=(e=>(e[e.R_0_1=0]="R_0_1",e[e.R_0_255=1]="R_0_255",e))(D||{});class Ce extends y{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"mode");r(this,"onchange");r(this,"input_el");r(this,"range_container_el");r(this,"range_el")}to_hex(t,i,o){const s=this.mode===0?255:1,l=Math.round(t*s).toString(16).padStart(2,"0"),c=Math.round(i*s).toString(16).padStart(2,"0"),a=Math.round(o*s).toString(16).padStart(2,"0");return`#${l}${c}${a}`}from_hex(t){const i=t.replace(/^#/,""),o=this.mode===0?255:1,s=parseInt(i.substring(0,2),16)/o,l=parseInt(i.substring(2,4),16)/o,c=parseInt(i.substring(4,6),16)/o;return[s,l,c]}render(){const t=document.createElement("div");t.className="gui_color_edit"+(this.value.length===4?" gui_rgba":""),M(this.label,t);const i=K();t.append(i);const o=document.createElement("input");if(o.className="gui_input_color",o.type="color",o.value=this.to_hex(this.value[0],this.value[1],this.value[2]),i.append(o),o.onchange=(function(){const s=this.from_hex(o.value);this.value[0]=s[0],this.value[1]=s[1],this.value[2]=s[2],this.onchange(this.value)}).bind(this),this.value.length==4){const s=document.createElement("div");s.className="gui_input_range_container",i.append(s);const l=J("range",this.value[3],.01,0,1);l.className="gui_input_range",s.dataset.content=l.value,s.append(l),l.onchange=(function(){this.value[3]=parseFloat(l.value)*(this.mode===1?255:1),s.dataset.content=l.value,this.onchange(this.value)}).bind(this),l.onmousemove=function(){s.dataset.content=l.value},this.range_el=l,this.range_container_el=s}this.ref_el=t,this.input_el=o}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.to_hex(this.value[0],this.value[1],this.value[2])),this.range_container_el&&this.range_el&&document.activeElement!=this.range_el&&(this.range_el.value=this.value[3].toString(),this.range_container_el.dataset.content=this.range_el.value)}}class Oe extends y{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"onchange");r(this,"input_el")}render(){const t=document.createElement("div");t.className="gui_input_text",M(this.label,t);const i=document.createElement("input");i.className="gui_input",i.type="text",i.value=this.value.get().toString(),t.append(i),i.onchange=(function(){this.value.set(i.value),this.onchange(i.value)}).bind(this),this.ref_el=t,this.input_el=i}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString())}}class Tt extends y{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"keys");r(this,"values");r(this,"onchange");r(this,"option_els")}render(){const t=document.createElement("div");t.className="gui_radio_group",M(this.label,t);const i=K();t.append(i);const o=[],s=this.value.get();for(let l=0;l<this.keys.length;l+=1){const c=this.keys[l],a=this.values[l],h=document.createElement("div");h.className="gui_radio_group_option"+(a===s?" gui_selected":""),h.innerHTML=c,i.append(h),h.onclick=(function(){this.value.set(a);for(const p of this.option_els)p.classList.remove("gui_selected");h.classList.add("gui_selected"),this.onchange(a)}).bind(this),o.push(h)}this.ref_el=t,this.option_els=o}update(){const t=this.value.get();for(let i=0;i<this.option_els.length;i+=1){const o=this.option_els[i];this.values[i]===t?o.classList.add("gui_selected"):o.classList.remove("gui_selected")}}}class Mt extends y{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"keys");r(this,"values");r(this,"onchange");r(this,"option_els")}render(){const t=document.createElement("div");t.className="gui_checkbox_group",M(this.label,t);const i=K();t.append(i);const o=[],s=this.value.get();for(let l=0;l<this.keys.length;l+=1){const c=this.keys[l],a=this.values[l],h=document.createElement("div");h.className="gui_checkbox_group_option"+(s.indexOf(a)>-1?" gui_selected":""),h.innerHTML=c,i.append(h),h.onclick=(function(){h.classList.contains("gui_selected")?(s.splice(s.indexOf(a),1),h.classList.remove("gui_selected")):(s.push(a),h.classList.add("gui_selected")),this.onchange(this.value.get())}).bind(this),o.push(h)}this.ref_el=t,this.option_els=o}update(){const t=this.value.get();for(let i=0;i<this.option_els.length;i+=1){const o=this.option_els[i];t.indexOf(this.values[i])>-1?o.classList.add("gui_selected"):o.classList.remove("gui_selected")}}}class Xe extends y{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"keys");r(this,"values");r(this,"onchange");r(this,"button_el");r(this,"option_els")}render(){const t=document.createElement("div");t.className="gui_select",M(this.label,t);const i=document.createElement("div");i.className="gui_select",t.append(i),i.onclick=function(a){a.stopPropagation()};const o=document.createElement("div");o.className="gui_select_button",o.innerHTML="Select",i.append(o),o.onclick=function(){o.classList.contains("gui_open")?o.classList.remove("gui_open"):o.classList.add("gui_open")};const s=document.createElement("div");s.className="gui_select_container",i.append(s);const l=[],c=this.value.get();for(let a=0;a<this.keys.length;a+=1){const h=this.keys[a];this.values[a]===c&&(o.innerHTML=h);const d=document.createElement("div");d.className="gui_select_option",d.innerHTML=h,d.dataset.value=a.toString(),s.append(d),d.onclick=(function(){const E=this.values[parseInt(d.dataset.value||"")];this.value.set(E),o.innerHTML=h,o.classList.remove("gui_open"),this.onchange(E)}).bind(this),l.push(d)}this.ref_el=t,this.button_el=o,this.option_els=l}static mount(){const t=document.body.querySelector(".gui_window_root");t&&t.addEventListener("click",function(){const i=document.body.querySelector(".gui_select_button.gui_open");i&&i.classList.remove("gui_open")})}update(){const t=this.value.get();for(let i=0;i<this.option_els.length;i+=1)if(this.values[i]===t){this.button_el.innerHTML=this.keys[i];return}}}class Ke extends y{constructor(){super(...arguments);r(this,"label");r(this,"onclick")}render(){const t=document.createElement("div");t.className="gui_button";const i=document.createElement("button");i.innerHTML=this.label,i.onclick=this.onclick,t.append(i),this.ref_el=t}}class je extends y{constructor(){super(...arguments);r(this,"auto_resize");r(this,"canvas_el")}render(){const t=document.createElement("div");t.className="gui_canvas";const i=document.createElement("canvas");t.append(i),this.auto_resize&&window.addEventListener("resize",function(){var o,s;i.width=((o=i.parentElement)==null?void 0:o.clientWidth)||0,i.height=((s=i.parentElement)==null?void 0:s.clientHeight)||0}),this.ref_el=t,this.canvas_el=i}mount(){var t,i;this.auto_resize&&(this.canvas_el.width=((t=this.canvas_el.parentElement)==null?void 0:t.clientWidth)||0,this.canvas_el.height=((i=this.canvas_el.parentElement)==null?void 0:i.clientHeight)||0)}}const Pt=[Re,oe,Te,Rt,Me,Pe,Be,Ce,Oe,Tt,Mt,Xe,Ke,je];let Ee=0;function se(e,n=""){const t=new Re;return t.id=Ee,t.title=n,t.grid_x=[],t.grid_y=[],t.layout=[],t.window_parent=e,t.window_children=[],t.parent=e,e&&(e.children.push(t),e.window_children.push(t)),Ee+=1,t}function Bt(e,n,t){e.grid_x=n,e.grid_y=t}function Ct(e,n){const t=[];for(const i of n)t.push(i.id);e.layout=t}function H(e,n,t=!1){const i=new oe;return i.title=n,i.is_collapsed=t,i.parent=e,e.children.push(i),i}function Ot(e,n=()=>!0){const t=new It;return t.condition=n,t.parent=e,e.children.push(t),t}function ze(e,n){const t=new Te;return t.value=n,t.parent=e,e.children.push(t),t}function Q(e,n,t,i,o,s,l=()=>{}){const c=new Me;return c.label=n,c.value=t,c.step=i,c.min=o,c.max=s,c.onchange=l,c.parent=e,e.children.push(c),c}function re(e,n,t,i,o,s,l=()=>{}){const c=new Pe;return c.label=n,c.value=t,c.step=i,c.min=o,c.max=s,c.onchange=l,c.parent=e,e.children.push(c),c}function Ue(e,n,t,i,o,s,l,c=()=>{}){const a=new Be;return a.label=n,a.value=t,a.step=i,a.min=o,a.max=s,a.size=l,a.onchange=c,a.parent=e,e.children.push(a),a}function Z(e,n,t,i,o=()=>{}){const s=new Ce;return s.label=n,s.value=i,s.mode=t,s.onchange=o,s.parent=e,e.children.push(s),s}function G(e,n,t,i=()=>{}){const o=new Oe;return o.label=n,o.value=t,o.onchange=i,o.parent=e,e.children.push(o),o}function le(e,n,t,i,o,s=()=>{}){const l=new Xe;return l.label=n,l.value=t,l.keys=i,l.values=o,l.onchange=s,l.parent=e,e.children.push(l),l}function ce(e,n,t){const i=new Ke;return i.label=n,i.onclick=t,i.parent=e,e.children.push(i),i}function Xt(e,n=!0){const t=new je;return t.auto_resize=n,t.parent=e,e.children.push(t),t}function ae(e,n){e.render(),n.append(e.ref_el),e.mount();for(const t of e.children)ae(t,e.container())}function De(e){var i;if(!((i=e.parent)==null?void 0:i.ref_el))return;const t=e.ref_el;e.render(),t.replaceWith(e.ref_el),e.mount();for(const o of e.children)ae(o,e.container())}function Kt(e,n,t=!0){if(ae(e,n),!!t)for(const i of Pt)i.mount()}function He(e){if(!(e instanceof oe&&e.is_collapsed)){e.update();for(const n of e.children)He(n)}}const ue=[{name:"Flower 1",position:w(0,-80),width:4,length:20,angle:90,delta_angle:40,input:"F[-fL]F[+fL]FBFFFBBFFFFFJ",rules:{B:"[-CCC][+CCC]",C:"F[-FJ][+FJ]"},iter:3,branch_color:m(25,99,30,255),leaf_color:m(25,99,30,255),flower_inner_color:m(224,194,61,255),flower_outer_color:m(71,76,166,255),leaf_size:w(5,20),leaf_ratio:.5,flower_inner_radius:1.5,flower_outer_radius:3,width_changer_type:I.EXPONENTIAL,width_changer_param:.8,length_changer_type:I.EXPONENTIAL,length_changer_param:.8},{name:"Flower 2",position:w(0,-80),width:1,length:20,angle:90,delta_angle:40,input:"F[+fL]F[-fL]FJ",rules:{},iter:1,branch_color:m(87,212,130,255),leaf_color:m(87,212,130,255),flower_inner_color:m(235,207,52,255),flower_outer_color:m(235,52,171,255),leaf_size:w(4,20),leaf_ratio:.5,flower_inner_radius:3,flower_outer_radius:6,width_changer_type:I.NONE,width_changer_param:0,length_changer_type:I.NONE,length_changer_param:0},{name:"Tree 1",position:w(0,-80),width:12,length:15,angle:90,delta_angle:25,input:"FFFFFB",rules:{B:"[-FBfL][+FBfL]"},iter:7,branch_color:m(161,90,43,255),leaf_color:m(163,207,60,255),flower_inner_color:m(235,207,52,255),flower_outer_color:m(235,52,171,255),leaf_size:w(3,5),leaf_ratio:.5,flower_inner_radius:3,flower_outer_radius:6,width_changer_type:I.EXPONENTIAL,width_changer_param:.7,length_changer_type:I.EXPONENTIAL,length_changer_param:.95},{name:"Tree 2",position:w(0,-80),width:12,length:20,angle:90,delta_angle:25,input:"FFX",rules:{X:"F+[[X]-X]-F[-FX]+X"},iter:5,branch_color:m(161,90,43,255),leaf_color:m(163,207,60,255),flower_inner_color:m(235,207,52,255),flower_outer_color:m(235,52,171,255),leaf_size:w(3,5),leaf_ratio:.5,flower_inner_radius:3,flower_outer_radius:6,width_changer_type:I.EXPONENTIAL,width_changer_param:.7,length_changer_type:I.EXPONENTIAL,length_changer_param:.95}];class jt{constructor(){r(this,"stride");r(this,"vertices");r(this,"indices")}}function ee(e){return e.vertices.length/e.stride}function zt(e,n,t,i,o,s){const l=ee(s),c=Math.PI*2/t,a=Math.PI/t,h=Y(o);for(let p=0;p<t;p+=1){const d=te(e,w(Math.cos(c*p+a)*n,Math.sin(c*p+a)*n));s.vertices.push(...d,i,h)}for(let p=1;p<t-1;p+=1)s.indices.push(l,l+p,l+p+1)}function Ut(e,n,t,i,o,s,l){const c=ee(l),a=Ne(Ae(t,e)),h=n/2,p=i/2,d=T(e,a,-h),E=T(e,a,h),L=T(t,a,p),C=T(t,a,-p),R=Y(s);l.vertices.push(...d,o,R,...E,o,R,...L,o,R,...C,o,R),l.indices.push(c,c+1,c+2,c,c+2,c+3)}function Dt(e,n,t,i,o,s,l){const c=ee(l),a=Ne(Ae(n,e)),h=t/2,p=at(e,n,i),d=T(p,a,-h),E=T(p,a,h),L=Y(s);l.vertices.push(...e,-.5,L,...E,-.5,L,...n,-.5,L,...d,-.5,L),l.indices.push(c,c+1,c+2,c,c+2,c+3)}function Ht(e,n,t,i,o,s,l){const c=ee(l),a=Math.PI*2/i,h=Math.PI/i,p=Y(s);for(let d=0;d<i;d+=1){const E=te(e,w(Math.cos(a*d+h)*t,Math.sin(a*d+h)*t)),L=te(e,w(Math.cos(a/2+a*d+h)*n,Math.sin(a/2+a*d+h)*n));l.vertices.push(...E,o,p,...L,o,p)}for(let d=1;d<i-1;d+=1)l.indices.push(c,c+d*2,c+d*2+2);for(let d=0;d<i;d+=1)l.indices.push(c+d*2,c+d*2+1,c+(d+1)*2%(i*2))}const W=se(null);Bt(W,[X(300,P.PX),X(1,P.FR),X(300,P.PX)],[X(1,P.FR),X(1,P.FR),X(1,P.FR)]);const A=se(W),B=se(W);Ct(W,[A,B,B,A,B,B,A,B,B]);const Wt=Xt(B,!0);Kt(W,document.body);const U=Wt.canvas_el,u=et(U),_e=nt({[u.VERTEX_SHADER]:`#version 300 es
        layout(location = 0) in vec3 i_position;
        layout(location = 1) in int i_color;
        uniform mat4 u_projection;
        uniform mat4 u_view;
        flat out int v_color;

        void main() {
            gl_Position = u_projection * u_view * vec4(i_position, 1.0);
            v_color = i_color;
        }
    `,[u.FRAGMENT_SHADER]:`#version 300 es
        precision highp float;
        flat in int v_color;
        out vec4 o_frag_color;

        vec4 unpack256(int packed) {
            return vec4(
                (packed >> 24) & 0xFF,
                (packed >> 16) & 0xFF,
                (packed >> 8) & 0xFF,
                packed & 0xFF
            ) / 255.0;
        }

        void main() {
            o_frag_color = unpack256(v_color);
        }
    `}),$t=u.getUniformLocation(_e,"u_projection"),Vt=u.getUniformLocation(_e,"u_view"),We=u.createVertexArray();u.bindVertexArray(We);const $e=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,$e);u.bufferData(u.ARRAY_BUFFER,null,u.STATIC_DRAW);u.enableVertexAttribArray(0);u.vertexAttribPointer(0,3,u.FLOAT,!1,16,0);u.enableVertexAttribArray(1);u.vertexAttribIPointer(1,1,u.INT,16,12);const Ve=u.createBuffer();u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,Ve);u.bufferData(u.ELEMENT_ARRAY_BUFFER,null,u.STATIC_DRAW);let _={input:"",iter:0,preset:0,rule_key:"",rule_content:"",rules:{},branch_color:m(255),leaf_color:m(255),flower_inner_color:m(255),flower_outer_color:m(255),leaf_size:w(1),leaf_ratio:.5,flower_inner_radius:1,flower_outer_radius:2};const f=yt(w(0,-100),90,20,40);f.delta_angle=20;const F=new jt;F.vertices=[];F.indices=[];F.stride=4;let qe=F.indices.length;ne(f,"L",function(e,n,t,i){Dt(e,T(e,rt(t,e),_.leaf_size[1]),_.leaf_size[0],_.leaf_ratio,-.2,_.leaf_color,F)});ne(f,"J",function(e,n,t,i){Ht(t,_.flower_outer_radius,_.flower_outer_radius*.8,10,-.1,_.flower_outer_color,F),zt(t,_.flower_inner_radius,6,-.2,_.flower_inner_color,F)});ne(f,"F",function(e,n,t,i){Ut(e,n,t,i,0,_.branch_color,F)});let z;function he(){z.children=[];for(const e in _.rules)G(z,e,b(_.rules,e));De(z)}const qt=H(A,"Info",!0);ze(qt,`
    WASD - Move<br>
    Q/E - Zoom In/Out
`);const Yt=H(A,"Presets");function Ye(e){const n=ue[e];_.input=n.input,_.iter=n.iter,$(_.branch_color,n.branch_color),$(_.leaf_color,n.leaf_color),$(_.flower_inner_color,n.flower_inner_color),$(_.flower_outer_color,n.flower_outer_color),q(_.leaf_size,n.leaf_size),_.leaf_ratio=n.leaf_ratio,_.flower_inner_radius=n.flower_inner_radius,_.flower_outer_radius=n.flower_outer_radius,f.angle=n.angle,f.delta_angle=n.delta_angle,f.length=n.length,f.width=n.width,f.changer_length.type=n.length_changer_type,f.changer_length.param=n.length_changer_param,f.changer_width.type=n.width_changer_type,f.changer_width.param=n.width_changer_param,q(f.position,n.position),_.rules={};for(const t in n.rules){const i=n.rules[t];_.rules[t]=i}he(),He(A)}const Jt=ue.map(e=>e.name),Qt=Object.keys(ue).map(e=>parseInt(e));le(Yt,"Preset",b(_,"preset"),Jt,Qt,function(e){Ye(e)});const de=["NONE","LINEAR","QUADRATIC","CUBIC","EXPONENTIAL","LOGARITHMIC"],Je=Object.keys(de).map(e=>parseInt(e)),x=H(A,"Settings");Ue(x,"Start Position",f.position,1,-100,100,2);re(x,"Start Angle",b(f,"angle"),1,-180,180);Q(x,"Start Width",b(f,"width"),.1,.1,100);Q(x,"Start Length",b(f,"length"),.1,.1,100);le(x,"Width Change Type",b(f.changer_width,"type"),de,Je);Q(x,"Width Change Param",b(f.changer_width,"param"),.1,-100,100);le(x,"Length Change Type",b(f.changer_length,"type"),de,Je);Q(x,"Length Change Param",b(f.changer_length,"param"),.1,-100,100);Ue(x,"Leaf Size",_.leaf_size,.1,.1,100,2);re(x,"Leaf Ratio",b(_,"leaf_ratio"),.05,0,1);Z(x,"Branch Color",D.R_0_255,_.branch_color);Z(x,"Leaf Color",D.R_0_255,_.leaf_color);Z(x,"Flower Inner Color",D.R_0_255,_.flower_inner_color);Z(x,"Flower Outer Color",D.R_0_255,_.flower_outer_color);const j=H(A,"Rules");G(j,"Rule Key",b(_,"rule_key"));G(j,"Rule Value",b(_,"rule_content"));ce(j,"Add rule",function(){_.rules[_.rule_key]=_.rule_content,he()});ce(j,"Clear rules",function(){_.rules={},z.children=[],he()});ze(j,"Rules:");z=Ot(j);const pe=H(A,"Generation");G(pe,"Input",b(_,"input"));re(pe,"Iterations",b(_,"iter"),1,1,10);ce(pe,"Generate",function(){F.vertices=[],F.indices=[],f.rules={};for(const o in _.rules){const s=_.rules[o];Et(f,o,s)}kt(f,_.input,_.iter);const e=F.vertices,n=F.indices,t=new ArrayBuffer(e.length*4),i=new DataView(t);for(let o=0;o<e.length;o+=4)i.setFloat32(o*4,e[o],!0),i.setFloat32(o*4+4,e[o+1],!0),i.setFloat32(o*4+8,e[o+2],!0),i.setInt32(o*4+12,e[o+3],!0);u.bindBuffer(u.ARRAY_BUFFER,$e),u.bufferData(u.ARRAY_BUFFER,t,u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,Ve),u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Uint32Array(n),u.STATIC_DRAW),qe=n.length});De(A);Ye(_.preset);const k=dt();k.scale=10;k.movement_speed=2;gt();function Zt(){O("KeyA")&&me(k,-1),O("KeyD")&&me(k,1),O("KeyS")&&ve(k,-1),O("KeyW")&&ve(k,1),O("KeyQ")&&(k.scale-=.1),O("KeyE")&&(k.scale+=.1),pt(k,U.width,U.height),ft(k)}u.enable(u.DEPTH_TEST);u.enable(u.BLEND);u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA);function Gt(){u.viewport(0,0,U.width,U.height),u.clearColor(0,0,0,1),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT),u.useProgram(_e),u.uniformMatrix4fv($t,!1,k.projection),u.uniformMatrix4fv(Vt,!1,k.view),u.bindVertexArray(We),u.drawElements(u.TRIANGLES,qe,u.UNSIGNED_INT,0)}function Qe(){Zt(),Gt(),requestAnimationFrame(Qe)}Qe();
