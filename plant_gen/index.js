var tt=Object.defineProperty;var nt=(e,n,t)=>n in e?tt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var r=(e,n,t)=>nt(e,typeof n!="symbol"?n+"":n,t);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();let w;function it(e){return w=e.getContext("webgl2")}function ot(e,n){const t=w.createShader(e);if(!t)return null;if(w.shaderSource(t,n),w.compileShader(t),!w.getShaderParameter(t,w.COMPILE_STATUS)){const o=w.getShaderInfoLog(t);return console.error(o),w.deleteShader(t),null}return t}function st(e){const n=w.createProgram(),t=[];for(const o in e){const s=e[o],l=ot(parseInt(o),s);if(!l){for(const c of t)w.deleteShader(c);return null}t.push(l)}for(const o of t)w.attachShader(n,o);w.linkProgram(n);for(const o of t)w.detachShader(n,o),w.deleteShader(o);if(!w.getProgramParameter(n,w.LINK_STATUS)){const o=w.getProgramInfoLog(n);return console.error(o),w.deleteProgram(n),null}return n}const M=Float32Array;function me(e=1,n=0,t=0,i=0,o=0,s,l=0,c=0,a=0,_=0,p,d=0,y=0,b=0,T=0,F){const m=new M(16);return m[0]=e,m[1]=n,m[2]=t,m[3]=i,m[4]=o,m[5]=e,m[6]=l,m[7]=c,m[8]=a,m[9]=_,m[10]=e,m[11]=d,m[12]=y,m[13]=b,m[14]=T,m[15]=e,m}function Le(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ve(e){return e*Math.PI/180}function g(e=0,n){const t=new M(2);return t[0]=e,t[1]=n??e,t}function Y(e){const n=new M(2);return n[0]=e[0],n[1]=e[1],n}function q(e,n){return e[0]=n[0],e[1]=n[1],e}function rt(e,n,t){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function ie(e,n){return rt(e,n,new M(2))}function Ne(e,n,t,i){return i[0]=e[0]+n[0]*t,i[1]=e[1]+n[1]*t,i}function A(e,n,t){return Ne(e,n,t,new M(2))}function Re(e,n,t){return Ne(e,n,t,e)}function lt(e,n){const t=e[0],i=e[1];let o=t*t+i*i;return o>0&&(o=1/Math.sqrt(o)),n[0]=t*o,n[1]=i*o,n}function Se(e){return lt(e,e)}function ct(e,n,t){const i=e[0]-n[0],o=e[1]-n[1];let s=i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=i*s,t[1]=o*s,t}function at(e,n){return ct(e,n,new M(2))}function ut(e,n,t,i){const o=n[0],s=n[1],l=e[0]-o,c=e[1]-s,a=Math.cos(t),_=Math.sin(t);return i[0]=l*a-c*_+o,i[1]=l*_+c*a+s,i}function V(e,n,t){return ut(e,n,t,e)}function _t(e,n,t){return t[0]=-(n[1]-e[1]),t[1]=n[0]-e[0],t}function Me(e,n){return _t(e,n,new M(2))}function ht(e,n,t,i){const o=e[0],s=e[1];return i[0]=o+t*(n[0]-o),i[1]=s+t*(n[1]-s),i}function dt(e,n,t){return ht(e,n,t,new M(2))}function pt(e,n,t){const i=n[0],o=n[1],s=n[2];return t[12]=e[0]*i+e[4]*o+e[8]*s+e[12],t[13]=e[1]*i+e[5]*o+e[9]*s+e[13],t[14]=e[2]*i+e[6]*o+e[10]*s+e[14],t[15]=e[3]*i+e[7]*o+e[11]*s+e[15],t}function ft(e,n,t){const i=n[0],o=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Te(e=0,n,t){const i=new M(3);return i[0]=e,i[1]=n??e,i[2]=t??e,i}class gt{constructor(){r(this,"position");r(this,"scale");r(this,"roll");r(this,"right");r(this,"up");r(this,"world_up");r(this,"projection");r(this,"view");r(this,"movement_speed");r(this,"roll_speed")}}function mt(){const e=new gt;return e.position=g(),e.right=g(1,0),e.up=g(0,1),e.world_up=g(0,1),e.projection=me(1),e.view=me(1),e.scale=50,e.roll=0,e.movement_speed=.1,e.roll_speed=.1,e}function we(e,n){Re(e.position,e.right,e.movement_speed*n)}function ye(e,n){Re(e.position,e.up,e.movement_speed*n)}function vt(e,n,t){return Le(e.projection),ft(e.projection,Te(e.scale/n,e.scale/t,1),e.projection),e.projection}function wt(e){return Le(e.view),pt(e.view,Te(-e.position[0],-e.position[1],0),e.view),e.view}const R={keys:{},buttons:{},kb_key_down:function(){},kb_key_up:function(){},m_move:function(){},m_button_down:function(){},m_button_up:function(){},m_wheel_scroll:function(){}};function yt(){addEventListener("keydown",function(e){R.keys[e.code]=0,R.kb_key_down({code:e.code,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey})}),addEventListener("keyup",function(e){R.keys[e.code]=1,R.kb_key_up({code:e.code,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey})}),addEventListener("mousemove",function(e){R.m_move({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target})}),addEventListener("mousedown",function(e){R.buttons[e.button]=0,R.m_button_down({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target})}),addEventListener("mouseup",function(e){R.buttons[e.button]=1,R.m_button_up({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target})}),addEventListener("wheel",function(e){R.m_wheel_scroll({xd:Math.sign(e.deltaX),yd:Math.sign(e.deltaY)})})}function C(e){return R.keys[e]===0}var I=(e=>(e[e.NONE=0]="NONE",e[e.LINEAR=1]="LINEAR",e[e.GEOMETRIC=2]="GEOMETRIC",e[e.EXPONENTIAL=3]="EXPONENTIAL",e))(I||{});class bt{constructor(){r(this,"type");r(this,"dir");r(this,"param")}}function Et(e,n){const t=new bt;return t.type=e,t.param=n,t}function be(){return Et(0,0)}function Ee(e,n){return e.type===1?n+e.param:e.type===2?n*e.param:e.type===3?Math.pow(n,e.param):n}class xt{constructor(){r(this,"position");r(this,"angle");r(this,"width");r(this,"length");r(this,"delta_angle");r(this,"changer_width");r(this,"changer_length");r(this,"rules");r(this,"callbacks")}}function kt(e,n,t,i){const o=new xt;return o.position=e,o.angle=n,o.width=t,o.length=i,o.delta_angle=90,o.changer_width=be(),o.changer_length=be(),o.rules={},o.callbacks={},o}class Ft{constructor(){r(this,"position");r(this,"angle");r(this,"width");r(this,"length")}}function xe(e,n,t,i){const o=new Ft;return o.position=Y(e),o.angle=n,o.width=t,o.length=i,o}class Lt{constructor(){r(this,"value");r(this,"prev");r(this,"next")}}function ke(e){const n=new Lt;return n.value=e,n.prev=null,n.next=null,n}function Nt(e,n,t){e.rules[n]=t}function oe(e,n,t){e.callbacks[n]=t}function Ie(e,n){const t=ke(n[0]);let i=t;for(let o=1;o<n.length;o+=1){const s=n[o],l=ke(s);l.prev=i,i.next=l,i=l}return[t,i]}function Rt(e,n){let t=n;for(;t;){const i=e.rules[t.value];if(i){const[o,s]=Ie(e,i);t.prev&&(t.prev.next=o),t.next&&(s.next=t.next,t.next.prev=s),o.prev=t.prev,t===n&&(n=o)}t=t.next}}function St(e,n,t){const[i]=Ie(e,n);for(let _=0;_<t;_+=1)Rt(e,i);const o=[];let s=xe(e.position,e.angle,e.width,e.length),l=i,c=Y(s.position),a=s.width;for(;l;){const _=l.value;switch(_){case"f":case"F":const p=g(Math.cos(ve(s.angle)),Math.sin(ve(s.angle))),d=A(s.position,p,s.length),y=Ee(e.changer_width,s.width),b=Ee(e.changer_length,s.length),T=e.callbacks[_];T&&T(Y(s.position),s.width,Y(d),y),q(c,s.position),a=s.width,q(s.position,d),s.width=y,s.length=b;break;case"-":s.angle+=e.delta_angle;break;case"+":s.angle-=e.delta_angle;break;case"[":o.push(xe(s.position,s.angle,s.width,s.length));break;case"]":const F=o.pop();F&&(s=F);break;default:{const m=e.callbacks[_];m&&m(c,a,s.position,s.width)}break}l=l.next}}function v(e=0,n,t,i){const o=new M(4);return o[0]=e,o[1]=n??e,o[2]=t??e,o[3]=i??e,o}function G(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function W(e){return((e[0]&255)<<24|(e[1]&255)<<16|(e[2]&255)<<8|e[3]&255)>>>0}function se(e,n,t){return Math.min(Math.max(e,n),t)}var B=(e=>(e[e.PX=0]="PX",e[e.PCT=1]="PCT",e[e.FR=2]="FR",e))(B||{});const Mt={0:"px",1:"%",2:"fr"};class Tt{constructor(){r(this,"x");r(this,"u")}}function K(e,n){const t=new Tt;return t.x=e,t.u=n,t}function It(e){return`${e.x}${Mt[e.u]}`}class At{constructor(){r(this,"type");r(this,"object");r(this,"key");r(this,"call_get");r(this,"call_set")}get(){return this.type===0?this.object[this.key]:this.call_get()}set(n){this.type===0?this.object[this.key]=n:this.call_set(n)}}function E(e,n){const t=new At;return t.type=0,t.object=e,t.key=n,t}function P(e,n){if(!e)return null;const t=document.createElement("span");return t.className="gui_label",t.innerHTML=e,n.append(t),t}function X(){const e=document.createElement("div");return e.className="gui_container",e}function Z(e,n,t,i,o){const s=document.createElement("input");return s.className="gui_input",s.type=e,s.step=t.toString(),s.min=i.toString(),s.max=o.toString(),s.value=n.toString(),s}class x{constructor(){r(this,"parent");r(this,"children",[]);r(this,"ref_el")}container(){return this.ref_el}render(){}mount(){}static mount(){}update(){}}class Ae extends x{constructor(){super(...arguments);r(this,"id");r(this,"title");r(this,"grid_x");r(this,"grid_y");r(this,"layout");r(this,"window_parent");r(this,"window_children")}grid_str(t){let i="";for(let o=0;o<t.length;o+=1){const s=t[o];i+=It(s),o<t.length-1&&(i+=" ")}return i}layout_str(){let t="";const i=this.grid_x.length,o=this.grid_y.length,s=i*o;for(let l=0;l<s;l+=i){let c="";for(let a=l;a<l+i;a+=1){const _=this.layout[a];c+=`w${_}`,a<l+i-1&&(c+=" ")}t+=`"${c}"
`}return t}render(){const t=document.createElement("div");this.window_parent?t.className="gui_window":t.className="gui_window_root",this.window_children.length?(t.style.display="grid",t.style.gridTemplateColumns=this.grid_str(this.grid_x),t.style.gridTemplateRows=this.grid_str(this.grid_y),t.style.gridTemplateAreas=this.layout_str()):t.style.gridArea=`w${this.id}`,this.ref_el=t}}class re extends x{constructor(){super(...arguments);r(this,"title");r(this,"is_collapsed");r(this,"container_el")}container(){return this.container_el}render(){const t=document.createElement("div");t.className="gui_collapsing_header"+(this.is_collapsed?" gui_is_collapsed":"");const i=document.createElement("div");i.className="gui_title",i.innerHTML=this.title,t.append(i),i.onclick=(function(){this.is_collapsed?(this.is_collapsed=!1,t.classList.remove("gui_is_collapsed")):(this.is_collapsed=!0,t.classList.add("gui_is_collapsed"))}).bind(this);const o=X();t.append(o),this.ref_el=t,this.container_el=o}}class Pt extends x{constructor(){super(...arguments);r(this,"condition")}render(){const t=document.createElement("div");t.className="gui_group",this.condition()?t.style.display="block":t.style.display="none",this.ref_el=t}update(){this.condition()?this.ref_el.style.display="block":this.ref_el.style.display="none"}}class Pe extends x{constructor(){super(...arguments);r(this,"value")}render(){const t=document.createElement("div");t.className="gui_text",t.innerHTML=this.value,this.ref_el=t}}class Bt extends x{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"onchange");r(this,"input_el")}render(){const t=document.createElement("div");t.className="gui_bool";const i=document.createElement("div");i.className="gui_checkbox_group_option"+(this.value.get()?" gui_selected":""),i.innerHTML=this.label,t.append(i),i.onclick=(function(){this.value.get()?(this.value.set(!1),i.classList.remove("gui_selected")):(this.value.set(!0),i.classList.add("gui_selected")),this.onchange(this.value.get())}).bind(this),this.ref_el=t,this.input_el=i}update(){this.value.get()?this.input_el.classList.add("gui_selected"):this.input_el.classList.remove("gui_selected")}}class Be extends x{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"step");r(this,"min");r(this,"max");r(this,"onchange");r(this,"input_el")}render(){const t=document.createElement("div");t.className="gui_input_number",P(this.label,t);const i=Z("number",this.value.get(),this.step,this.min,this.max);t.append(i),i.onchange=(function(){const o=se(parseFloat(i.value),this.min,this.max);this.value.set(o),i.value=o.toString(),this.onchange(o)}).bind(this),this.ref_el=t,this.input_el=i}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString())}}class Oe extends x{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"step");r(this,"min");r(this,"max");r(this,"container_el");r(this,"onchange");r(this,"input_el")}render(){const t=document.createElement("div");t.className="gui_slider_number",P(this.label,t);const i=X();i.className="gui_input_range_container",t.append(i);const o=Z("range",this.value.get(),this.step,this.min,this.max);o.className="gui_input_range",i.dataset.content=o.value,i.append(o),o.onchange=(function(){const s=se(parseFloat(o.value),this.min,this.max);this.value.set(s),i.dataset.content=o.value,this.onchange(s)}).bind(this),o.onmousemove=function(){i.dataset.content=o.value},this.ref_el=t,this.container_el=i,this.input_el=o}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString(),this.container_el.dataset.content=this.input_el.value)}}class Ce extends x{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"step");r(this,"min");r(this,"max");r(this,"size");r(this,"onchange");r(this,"input_els")}render(){const t=document.createElement("div");t.className="gui_input_vec",t.style.setProperty("--size",this.size.toString()),P(this.label,t);const i=X();t.append(i);const o=[];for(let s=0;s<this.value.length;s+=1){const l=Z("number",this.value[s],this.step,this.min,this.max);i.append(l),l.onchange=(function(){const c=se(parseFloat(l.value),this.min,this.max);this.value[s]=c,l.value=c.toString(),this.onchange(this.value)}).bind(this),o.push(l)}this.ref_el=t,this.input_els=o}update(){for(let t=0;t<this.value.length;t+=1){const i=this.input_els[t];document.activeElement!=i&&(i.value=this.value[t].toString())}}}var H=(e=>(e[e.R_0_1=0]="R_0_1",e[e.R_0_255=1]="R_0_255",e))(H||{});class Ke extends x{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"mode");r(this,"onchange");r(this,"input_el");r(this,"range_container_el");r(this,"range_el")}to_hex(t,i,o){const s=this.mode===0?255:1,l=Math.round(t*s).toString(16).padStart(2,"0"),c=Math.round(i*s).toString(16).padStart(2,"0"),a=Math.round(o*s).toString(16).padStart(2,"0");return`#${l}${c}${a}`}from_hex(t){const i=t.replace(/^#/,""),o=this.mode===0?255:1,s=parseInt(i.substring(0,2),16)/o,l=parseInt(i.substring(2,4),16)/o,c=parseInt(i.substring(4,6),16)/o;return[s,l,c]}render(){const t=document.createElement("div");t.className="gui_color_edit"+(this.value.length===4?" gui_rgba":""),P(this.label,t);const i=X();t.append(i);const o=document.createElement("input");if(o.className="gui_input_color",o.type="color",o.value=this.to_hex(this.value[0],this.value[1],this.value[2]),i.append(o),o.onchange=(function(){const s=this.from_hex(o.value);this.value[0]=s[0],this.value[1]=s[1],this.value[2]=s[2],this.onchange(this.value)}).bind(this),this.value.length==4){const s=document.createElement("div");s.className="gui_input_range_container",i.append(s);const l=Z("range",this.value[3],.01,0,1);l.className="gui_input_range",s.dataset.content=l.value,s.append(l),l.onchange=(function(){this.value[3]=parseFloat(l.value)*(this.mode===1?255:1),s.dataset.content=l.value,this.onchange(this.value)}).bind(this),l.onmousemove=function(){s.dataset.content=l.value},this.range_el=l,this.range_container_el=s}this.ref_el=t,this.input_el=o}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.to_hex(this.value[0],this.value[1],this.value[2])),this.range_container_el&&this.range_el&&document.activeElement!=this.range_el&&(this.range_el.value=this.value[3].toString(),this.range_container_el.dataset.content=this.range_el.value)}}class Xe extends x{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"onchange");r(this,"input_el")}render(){const t=document.createElement("div");t.className="gui_input_text",P(this.label,t);const i=document.createElement("input");i.className="gui_input",i.type="text",i.value=this.value.get().toString(),t.append(i),i.onchange=(function(){this.value.set(i.value),this.onchange(i.value)}).bind(this),this.ref_el=t,this.input_el=i}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString())}}class Ot extends x{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"keys");r(this,"values");r(this,"onchange");r(this,"option_els")}render(){const t=document.createElement("div");t.className="gui_radio_group",P(this.label,t);const i=X();t.append(i);const o=[],s=this.value.get();for(let l=0;l<this.keys.length;l+=1){const c=this.keys[l],a=this.values[l],_=document.createElement("div");_.className="gui_radio_group_option"+(a===s?" gui_selected":""),_.innerHTML=c,i.append(_),_.onclick=(function(){this.value.set(a);for(const p of this.option_els)p.classList.remove("gui_selected");_.classList.add("gui_selected"),this.onchange(a)}).bind(this),o.push(_)}this.ref_el=t,this.option_els=o}update(){const t=this.value.get();for(let i=0;i<this.option_els.length;i+=1){const o=this.option_els[i];this.values[i]===t?o.classList.add("gui_selected"):o.classList.remove("gui_selected")}}}class Ct extends x{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"keys");r(this,"values");r(this,"onchange");r(this,"option_els")}render(){const t=document.createElement("div");t.className="gui_checkbox_group",P(this.label,t);const i=X();t.append(i);const o=[],s=this.value.get();for(let l=0;l<this.keys.length;l+=1){const c=this.keys[l],a=this.values[l],_=document.createElement("div");_.className="gui_checkbox_group_option"+(s.indexOf(a)>-1?" gui_selected":""),_.innerHTML=c,i.append(_),_.onclick=(function(){_.classList.contains("gui_selected")?(s.splice(s.indexOf(a),1),_.classList.remove("gui_selected")):(s.push(a),_.classList.add("gui_selected")),this.onchange(this.value.get())}).bind(this),o.push(_)}this.ref_el=t,this.option_els=o}update(){const t=this.value.get();for(let i=0;i<this.option_els.length;i+=1){const o=this.option_els[i];t.indexOf(this.values[i])>-1?o.classList.add("gui_selected"):o.classList.remove("gui_selected")}}}class je extends x{constructor(){super(...arguments);r(this,"label");r(this,"value");r(this,"keys");r(this,"values");r(this,"onchange");r(this,"button_el");r(this,"option_els")}render(){const t=document.createElement("div");t.className="gui_select",P(this.label,t);const i=document.createElement("div");i.className="gui_select",t.append(i),i.onclick=function(a){a.stopPropagation()};const o=document.createElement("div");o.className="gui_select_button",o.innerHTML="Select",i.append(o),o.onclick=function(){o.classList.contains("gui_open")?o.classList.remove("gui_open"):o.classList.add("gui_open")};const s=document.createElement("div");s.className="gui_select_container",i.append(s);const l=[],c=this.value.get();for(let a=0;a<this.keys.length;a+=1){const _=this.keys[a];this.values[a]===c&&(o.innerHTML=_);const d=document.createElement("div");d.className="gui_select_option",d.innerHTML=_,d.dataset.value=a.toString(),s.append(d),d.onclick=(function(){const y=this.values[parseInt(d.dataset.value||"")];this.value.set(y),o.innerHTML=_,o.classList.remove("gui_open"),this.onchange(y)}).bind(this),l.push(d)}this.ref_el=t,this.button_el=o,this.option_els=l}static mount(){const t=document.body.querySelector(".gui_window_root");t&&t.addEventListener("click",function(){const i=document.body.querySelector(".gui_select_button.gui_open");i&&i.classList.remove("gui_open")})}update(){const t=this.value.get();for(let i=0;i<this.option_els.length;i+=1)if(this.values[i]===t){this.button_el.innerHTML=this.keys[i];return}}}class ze extends x{constructor(){super(...arguments);r(this,"label");r(this,"onclick")}render(){const t=document.createElement("div");t.className="gui_button";const i=document.createElement("button");i.innerHTML=this.label,i.onclick=this.onclick,t.append(i),this.ref_el=t}}class De extends x{constructor(){super(...arguments);r(this,"auto_resize");r(this,"canvas_el")}render(){const t=document.createElement("div");t.className="gui_canvas";const i=document.createElement("canvas");t.append(i),this.auto_resize&&window.addEventListener("resize",function(){var o,s;i.width=((o=i.parentElement)==null?void 0:o.clientWidth)||0,i.height=((s=i.parentElement)==null?void 0:s.clientHeight)||0}),this.ref_el=t,this.canvas_el=i}mount(){var t,i;this.auto_resize&&(this.canvas_el.width=((t=this.canvas_el.parentElement)==null?void 0:t.clientWidth)||0,this.canvas_el.height=((i=this.canvas_el.parentElement)==null?void 0:i.clientHeight)||0)}}const Kt=[Ae,re,Pe,Bt,Be,Oe,Ce,Ke,Xe,Ot,Ct,je,ze,De];let Fe=0;function le(e,n=""){const t=new Ae;return t.id=Fe,t.title=n,t.grid_x=[],t.grid_y=[],t.layout=[],t.window_parent=e,t.window_children=[],t.parent=e,e&&(e.children.push(t),e.window_children.push(t)),Fe+=1,t}function Xt(e,n,t){e.grid_x=n,e.grid_y=t}function jt(e,n){const t=[];for(const i of n)t.push(i.id);e.layout=t}function U(e,n,t=!1){const i=new re;return i.title=n,i.is_collapsed=t,i.parent=e,e.children.push(i),i}function zt(e,n=()=>!0){const t=new Pt;return t.condition=n,t.parent=e,e.children.push(t),t}function We(e,n){const t=new Pe;return t.value=n,t.parent=e,e.children.push(t),t}function Q(e,n,t,i,o,s,l=()=>{}){const c=new Be;return c.label=n,c.value=t,c.step=i,c.min=o,c.max=s,c.onchange=l,c.parent=e,e.children.push(c),c}function ce(e,n,t,i,o,s,l=()=>{}){const c=new Oe;return c.label=n,c.value=t,c.step=i,c.min=o,c.max=s,c.onchange=l,c.parent=e,e.children.push(c),c}function He(e,n,t,i,o,s,l,c=()=>{}){const a=new Ce;return a.label=n,a.value=t,a.step=i,a.min=o,a.max=s,a.size=l,a.onchange=c,a.parent=e,e.children.push(a),a}function ee(e,n,t,i,o=()=>{}){const s=new Ke;return s.label=n,s.value=i,s.mode=t,s.onchange=o,s.parent=e,e.children.push(s),s}function te(e,n,t,i=()=>{}){const o=new Xe;return o.label=n,o.value=t,o.onchange=i,o.parent=e,e.children.push(o),o}function ne(e,n,t,i,o,s=()=>{}){const l=new je;return l.label=n,l.value=t,l.keys=i,l.values=o,l.onchange=s,l.parent=e,e.children.push(l),l}function ae(e,n,t){const i=new ze;return i.label=n,i.onclick=t,i.parent=e,e.children.push(i),i}function Dt(e,n=!0){const t=new De;return t.auto_resize=n,t.parent=e,e.children.push(t),t}function ue(e,n){e.render(),n.append(e.ref_el),e.mount();for(const t of e.children)ue(t,e.container())}function Ue(e){var i;if(!((i=e.parent)==null?void 0:i.ref_el))return;const t=e.ref_el;e.render(),t.replaceWith(e.ref_el),e.mount();for(const o of e.children)ue(o,e.container())}function Wt(e,n,t=!0){if(ue(e,n),!!t)for(const i of Kt)i.mount()}function $e(e){if(!(e instanceof re&&e.is_collapsed)){e.update();for(const n of e.children)$e(n)}}var _e=(e=>(e[e.BOX=0]="BOX",e[e.KITE=1]="KITE",e))(_e||{});const he=[{name:"Flower 1",position:g(0,-80),width:4,length:20,angle:90,delta_angle:40,input:"F[-fL]F[+fL]FBFFFBBFFFFFJ",rules:{B:"[-CCCFFJ][+CCCFFJ]",C:"F[-FJ][+FJ]"},iter:3,branch_color:v(25,99,30,255),leaf_color:v(25,99,30,255),flower_inner_color:v(224,194,61,255),flower_outer_color:v(71,76,166,255),leaf_type:1,leaf_size:g(5,20),leaf_ratio:.5,flower_inner_radius:1.5,flower_outer_radius:3,width_changer_type:I.GEOMETRIC,width_changer_param:.8,length_changer_type:I.GEOMETRIC,length_changer_param:.8},{name:"Flower 2",position:g(0,-80),width:1,length:20,angle:90,delta_angle:40,input:"F[+fL]F[-fL]FJ",rules:{},iter:1,branch_color:v(87,212,130,255),leaf_color:v(87,212,130,255),flower_inner_color:v(235,207,52,255),flower_outer_color:v(235,52,171,255),leaf_type:1,leaf_size:g(4,20),leaf_ratio:.5,flower_inner_radius:3,flower_outer_radius:6,width_changer_type:I.NONE,width_changer_param:0,length_changer_type:I.NONE,length_changer_param:0},{name:"Tree 1",position:g(0,-80),width:12,length:15,angle:90,delta_angle:25,input:"FFFFFB",rules:{B:"[-FBfL][+FBfL]"},iter:7,branch_color:v(161,90,43,255),leaf_color:v(163,207,60,255),flower_inner_color:v(235,207,52,255),flower_outer_color:v(235,52,171,255),leaf_type:1,leaf_size:g(3,5),leaf_ratio:.5,flower_inner_radius:3,flower_outer_radius:6,width_changer_type:I.GEOMETRIC,width_changer_param:.7,length_changer_type:I.GEOMETRIC,length_changer_param:.95},{name:"Tree 2",position:g(0,-80),width:12,length:20,angle:90,delta_angle:30,input:"FFX",rules:{X:"F[-FXL][+FXL]X"},iter:4,branch_color:v(161,90,43,255),leaf_type:1,leaf_color:v(163,207,60,255),flower_inner_color:v(235,207,52,255),flower_outer_color:v(235,52,171,255),leaf_size:g(30),leaf_ratio:.5,flower_inner_radius:3,flower_outer_radius:6,width_changer_type:I.GEOMETRIC,width_changer_param:.7,length_changer_type:I.GEOMETRIC,length_changer_param:.95}];class Ht{constructor(){r(this,"stride");r(this,"vertices");r(this,"indices")}}function $(e){return e.vertices.length/e.stride}function Ut(e,n,t,i,o,s){const l=$(s),c=e[0],a=e[1],_=n[0]/2,p=n[1]/2,d=g(c-_,a+p),y=g(c-_,a-p),b=g(c+_,a-p),T=g(c+_,a+p);t!==0&&(V(d,e,t),V(y,e,t),V(b,e,t),V(T,e,t));const F=W(o);s.vertices.push(...d,i,F,...y,i,F,...b,i,F,...T,i,F),s.indices.push(l,l+1,l+2,l,l+2,l+3)}function $t(e,n,t,i,o,s){const l=$(s),c=Math.PI*2/t,a=Math.PI/t,_=W(o);for(let p=0;p<t;p+=1){const d=ie(e,g(Math.cos(c*p+a)*n,Math.sin(c*p+a)*n));s.vertices.push(...d,i,_)}for(let p=1;p<t-1;p+=1)s.indices.push(l,l+p,l+p+1)}function Jt(e,n,t,i,o,s,l){const c=$(l),a=Se(Me(t,e)),_=n/2,p=i/2,d=A(e,a,-_),y=A(e,a,_),b=A(t,a,p),T=A(t,a,-p),F=W(s);l.vertices.push(...d,o,F,...y,o,F,...b,o,F,...T,o,F),l.indices.push(c,c+1,c+2,c,c+2,c+3)}function Vt(e,n,t,i,o,s,l){const c=$(l),a=Se(Me(n,e)),_=t/2,p=dt(e,n,i),d=A(p,a,-_),y=A(p,a,_),b=W(s);l.vertices.push(...e,-.5,b,...y,-.5,b,...n,-.5,b,...d,-.5,b),l.indices.push(c,c+1,c+2,c,c+2,c+3)}function Gt(e,n,t,i,o,s,l){const c=$(l),a=Math.PI*2/i,_=Math.PI/i,p=W(s);for(let d=0;d<i;d+=1){const y=ie(e,g(Math.cos(a*d+_)*t,Math.sin(a*d+_)*t)),b=ie(e,g(Math.cos(a/2+a*d+_)*n,Math.sin(a/2+a*d+_)*n));l.vertices.push(...y,o,p,...b,o,p)}for(let d=1;d<i-1;d+=1)l.indices.push(c,c+d*2,c+d*2+2);for(let d=0;d<i;d+=1)l.indices.push(c+d*2,c+d*2+1,c+(d+1)*2%(i*2))}const J=le(null);Xt(J,[K(300,B.PX),K(1,B.FR),K(300,B.PX)],[K(1,B.FR),K(1,B.FR),K(1,B.FR)]);const S=le(J),O=le(J);jt(J,[S,O,O,S,O,O,S,O,O]);const Yt=Dt(O,!0);Wt(J,document.body);const D=Yt.canvas_el,u=it(D),de=st({[u.VERTEX_SHADER]:`#version 300 es
        layout(location = 0) in vec3 i_position;
        layout(location = 1) in int i_color;
        uniform mat4 u_projection;
        uniform mat4 u_view;
        flat out int v_color;

        void main() {
            gl_Position = u_projection * u_view * vec4(i_position, 1.0);
            v_color = i_color;
        }
    `,[u.FRAGMENT_SHADER]:`#version 300 es
        precision highp float;
        flat in int v_color;
        out vec4 o_frag_color;

        vec4 unpack256(int packed) {
            return vec4(
                (packed >> 24) & 0xFF,
                (packed >> 16) & 0xFF,
                (packed >> 8) & 0xFF,
                packed & 0xFF
            ) / 255.0;
        }

        void main() {
            o_frag_color = unpack256(v_color);
        }
    `}),qt=u.getUniformLocation(de,"u_projection"),Zt=u.getUniformLocation(de,"u_view"),Je=u.createVertexArray();u.bindVertexArray(Je);const Ve=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,Ve);u.bufferData(u.ARRAY_BUFFER,null,u.STATIC_DRAW);u.enableVertexAttribArray(0);u.vertexAttribPointer(0,3,u.FLOAT,!1,16,0);u.enableVertexAttribArray(1);u.vertexAttribIPointer(1,1,u.INT,16,12);const Ge=u.createBuffer();u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,Ge);u.bufferData(u.ELEMENT_ARRAY_BUFFER,null,u.STATIC_DRAW);let h={input:"",iter:0,preset:0,rule_key:"",rule_content:"",rules:{},branch_color:v(255),leaf_color:v(255),flower_inner_color:v(255),flower_outer_color:v(255),leaf_size:g(1),leaf_ratio:.5,leaf_type:_e.BOX,flower_inner_radius:1,flower_outer_radius:2};const f=kt(g(0,-100),90,20,40);f.delta_angle=20;const L=new Ht;L.vertices=[];L.indices=[];L.stride=4;let Ye=L.indices.length;oe(f,"L",function(e,n,t,i){h.leaf_type===_e.BOX?Ut(e,h.leaf_size,Math.random(),-.2,h.leaf_color,L):Vt(e,A(e,at(t,e),h.leaf_size[1]),h.leaf_size[0],h.leaf_ratio,-.2,h.leaf_color,L)});oe(f,"J",function(e,n,t,i){Gt(t,h.flower_outer_radius,h.flower_outer_radius*.8,10,-.1,h.flower_outer_color,L),$t(t,h.flower_inner_radius,6,-.2,h.flower_inner_color,L)});oe(f,"F",function(e,n,t,i){Jt(e,n,t,i,0,h.branch_color,L)});let z;function pe(){z.children=[];for(const e in h.rules)te(z,e,E(h.rules,e));Ue(z)}const Qt=U(S,"Info",!0);We(Qt,`
<pre>
Camera controls:
    WASD - Move
    Q/E - Zoom In/Out
Language:
    "f" - Move forward
    "F" - Move forward and draw
    "-" - Rotate CCW
    "+" - Rotate CW
    "L" - Draw leaf
    "J" - Draw flower

For rules use single character names like "X"
</pre>
`);const en=U(S,"Presets");function qe(e){const n=he[e];h.input=n.input,h.iter=n.iter,G(h.branch_color,n.branch_color),G(h.leaf_color,n.leaf_color),G(h.flower_inner_color,n.flower_inner_color),G(h.flower_outer_color,n.flower_outer_color),h.leaf_type=n.leaf_type,q(h.leaf_size,n.leaf_size),h.leaf_ratio=n.leaf_ratio,h.flower_inner_radius=n.flower_inner_radius,h.flower_outer_radius=n.flower_outer_radius,f.angle=n.angle,f.delta_angle=n.delta_angle,f.length=n.length,f.width=n.width,f.changer_length.type=n.length_changer_type,f.changer_length.param=n.length_changer_param,f.changer_width.type=n.width_changer_type,f.changer_width.param=n.width_changer_param,q(f.position,n.position),h.rules={};for(const t in n.rules){const i=n.rules[t];h.rules[t]=i}pe(),$e(S)}const tn=he.map(e=>e.name),nn=Object.keys(he).map(e=>parseInt(e));ne(en,"Preset",E(h,"preset"),tn,nn,function(e){qe(e)});const fe=["NONE","LINEAR","GEOMETRIC","EXPONENTIAL"],Ze=Object.keys(fe).map(e=>parseInt(e)),Qe=["BOX","KITE"],on=Object.keys(Qe).map(e=>parseInt(e)),k=U(S,"Settings");He(k,"Start Position",f.position,1,-100,100,2);ce(k,"Start Angle",E(f,"angle"),1,-180,180);Q(k,"Start Width",E(f,"width"),.1,.1,100);Q(k,"Start Length",E(f,"length"),.1,.1,100);ne(k,"Width Change Type",E(f.changer_width,"type"),fe,Ze);Q(k,"Width Change Param",E(f.changer_width,"param"),.1,-100,100);ne(k,"Length Change Type",E(f.changer_length,"type"),fe,Ze);Q(k,"Length Change Param",E(f.changer_length,"param"),.1,-100,100);ne(k,"Leaf Type",E(h,"leaf_type"),Qe,on);He(k,"Leaf Size",h.leaf_size,.1,.1,100,2);ce(k,"Leaf Ratio",E(h,"leaf_ratio"),.05,0,1);ee(k,"Branch Color",H.R_0_255,h.branch_color);ee(k,"Leaf Color",H.R_0_255,h.leaf_color);ee(k,"Flower Inner Color",H.R_0_255,h.flower_inner_color);ee(k,"Flower Outer Color",H.R_0_255,h.flower_outer_color);const j=U(S,"Rules");te(j,"Rule Key",E(h,"rule_key"));te(j,"Rule Value",E(h,"rule_content"));ae(j,"Add rule",function(){/^[a-zA-Z]$/.test(h.rule_key)&&/^[a-zA-Z+-]+$/.test(h.rule_content)&&(h.rules[h.rule_key]=h.rule_content,pe())});ae(j,"Clear rules",function(){h.rules={},z.children=[],pe()});We(j,"Rules:");z=zt(j);const ge=U(S,"Generation");te(ge,"Input",E(h,"input"));ce(ge,"Iterations",E(h,"iter"),1,1,10);ae(ge,"Generate",function(){L.vertices=[],L.indices=[],f.rules={};for(const o in h.rules){const s=h.rules[o];Nt(f,o,s)}St(f,h.input,h.iter);const e=L.vertices,n=L.indices,t=new ArrayBuffer(e.length*4),i=new DataView(t);for(let o=0;o<e.length;o+=4)i.setFloat32(o*4,e[o],!0),i.setFloat32(o*4+4,e[o+1],!0),i.setFloat32(o*4+8,e[o+2],!0),i.setInt32(o*4+12,e[o+3],!0);u.bindBuffer(u.ARRAY_BUFFER,Ve),u.bufferData(u.ARRAY_BUFFER,t,u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,Ge),u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Uint32Array(n),u.STATIC_DRAW),Ye=n.length});Ue(S);qe(h.preset);const N=mt();N.scale=10;N.movement_speed=2;yt();function sn(){C("KeyA")&&we(N,-1),C("KeyD")&&we(N,1),C("KeyS")&&ye(N,-1),C("KeyW")&&ye(N,1),C("KeyQ")&&(N.scale-=.1),C("KeyE")&&(N.scale+=.1),vt(N,D.width,D.height),wt(N)}u.enable(u.DEPTH_TEST);u.enable(u.BLEND);u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA);function rn(){u.viewport(0,0,D.width,D.height),u.clearColor(0,0,0,1),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT),u.useProgram(de),u.uniformMatrix4fv(qt,!1,N.projection),u.uniformMatrix4fv(Zt,!1,N.view),u.bindVertexArray(Je),u.drawElements(u.TRIANGLES,Ye,u.UNSIGNED_INT,0)}function et(){sn(),rn(),requestAnimationFrame(et)}et();
