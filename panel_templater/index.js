var $e=Object.defineProperty;var Oe=(e,i,t)=>i in e?$e(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var c=(e,i,t)=>Oe(e,typeof i!="symbol"?i+"":i,t);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function X(e){return e*Math.PI/180}const Ye=Math.atan2,ze=Math.floor;function Ce(e,i,t){return Math.min(Math.max(e,i),t)}const F=Float32Array;function ne(e,i){const t=new F(4);return t[0]=e[0],t[1]=e[1],t[2]=i[0],t[3]=i[1],t}function Ae(e,i){const t=new F(2),n=e[0],s=e[1],o=e[2]-n,l=e[3]-s,a=i[0]-n,u=i[1]-s,_=(o*a+l*u)/(o*o+l*l);return t[0]=n+o*_,t[1]=s+l*_,t}function _e(e,i){const t=e[0],n=e[1],s=e[2]-t,o=e[3]-n,l=i[0]-t,a=i[1]-n,u=(s*l+o*a)/(s*s+o*o),_=t+s*u,k=n+o*u;return Math.hypot(i[0]-_,i[1]-k)}function f(e=0,i){const t=new F(2);return t[0]=e,t[1]=i??e,t}function je(e,i){const t=new F(2);return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function B(e,i){const t=new F(2);return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function We(e,i){const t=new F(2);return t[0]=e[0]/i,t[1]=e[1]/i,t}function qe(e){return Math.hypot(e[0],e[1])}function Ge(e,i){const t=new F(2);return t[0]=Math.round(e[0]/i[0])*i[0],t[1]=Math.round(e[1]/i[1])*i[1],t}function De(e,i){return[f(e[0],e[1]),f(i[0],e[1]),f(i[0],i[1]),f(e[0],i[1])]}function de(e,i){const t=i[0],n=i[1];let s=!1;for(let _=0,k=e.length-1;_<e.length;k=_++){var o=e[_][0],l=e[_][1],a=e[k][0],u=e[k][1];l>n!=u>n&&t<(a-o)*(n-l)/(u-l)+o&&(s=!s)}return s}function Be(e){let i=0,t=0;for(let o=0;o<e.length;o++){const l=e[o];i+=l[0],t+=l[1]}const n=i/e.length,s=t/e.length;return f(n,s)}function ge(e){let i=1/0,t=1/0,n=-1/0,s=-1/0;for(let o=0;o<e.length;o++){const l=e[o],a=l[0],u=l[1];i=Math.min(i,a),t=Math.min(t,u),n=Math.max(n,a),s=Math.max(s,u)}return{min:f(i,t),max:f(n,s)}}function P(e,i,t,n){i=f(i[0]+Math.cos(t+Math.PI/2)*n,i[1]+Math.sin(t+Math.PI/2)*n);let s=f(i[0]+Math.cos(t),i[1]+Math.sin(t));const o=[];for(let l=0;l<e.length;++l){const a=e[l],u=e[(l+1)%e.length],_=(u[1]-a[1])*(s[0]-i[0])-(u[0]-a[0])*(s[1]-i[1]);if(_==0)continue;const k=(u[0]-a[0])*(i[1]-a[1])-(u[1]-a[1])*(i[0]-a[0]),E=(s[0]-i[0])*(i[1]-a[1])-(s[1]-i[1])*(i[0]-a[0]),W=k/_,ue=E/_;if(ue>0&&ue<1){const He=i[0]+W*(s[0]-i[0]),Re=i[1]+W*(s[1]-i[1]),Xe=f(He,Re);o.push({point:Xe,index:l})}if(o.length==2)break}return o}function z(e=0,i,t){const n=new F(3);return n[0]=e,n[1]=i??e,n[2]=t??e,n}const Ve=25.4;function M(e,i){return Math.round(e/Ve*i)}function oe(e,i,t){return Math.min(Math.max(e,i),t)}var H=(e=>(e[e.PX=0]="PX",e[e.PCT=1]="PCT",e[e.FR=2]="FR",e))(H||{});const Je={0:"px",1:"%",2:"fr"};class Qe{constructor(){c(this,"x");c(this,"u")}}function $(e,i){const t=new Qe;return t.x=e,t.u=i,t}function Ze(e){return`${e.x}${Je[e.u]}`}class Ue{constructor(){c(this,"type");c(this,"object");c(this,"key");c(this,"call_get");c(this,"call_set")}get(){return this.type===0?this.object[this.key]:this.call_get()}set(i){this.type===0?this.object[this.key]=i:this.call_set(i)}}function S(e,i){const t=new Ue;return t.type=0,t.object=e,t.key=i,t}function I(e,i){if(!e)return null;const t=document.createElement("span");return t.className="gui_label",t.innerHTML=e,i.append(t),t}function C(){const e=document.createElement("div");return e.className="gui_container",e}function ee(e,i,t,n,s){const o=document.createElement("input");return o.className="gui_input",o.type=e,o.step=t.toString(),o.min=n.toString(),o.max=s.toString(),o.value=i.toString(),o}class y{constructor(){c(this,"children",[]);c(this,"ref_el")}container(){return this.ref_el}render(){}mount(){}static mount(){}update(){}}class fe extends y{constructor(){super(...arguments);c(this,"id");c(this,"title");c(this,"grid_x");c(this,"grid_y");c(this,"layout");c(this,"window_parent");c(this,"window_children")}grid_str(t){let n="";for(let s=0;s<t.length;s+=1){const o=t[s];n+=Ze(o),s<t.length-1&&(n+=" ")}return n}layout_str(){let t="";const n=this.grid_x.length,s=this.grid_y.length,o=n*s;for(let l=0;l<o;l+=n){let a="";for(let u=l;u<l+n;u+=1){const _=this.layout[u];a+=`w${_}`,u<l+n-1&&(a+=" ")}t+=`"${a}"
`}return t}render(){const t=document.createElement("div");this.window_parent?t.className="gui_window":t.className="gui_window_root",this.window_children.length?(t.style.display="grid",t.style.gridTemplateColumns=this.grid_str(this.grid_x),t.style.gridTemplateRows=this.grid_str(this.grid_y),t.style.gridTemplateAreas=this.layout_str()):t.style.gridArea=`w${this.id}`,this.ref_el=t}}class le extends y{constructor(){super(...arguments);c(this,"title");c(this,"is_collapsed");c(this,"container_el")}container(){return this.container_el}render(){const t=document.createElement("div");t.className="gui_collapsing_header"+(this.is_collapsed?" gui_is_collapsed":"");const n=document.createElement("div");n.className="gui_title",n.innerHTML=this.title,t.append(n),n.onclick=(function(){this.is_collapsed?(this.is_collapsed=!1,t.classList.remove("gui_is_collapsed")):(this.is_collapsed=!0,t.classList.add("gui_is_collapsed"))}).bind(this);const s=C();t.append(s),this.ref_el=t,this.container_el=s}}class ve extends y{constructor(){super(...arguments);c(this,"value")}render(){const t=document.createElement("div");t.className="gui_text",t.innerHTML=this.value,this.ref_el=t}}class ye extends y{constructor(){super(...arguments);c(this,"label");c(this,"value");c(this,"onchange");c(this,"input_el")}render(){const t=document.createElement("div");t.className="gui_bool";const n=document.createElement("div");n.className="gui_checkbox_group_option"+(this.value.get()?" gui_selected":""),n.innerHTML=this.label,t.append(n),n.onclick=(function(){this.value.get()?(this.value.set(!1),n.classList.remove("gui_selected")):(this.value.set(!0),n.classList.add("gui_selected")),this.onchange(this.value.get())}).bind(this),this.ref_el=t,this.input_el=n}update(){this.value.get()?this.input_el.classList.add("gui_selected"):this.input_el.classList.remove("gui_selected")}}class be extends y{constructor(){super(...arguments);c(this,"label");c(this,"value");c(this,"step");c(this,"min");c(this,"max");c(this,"onchange");c(this,"input_el")}render(){const t=document.createElement("div");t.className="gui_input_number",I(this.label,t);const n=ee("number",this.value.get(),this.step,this.min,this.max);t.append(n),n.onchange=(function(){const s=oe(parseFloat(n.value),this.min,this.max);this.value.set(s),n.value=s.toString(),this.onchange(s)}).bind(this),this.ref_el=t,this.input_el=n}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString())}}class we extends y{constructor(){super(...arguments);c(this,"label");c(this,"value");c(this,"step");c(this,"min");c(this,"max");c(this,"container_el");c(this,"onchange");c(this,"input_el")}render(){const t=document.createElement("div");t.className="gui_slider_number",I(this.label,t);const n=C();n.className="gui_input_range_container",t.append(n);const s=ee("range",this.value.get(),this.step,this.min,this.max);s.className="gui_input_range",n.dataset.content=s.value,n.append(s),s.onchange=(function(){const o=oe(parseFloat(s.value),this.min,this.max);this.value.set(o),n.dataset.content=s.value,this.onchange(o)}).bind(this),s.onmousemove=function(){n.dataset.content=s.value},this.ref_el=t,this.container_el=n,this.input_el=s}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString(),this.container_el.dataset.content=this.input_el.value)}}class et extends y{constructor(){super(...arguments);c(this,"label");c(this,"value");c(this,"step");c(this,"min");c(this,"max");c(this,"size");c(this,"onchange");c(this,"input_els")}render(){const t=document.createElement("div");t.className="gui_input_vec",t.style.setProperty("--size",this.size.toString()),I(this.label,t);const n=C();t.append(n);const s=[];for(let o=0;o<this.value.length;o+=1){const l=ee("number",this.value[o],this.step,this.min,this.max);n.append(l),l.onchange=(function(){const a=oe(parseFloat(l.value),this.min,this.max);this.value[o]=a,l.value=a.toString(),this.onchange(this.value)}).bind(this),s.push(l)}this.ref_el=t,this.input_els=s}update(){for(let t=0;t<this.value.length;t+=1){const n=this.input_els[t];document.activeElement!=n&&(n.value=this.value[t].toString())}}}class tt extends y{constructor(){super(...arguments);c(this,"label");c(this,"value");c(this,"mode");c(this,"onchange");c(this,"input_el");c(this,"range_container_el");c(this,"range_el")}to_hex(t,n,s){const o=this.mode===0?255:1,l=Math.round(t*o).toString(16).padStart(2,"0"),a=Math.round(n*o).toString(16).padStart(2,"0"),u=Math.round(s*o).toString(16).padStart(2,"0");return`#${l}${a}${u}`}from_hex(t){const n=t.replace(/^#/,""),s=this.mode===0?255:1,o=parseInt(n.substring(0,2),16)/s,l=parseInt(n.substring(2,4),16)/s,a=parseInt(n.substring(4,6),16)/s;return[o,l,a]}render(){const t=document.createElement("div");t.className="gui_color_edit"+(this.value.length===4?" gui_rgba":""),I(this.label,t);const n=C();t.append(n);const s=document.createElement("input");if(s.className="gui_input_color",s.type="color",s.value=this.to_hex(this.value[0],this.value[1],this.value[2]),n.append(s),s.onchange=(function(){const o=this.from_hex(s.value);this.value[0]=o[0],this.value[1]=o[1],this.value[2]=o[2],this.onchange(this.value)}).bind(this),this.value.length==4){const o=document.createElement("div");o.className="gui_input_range_container",n.append(o);const l=ee("range",this.value[3],.01,0,1);l.className="gui_input_range",o.dataset.content=l.value,o.append(l),l.onchange=(function(){this.value[3]=parseFloat(l.value),o.dataset.content=l.value,this.onchange(this.value)}).bind(this),l.onmousemove=function(){o.dataset.content=l.value},this.range_el=l,this.range_container_el=o}this.ref_el=t,this.input_el=s}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.to_hex(this.value[0],this.value[1],this.value[2])),this.range_container_el&&this.range_el&&document.activeElement!=this.range_el&&(this.range_el.value=this.value[3].toString(),this.range_container_el.dataset.content=this.range_el.value)}}class nt extends y{constructor(){super(...arguments);c(this,"label");c(this,"value");c(this,"onchange");c(this,"input_el")}render(){const t=document.createElement("div");t.className="gui_input_text",I(this.label,t);const n=document.createElement("input");n.className="gui_input",n.type="text",n.value=this.value.get().toString(),t.append(n),n.onchange=(function(){this.value.set(n.value),this.onchange(n.value)}).bind(this),this.ref_el=t,this.input_el=n}update(){document.activeElement!=this.input_el&&(this.input_el.value=this.value.get().toString())}}class it extends y{constructor(){super(...arguments);c(this,"label");c(this,"value");c(this,"keys");c(this,"values");c(this,"onchange");c(this,"option_els")}render(){const t=document.createElement("div");t.className="gui_radio_group",I(this.label,t);const n=C();t.append(n);const s=[],o=this.value.get();for(let l=0;l<this.keys.length;l+=1){const a=this.keys[l],u=this.values[l],_=document.createElement("div");_.className="gui_radio_group_option"+(u===o?" gui_selected":""),_.innerHTML=a,n.append(_),_.onclick=(function(){this.value.set(u);for(const k of this.option_els)k.classList.remove("gui_selected");_.classList.add("gui_selected"),this.onchange(u)}).bind(this),s.push(_)}this.ref_el=t,this.option_els=s}update(){const t=this.value.get();for(let n=0;n<this.option_els.length;n+=1){const s=this.option_els[n];this.values[n]===t?s.classList.add("gui_selected"):s.classList.remove("gui_selected")}}}class st extends y{constructor(){super(...arguments);c(this,"label");c(this,"value");c(this,"keys");c(this,"values");c(this,"onchange");c(this,"option_els")}render(){const t=document.createElement("div");t.className="gui_checkbox_group",I(this.label,t);const n=C();t.append(n);const s=[],o=this.value.get();for(let l=0;l<this.keys.length;l+=1){const a=this.keys[l],u=this.values[l],_=document.createElement("div");_.className="gui_checkbox_group_option"+(o.indexOf(u)>-1?" gui_selected":""),_.innerHTML=a,n.append(_),_.onclick=(function(){_.classList.contains("gui_selected")?(o.splice(o.indexOf(u),1),_.classList.remove("gui_selected")):(o.push(u),_.classList.add("gui_selected")),this.onchange(this.value.get())}).bind(this),s.push(_)}this.ref_el=t,this.option_els=s}update(){const t=this.value.get();for(let n=0;n<this.option_els.length;n+=1){const s=this.option_els[n];t.indexOf(this.values[n])>-1?s.classList.add("gui_selected"):s.classList.remove("gui_selected")}}}class xe extends y{constructor(){super(...arguments);c(this,"label");c(this,"value");c(this,"keys");c(this,"values");c(this,"onchange");c(this,"button_el");c(this,"option_els")}render(){const t=document.createElement("div");t.className="gui_select",I(this.label,t);const n=document.createElement("div");n.className="gui_select",t.append(n),n.onclick=function(u){u.stopPropagation()};const s=document.createElement("div");s.className="gui_select_button",s.innerHTML="Select",n.append(s),s.onclick=function(){s.classList.contains("gui_open")?s.classList.remove("gui_open"):s.classList.add("gui_open")};const o=document.createElement("div");o.className="gui_select_container",n.append(o);const l=[],a=this.value.get();for(let u=0;u<this.keys.length;u+=1){const _=this.keys[u];this.values[u]===a&&(s.innerHTML=_);const E=document.createElement("div");E.className="gui_select_option",E.innerHTML=_,E.dataset.value=u.toString(),o.append(E),E.onclick=(function(){const W=this.values[parseInt(E.dataset.value||"")];this.value.set(W),s.innerHTML=_,s.classList.remove("gui_open"),this.onchange(W)}).bind(this),l.push(E)}this.ref_el=t,this.button_el=s,this.option_els=l}static mount(){const t=document.body.querySelector(".gui_window_root");t&&t.addEventListener("click",function(){const n=document.body.querySelector(".gui_select_button.gui_open");n&&n.classList.remove("gui_open")})}update(){const t=this.value.get();for(let n=0;n<this.option_els.length;n+=1)if(this.values[n]===t){this.button_el.innerHTML=this.keys[n];return}}}class ke extends y{constructor(){super(...arguments);c(this,"label");c(this,"onclick")}render(){const t=document.createElement("div");t.className="gui_button";const n=document.createElement("button");n.innerHTML=this.label,n.onclick=this.onclick,t.append(n),this.ref_el=t}}class Ee extends y{constructor(){super(...arguments);c(this,"auto_resize");c(this,"canvas_el")}render(){const t=document.createElement("div");t.className="gui_canvas";const n=document.createElement("canvas");t.append(n),this.auto_resize&&window.addEventListener("resize",function(){var s,o;n.width=((s=n.parentElement)==null?void 0:s.clientWidth)||0,n.height=((o=n.parentElement)==null?void 0:o.clientHeight)||0}),this.ref_el=t,this.canvas_el=n}mount(){var t,n;this.auto_resize&&(this.canvas_el.width=((t=this.canvas_el.parentElement)==null?void 0:t.clientWidth)||0,this.canvas_el.height=((n=this.canvas_el.parentElement)==null?void 0:n.clientHeight)||0)}}const ot=[fe,le,ve,ye,be,we,et,tt,nt,it,st,xe,ke,Ee];let he=0;function ce(e,i=""){const t=new fe;return t.id=he,t.title=i,t.grid_x=[],t.grid_y=[],t.layout=[],t.window_parent=e,t.window_children=[],e&&(e.children.push(t),e.window_children.push(t)),he+=1,t}function lt(e,i,t){e.grid_x=i,e.grid_y=t}function ct(e,i){const t=[];for(const n of i)t.push(n.id);e.layout=t}function at(e,i,t=!1){const n=new le;return n.title=i,n.is_collapsed=t,e.children.push(n),n}function rt(e,i){const t=new ve;return t.value=i,e.children.push(t),t}function ut(e,i,t,n=()=>{}){const s=new ye;return s.label=i,s.value=t,s.onchange=n,e.children.push(s),s}function A(e,i,t,n,s,o,l=()=>{}){const a=new be;return a.label=i,a.value=t,a.step=n,a.min=s,a.max=o,a.onchange=l,e.children.push(a),a}function Le(e,i,t,n,s,o,l=()=>{}){const a=new we;return a.label=i,a.value=t,a.step=n,a.min=s,a.max=o,a.onchange=l,e.children.push(a),a}function _t(e,i,t,n,s,o=()=>{}){const l=new xe;return l.label=i,l.value=t,l.keys=n,l.values=s,l.onchange=o,e.children.push(l),l}function ae(e,i,t){const n=new ke;return n.label=i,n.onclick=t,e.children.push(n),n}function dt(e,i=!0){const t=new Ee;return t.auto_resize=i,e.children.push(t),t}function Me(e,i){e.render(),i.append(e.ref_el),e.mount();for(const t of e.children)Me(t,e.container())}function ht(e,i,t=!0){if(Me(e,i),!!t)for(const n of ot)n.mount()}function Ne(e){if(!(e instanceof le&&e.is_collapsed)){e.update();for(const i of e.children)Ne(i)}}let h;function pt(e){return h=e.getContext("2d")}function Se(e){return`rgb(${e[0]},${e[1]},${e[2]})`}function mt(e){h.rect(0,0,h.canvas.width,h.canvas.height),h.fillStyle=Se(e),h.fill()}function Pe(e){h.moveTo(e[0],e[1])}function Te(e){h.lineTo(e[0],e[1])}function ie(e){h.beginPath(),Pe(e[0]);for(let i=1;i<e.length;i++)Te(e[i]);h.closePath()}function U(e,i){h.beginPath(),Pe(e),Te(i),h.closePath()}function gt(e,i){h.beginPath(),h.rect(e[0],e[1],i[0]-e[0],i[1]-e[1]),h.closePath()}function T(e,i){h.strokeStyle=Se(e),h.lineWidth=i,h.stroke()}function ft(e,i){const t=h.canvas.getBoundingClientRect(),n=e*h.canvas.width/t.width,s=i*h.canvas.height/t.height,o=h.getTransform().invertSelf(),l=f();return l[0]=n*o.a+s*o.c+o.e,l[1]=n*o.b+s*o.d+o.f,l}const v={keys:{},buttons:{},kb_key_down:function(){},kb_key_up:function(){},m_move:function(){},m_button_down:function(){},m_button_up:function(){},m_wheel_scroll:function(){}};function vt(e){v.kb_key_down=e}function yt(e){v.m_move=e}function bt(e){v.m_button_down=e}function wt(e){v.m_wheel_scroll=e}function xt(){addEventListener("keydown",function(e){v.keys[e.code]=0,v.kb_key_down({code:e.code,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey})}),addEventListener("keyup",function(e){v.keys[e.code]=1,v.kb_key_up({code:e.code,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey})}),addEventListener("mousemove",function(e){v.m_move({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target})}),addEventListener("mousedown",function(e){v.buttons[e.button]=0,v.m_button_down({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target})}),addEventListener("mouseup",function(e){v.buttons[e.button]=1,v.m_button_up({x:e.offsetX,y:e.offsetY,xd:e.movementX,yd:e.movementY,button:e.button,alt:e.altKey,ctrl:e.ctrlKey,shift:e.shiftKey,target:e.target})}),addEventListener("wheel",function(e){v.m_wheel_scroll({xd:Math.sign(e.deltaX),yd:Math.sign(e.deltaY)})})}class se{constructor(i){c(this,"points");this.points=i}}const r={width_mm:210,height_mm:297,page_margin_mm:4,panel_margin_mm:2,line_width_mm:.5,res_dpi:300,angle:45,mode:0,grid_div:3,snap_to_points:!1};let G=M(r.width_mm,r.res_dpi),D=M(r.height_mm,r.res_dpi),q=M(r.page_margin_mm,r.res_dpi),L=M(r.panel_margin_mm,r.res_dpi),N=M(r.line_width_mm,r.res_dpi),x=[],d=null,m=[],g=[],w=f(),te=1/0,Y=null,K=null,O=null,Q=f();const kt=z(238,238,238),Et=z(34,34,34),Ke=z(125,177,255),pe=z(255,197,82),me=z(0,255,255),Lt=z(255,0,255),j=ce(null);lt(j,[$(300,H.PX),$(1,H.FR),$(300,H.PX)],[$(1,H.FR),$(1,H.FR),$(1,H.FR)]);const Z=ce(j),R=ce(j);ct(j,[Z,R,R,Z,R,R,Z,R,R]);const b=at(Z,"Settings");A(b,"Width (mm)",S(r,"width_mm"),.5,0,1e3);A(b,"Height (mm)",S(r,"height_mm"),.5,0,1e3);A(b,"Resolution (dpi)",S(r,"res_dpi"),.5,0,1e3);A(b,"Page Margin (mm)",S(r,"page_margin_mm"),.5,0,1e3);A(b,"Panel Margin (mm)",S(r,"panel_margin_mm"),.5,0,1e3);A(b,"Line Width (mm)",S(r,"line_width_mm"),.5,0,1e3);_t(b,"Mode",S(r,"mode"),["Select","Knife","Anchor","Half Splitter","Grid Snapper"],[0,1,2,3,4]);Le(b,"Knife Angle",S(r,"angle"),1,-180,180);Le(b,"Grid Divider",S(r,"grid_div"),1,2,9);ut(b,"Snap To Points",S(r,"snap_to_points"));ae(b,"Reset",()=>{confirm("Are you sure you want to reset?")&&Fe()});ae(b,"Export PNG",()=>{setTimeout(()=>{const e=document.createElement("a");e.download="Template.png",e.href=p.toDataURL("image/png"),e.click()},1e3)});ae(b,"Export SVG",()=>{let e=`<svg xmlns="http://www.w3.org/2000/svg" width="${G}" height="${D}">
`;e+=`<style>polygon { fill: none; stroke: black; stroke-width: ${N}; }</style>
`;for(const t of x){let n="";for(const s of t.points)n+=s[0]+","+s[1]+" ";e+=`<polygon points="${n}" />`}e+=`</svg>
`;const i=document.createElement("a");i.download="Template.svg",i.href="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e),i.click()});rt(b,`
    Controls:<br>
    F - apply/cut<br>
    R - reset selection<br>
    LMB - select<br>
    scroll - change angle
`);const Mt=dt(R,!1);ht(j,document.body);const p=Mt.canvas_el;p.width=G;p.height=D;p.width<p.height?(p.style.width="auto",p.style.height="100%"):(p.style.width="100%",p.style.height="auto");pt(p);xt();function Fe(){G=M(r.width_mm,r.res_dpi),D=M(r.height_mm,r.res_dpi),q=M(r.page_margin_mm,r.res_dpi),L=M(r.panel_margin_mm,r.res_dpi),N=M(r.line_width_mm,r.res_dpi),p.width=G,p.height=D,p.width<p.height?(p.style.width="auto",p.style.height="100%"):(p.style.width="100%",p.style.height="auto"),x=[],x.push(new se(De(f(q,q),f(G-q,D-q))))}function re(){if(d){if(ie(d.points),T(Ke,N),r.mode==1)g=P(d.points,w,X(r.angle),-L/2),m=P(d.points,w,X(r.angle),L/2);else if(r.mode==2){te=1/0,Y=null;for(let e=0;e<d.points.length;++e){const i=d.points[e],t=d.points[(e+1)%d.points.length],n=r.snap_to_points?i:Ae(ne(i,t),w),s=qe(B(n,w));s<te&&(te=s,Y=n)}if(K){const e=B(K,w),i=Ye(e[1],e[0]);g=P(d.points,K,i,-L/2),m=P(d.points,K,i,L/2)}}else if(r.mode==3){const e=Be(d.points);g=P(d.points,e,X(r.angle),-L/2),m=P(d.points,e,X(r.angle),L/2)}else if(r.mode==4){const e=O||ge(d.points),i=B(e.max,e.min),t=B(w,e.min);Q=je(Ge(t,We(i,r.grid_div)),e.min),g=P(d.points,Q,X(r.angle),-L/2),m=P(d.points,Q,X(r.angle),L/2)}}}function V(){if(d&&g.length==2&&m.length==2){const e=g[0].index,i=g[1].index,t=m[0].index,n=m[1].index,s=[],o=[];for(let l=0;l<d.points.length;++l){const a=d.points[l],u=_e(ne(g[0].point,g[1].point),a),_=_e(ne(m[0].point,m[1].point),a);ze(u+_)>L&&(u<_?s.push(a):o.push(a)),l==e&&s.push(g[0].point),l==i&&s.push(g[1].point),l==t&&o.push(m[0].point),l==n&&o.push(m[1].point)}x.push(new se(s)),x.push(new se(o)),x.splice(x.indexOf(d),1),d=null,g=[],m=[]}}yt(function(e){if(e.target===p){if(w=ft(e.x,e.y),d)de(d.points,w)||(d=null);else for(const i of x)de(i.points,w)&&(d=i);re()}else d=null});bt(function(){r.mode==4&&d&&(O=ge(d.points))});wt(function(e){r.mode!=0&&(r.angle=Ce(r.angle+e.yd*5,-180,180),re())});vt(function(e){r.mode==0?e.code=="Delete"&&d&&(x.splice(x.indexOf(d),1),d=null):r.mode==2?e.code=="KeyF"&&(K?(V(),K=null):Y&&(K=Y,re())):r.mode==1||r.mode==3?e.code=="KeyF"&&V():r.mode==4&&e.code=="KeyF"&&V(),e.code=="KeyR"&&(O=null)});function J(){g.length==2&&m.length==2&&(U(g[0].point,g[1].point),T(pe,N),U(m[0].point,m[1].point),T(pe,N))}function Ie(){mt(kt);for(const e of x)ie(e.points),T(Et,N);d&&(ie(d.points),T(Ke,N),r.mode==1?J():r.mode==2?K?J():Y&&(U(Y,w),T(me,N)):r.mode==3?J():r.mode==4&&(U(Q,w),T(me,N),J())),O&&(gt(O.min,O.max),T(Lt,N)),requestAnimationFrame(Ie)}Fe();setInterval(function(){Ne(j)},1e3/30);Ie();
