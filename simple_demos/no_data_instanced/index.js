var Y=Object.defineProperty;var M=(t,o,e)=>o in t?Y(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e;var l=(t,o,e)=>M(t,typeof o!="symbol"?o+"":o,e);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const u of n)if(u.type==="childList")for(const a of u.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const u={};return n.integrity&&(u.integrity=n.integrity),n.referrerPolicy&&(u.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?u.credentials="include":n.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(n){if(n.ep)return;n.ep=!0;const u=e(n);fetch(n.href,u)}})();let c;function X(t){return c=t.getContext("webgl2")}function D(t,o){const e=c.createShader(t);if(!e)return null;if(c.shaderSource(e,o),c.compileShader(e),!c.getShaderParameter(e,c.COMPILE_STATUS)){const n=c.getShaderInfoLog(e);return console.error(n),c.deleteShader(e),null}return e}function N(t){const o=c.createProgram(),e=[];for(const n in t){const u=t[n],a=D(parseInt(n),u);if(!a){for(const g of e)c.deleteShader(g);return null}e.push(a)}for(const n of e)c.attachShader(o,n);c.linkProgram(o);for(const n of e)c.detachShader(o,n),c.deleteShader(n);if(!c.getProgramParameter(o,c.LINK_STATUS)){const n=c.getProgramInfoLog(o);return console.error(n),c.deleteProgram(o),null}return o}const y=Float32Array;function A(t=1,o=0,e=0,i=0,n=0,u,a=0,g=0,k=0,x=0,et,I=0,F=0,j=0,O=0,nt){const s=new y(16);return s[0]=t,s[1]=o,s[2]=e,s[3]=i,s[4]=n,s[5]=t,s[6]=a,s[7]=g,s[8]=k,s[9]=x,s[10]=t,s[11]=I,s[12]=F,s[13]=j,s[14]=O,s[15]=t,s}function E(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function p(t=0,o){const e=new y(2);return e[0]=t,e[1]=o??t,e}function U(t,o,e){return t[0]=o,t[1]=e,t}function K(t,o,e){return t[0]+=o[0]*e,t[1]+=o[1]*e,t}function B(t,o){const e=o[0],i=o[1],n=o[2];return t[12]=t[0]*e+t[4]*i+t[8]*n+t[12],t[13]=t[1]*e+t[5]*i+t[9]*n+t[13],t[14]=t[2]*e+t[6]*i+t[10]*n+t[14],t[15]=t[3]*e+t[7]*i+t[11]*n+t[15],t}function C(t,o){const e=o[0],i=o[1],n=o[2];return t[0]=t[0]*e,t[1]=t[1]*e,t[2]=t[2]*e,t[3]=t[3]*e,t[4]=t[4]*i,t[5]=t[5]*i,t[6]=t[6]*i,t[7]=t[7]*i,t[8]=t[8]*n,t[9]=t[9]*n,t[10]=t[10]*n,t[11]=t[11]*n,t[12]=t[12],t[13]=t[13],t[14]=t[14],t[15]=t[15],t}function S(t=0,o,e){const i=new y(3);return i[0]=t,i[1]=o??t,i[2]=e??t,i}class H{constructor(){l(this,"position");l(this,"scale");l(this,"roll");l(this,"right");l(this,"up");l(this,"world_up");l(this,"projection");l(this,"view");l(this,"movement_speed");l(this,"roll_speed")}}function W(){const t=new H;return t.position=p(),t.right=p(1,0),t.up=p(0,1),t.world_up=p(0,1),t.projection=A(1),t.view=A(1),t.scale=50,t.roll=0,t.movement_speed=.1,t.roll_speed=.1,t}function m(t,o){K(t.position,t.right,t.movement_speed*o)}function v(t,o){K(t.position,t.up,t.movement_speed*o)}function z(t,o,e){return E(t.projection),C(t.projection,S(t.scale/o,t.scale/e,1)),t.projection}function G(t){return E(t.view),B(t.view,S(-t.position[0],-t.position[1],0)),t.view}const d={keys:{},buttons:{},kb_key_down:function(){},kb_key_up:function(){},m_move:function(){},m_button_down:function(){},m_button_up:function(){},m_wheel_scroll:function(){}};function V(){addEventListener("keydown",function(t){d.keys[t.code]=0,d.kb_key_down({code:t.code,alt:t.altKey,ctrl:t.ctrlKey,shift:t.shiftKey})}),addEventListener("keyup",function(t){d.keys[t.code]=1,d.kb_key_up({code:t.code,alt:t.altKey,ctrl:t.ctrlKey,shift:t.shiftKey})}),addEventListener("mousemove",function(t){d.m_move({x:t.offsetX,y:t.offsetY,xd:t.movementX,yd:t.movementY,button:t.button,alt:t.altKey,ctrl:t.ctrlKey,shift:t.shiftKey,target:t.target})}),addEventListener("mousedown",function(t){d.buttons[t.button]=0,d.m_button_down({x:t.offsetX,y:t.offsetY,xd:t.movementX,yd:t.movementY,button:t.button,alt:t.altKey,ctrl:t.ctrlKey,shift:t.shiftKey,target:t.target})}),addEventListener("mouseup",function(t){d.buttons[t.button]=1,d.m_button_up({x:t.offsetX,y:t.offsetY,xd:t.movementX,yd:t.movementY,button:t.button,alt:t.altKey,ctrl:t.ctrlKey,shift:t.shiftKey,target:t.target})}),addEventListener("wheel",function(t){d.m_wheel_scroll({xd:Math.sign(t.deltaX),yd:Math.sign(t.deltaY)})})}function h(t){return d.keys[t]===0}function L(t,o){return Math.random()*(o-t+1)+t}document.body.style.margin="0";document.body.style.height="100vh";document.body.style.overflow="hidden";const f=document.createElement("canvas");f.width=document.body.clientWidth;f.height=document.body.clientHeight;document.body.append(f);addEventListener("resize",function(){f.width=document.body.clientWidth,f.height=document.body.clientHeight});const r=X(f),w=N({[r.VERTEX_SHADER]:`#version 300 es
        layout(location = 0) in vec2 i_position;
        uniform mat4 u_projection;
        uniform mat4 u_view;

        const vec2 positions[4] = vec2[4](
            vec2(-0.5, 0.5),
            vec2(-0.5, -0.5),
            vec2(0.5, 0.5),
            vec2(0.5, -0.5)
        );

        void main() {
            gl_Position = u_projection * u_view * vec4(positions[gl_VertexID] + i_position, 0.0, 1.0);
        }
    `,[r.FRAGMENT_SHADER]:`#version 300 es
        precision highp float;
        out vec4 o_frag_color;

        void main() {
            o_frag_color = vec4(1.0);
        }
    `}),q=r.getUniformLocation(w,"u_projection"),$=r.getUniformLocation(w,"u_view"),J=20,Q=20,b=J*Q,P=new Float32Array(b*2),R=[];for(let t=0;t<b;++t)R.push(new y(P.buffer,t*2*4,2));for(const t of R)U(t,L(-20,20),L(-20,20));const Z=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,Z);r.bufferData(r.ARRAY_BUFFER,P,r.STATIC_DRAW);r.enableVertexAttribArray(0);r.vertexAttribPointer(0,2,r.FLOAT,!1,0,0);r.vertexAttribDivisor(0,1);const _=W();V();function tt(){h("KeyA")&&m(_,-1),h("KeyD")&&m(_,1),h("KeyS")&&v(_,-1),h("KeyW")&&v(_,1),z(_,f.width,f.height),G(_)}function ot(){r.viewport(0,0,f.width,f.height),r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),r.useProgram(w),r.uniformMatrix4fv(q,!1,_.projection),r.uniformMatrix4fv($,!1,_.view),r.drawArrays(r.TRIANGLE_STRIP,0,4),r.drawArraysInstanced(r.TRIANGLE_STRIP,0,4,b)}function T(){tt(),ot(),requestAnimationFrame(T)}T();
